/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{660:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return qh})),n.d(e,"b",(function(){return Pc})),n.d(e,"c",(function(){return _c})),n.d(e,"d",(function(){return mc})),n.d(e,"e",(function(){return Kh})),n.d(e,"f",(function(){return qc})),n.d(e,"g",(function(){return C})),n.d(e,"h",(function(){return Bc})),n.d(e,"i",(function(){return Gh})),n.d(e,"j",(function(){return $h})),n.d(e,"k",(function(){return G})),n.d(e,"l",(function(){return fl})),n.d(e,"m",(function(){return Et})),n.d(e,"n",(function(){return W})),n.d(e,"o",(function(){return H})),n.d(e,"p",(function(){return cc})),n.d(e,"q",(function(){return x})),n.d(e,"r",(function(){return kt})),n.d(e,"s",(function(){return T})),n.d(e,"t",(function(){return ic})),n.d(e,"u",(function(){return sl})),n.d(e,"v",(function(){return bl})),n.d(e,"w",(function(){return vl})),n.d(e,"x",(function(){return kc})),n.d(e,"y",(function(){return yc})),n.d(e,"z",(function(){return th})),n.d(e,"A",(function(){return fc})),n.d(e,"B",(function(){return rl})),n.d(e,"C",(function(){return yl})),n.d(e,"D",(function(){return Mc})),n.d(e,"E",(function(){return wc})),n.d(e,"F",(function(){return Ac})),n.d(e,"G",(function(){return Cc})),n.d(e,"H",(function(){return Rc})),n.d(e,"I",(function(){return Rh})),n.d(e,"J",(function(){return Oh})),n.d(e,"K",(function(){return xc})),n.d(e,"L",(function(){return cl})),n.d(e,"M",(function(){return Hh})),n.d(e,"N",(function(){return Xh})),n.d(e,"O",(function(){return Yh})),n.d(e,"P",(function(){return Jh})),n.d(e,"Q",(function(){return Zh})),n.d(e,"R",(function(){return tl})),n.d(e,"S",(function(){return Il})),n.d(e,"T",(function(){return xh})),n.d(e,"U",(function(){return Dh})),n.d(e,"V",(function(){return Fc})),n.d(e,"W",(function(){return Lc})),n.d(e,"X",(function(){return il})),n.d(e,"Y",(function(){return al})),n.d(e,"Z",(function(){return _h})),n.d(e,"ab",(function(){return vh})),n.d(e,"bb",(function(){return bc})),n.d(e,"cb",(function(){return vc})),n.d(e,"db",(function(){return pl})),n.d(e,"eb",(function(){return wl})),n.d(e,"fb",(function(){return el})),n.d(e,"gb",(function(){return w})),n.d(e,"hb",(function(){return zh})),n.d(e,"ib",(function(){return Nh})),n.d(e,"jb",(function(){return Ch})),n.d(e,"kb",(function(){return nl})),n.d(e,"lb",(function(){return Oc})),n.d(e,"mb",(function(){return Ih}));var r=n(619),o=n(600),c=n(618),h=n(598),l=n(661);const d="@firebase/firestore";class f{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let b="9.18.0";const m=new c.b("@firebase/firestore");function y(){return m.logLevel}function w(t){m.setLogLevel(t)}function v(t,...e){if(m.logLevel<=c.a.DEBUG){const n=e.map(E);m.debug(`Firestore (${b}): ${t}`,...n)}}function I(t,...e){if(m.logLevel<=c.a.ERROR){const n=e.map(E);m.error(`Firestore (${b}): ${t}`,...n)}}function T(t,...e){if(m.logLevel<=c.a.WARN){const n=e.map(E);m.warn(`Firestore (${b}): ${t}`,...n)}}function E(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _(t="Unexpected state"){const e=`FIRESTORE (${b}) INTERNAL ASSERTION FAILED: `+t;throw I(e),new Error(e)}function S(t,e){t||_()}function x(t,e){t||_()}function D(t,e){return t}const A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends h.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class q{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class N{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class k{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(f.UNAUTHENTICATED)))}shutdown(){}}class O{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class R{constructor(t){this.t=t,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new q;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new q,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new q)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(S("string"==typeof e.accessToken),new N(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return S(null===t||"string"==typeof t),new f(t)}}class M{constructor(t,e,n,s){this.h=t,this.l=e,this.m=n,this.g=s,this.type="FirstParty",this.user=f.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(S(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class F{constructor(t,e,n,s){this.h=t,this.l=e,this.m=n,this.g=s}getToken(){return Promise.resolve(new M(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable((()=>e(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class L{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class V{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const n=t=>{null!=t.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.A;return this.A=t.token,v("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.T.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.T.getImmediate({optional:!0});t?s(t):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(S("string"==typeof t.token),this.A=t.token,new L(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function P(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class U{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=P(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function B(t,e){return t<e?-1:t>e?1:0}function j(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function K(t){return t+"\0"}class G{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new C(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return G.fromMillis(Date.now())}static fromDate(t){return G.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new G(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?B(this.nanoseconds,t.nanoseconds):B(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ${constructor(t){this.timestamp=t}static fromTimestamp(t){return new $(t)}static min(){return new $(new G(0,0))}static max(){return new $(new G(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Q{constructor(t,e,n){void 0===e?e=0:e>t.length&&_(),void 0===n?n=t.length-e:n>t.length-e&&_(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Q.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Q?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class rt extends Q{construct(t,e,n){return new rt(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new C(A.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new rt(e)}static emptyPath(){return new rt([])}}const z=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class H extends Q{construct(t,e,n){return new H(t,e,n)}static isValidIdentifier(t){return z.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),H.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new H(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new C(A.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new C(A.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new C(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new C(A.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new H(e)}static emptyPath(){return new H([])}}class W{constructor(t){this.path=t}static fromPath(t){return new W(rt.fromString(t))}static fromName(t){return new W(rt.fromString(t).popFirst(5))}static empty(){return new W(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===rt.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return rt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new W(new rt(t.slice()))}}class X{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function Y(t){return t.fields.find((t=>2===t.kind))}function J(t){return t.fields.filter((t=>2!==t.kind))}X.UNKNOWN_ID=-1;class dt{constructor(t,e){this.fieldPath=t,this.kind=e}}class Z{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Z(0,nt.min())}}function tt(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=$.fromTimestamp(1e9===s?new G(n+1,0):new G(n,s));return new nt(i,W.empty(),e)}function et(t){return new nt(t.readTime,t.key,-1)}class nt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new nt($.min(),W.empty(),-1)}static max(){return new nt($.max(),W.empty(),-1)}}function st(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=W.comparator(t.documentKey,e.documentKey),0!==n?n:B(t.largestBatchId,e.largestBatchId))}const it="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ot{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function at(t){if(t.code!==A.FAILED_PRECONDITION||t.message!==it)throw t;v("LocalStore","Unexpectedly lost primary lease")}class ut{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ut(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ut?e:ut.resolve(e)}catch(t){return ut.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ut.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ut.reject(e)}static resolve(t){return new ut(((e,n)=>{e(t)}))}static reject(t){return new ut(((e,n)=>{n(t)}))}static waitFor(t){return new ut(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=ut.resolve(!1);for(const n of t)e=e.next((t=>t?ut.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new ut(((n,s)=>{const i=t.length,r=new Array(i);let o=0;for(let u=0;u<i;u++){const c=u;e(t[c]).next((t=>{r[c]=t,++o,o===i&&n(r)}),(t=>s(t)))}}))}static doWhile(t,e){return new ut(((n,s)=>{const i=()=>{!0===t()?e().next((()=>{i()}),s):n()};i()}))}}class ct{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.P=new q,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new ft(t,e.error)):this.P.resolve()},this.transaction.onerror=e=>{const n=wt(e.target.error);this.P.reject(new ft(t,n))}}static open(t,e,n,s){try{return new ct(e,t.transaction(s,n))}catch(t){throw new ft(e,t)}}get v(){return this.P.promise}abort(t){t&&this.P.reject(t),this.aborted||(v("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new gt(e)}}class ht{constructor(t,e,n){this.name=t,this.version=e,this.S=n,12.2===ht.D(Object(h.q)())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return v("SimpleDb","Removing database:",t),pt(window.indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!Object(h.v)())return!1;if(ht.N())return!0;const t=Object(h.q)(),e=ht.D(t),n=0<e&&e<10,s=ht.k(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static N(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.$)}static M(t,e){return t.store(e)}static D(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new ft(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new C(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new C(A.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new ft(t,s))},s.onupgradeneeded=t=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.S.F(e,s.transaction,t.oldVersion,this.version).next((()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.O(t);const e=ct.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).next((t=>(e.V(),t))).catch((t=>(e.abort(t),ut.reject(t)))).toPromise();return r.catch((()=>{})),await e.v,r}catch(t){const e=t,n="FirebaseError"!==e.name&&r<3;if(v("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class lt{constructor(t){this.q=t,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(t){this.q=t}done(){this.U=!0}j(t){this.K=t}delete(){return pt(this.q.delete())}}class ft extends C{constructor(t,e){super(A.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function mt(t){return"IndexedDbTransactionError"===t.name}class gt{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(v("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),pt(n)}add(t){return v("SimpleDb","ADD",this.store.name,t,t),pt(this.store.add(t))}get(t){return pt(this.store.get(t)).next((e=>(void 0===e&&(e=null),v("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return v("SimpleDb","DELETE",this.store.name,t),pt(this.store.delete(t))}count(){return v("SimpleDb","COUNT",this.store.name),pt(this.store.count())}W(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.H(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new ut(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}J(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new ut(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}Y(t,e){v("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.Z=!1;const s=this.cursor(n);return this.H(s,((t,e,n)=>n.delete()))}X(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.H(s,e)}tt(t){const e=this.cursor({});return new ut(((n,s)=>{e.onerror=t=>{const e=wt(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}H(t,e){const n=[];return new ut(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new lt(i),o=e(i.primaryKey,i.value,r);if(o instanceof ut){const t=o.catch((t=>(r.done(),ut.reject(t))));n.push(t)}r.isDone?s():null===r.G?i.continue():i.continue(r.G)}})).next((()=>ut.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Z?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function pt(t){return new ut(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=wt(t.target.error);n(e)}}))}let yt=!1;function wt(t){const e=ht.D(Object(h.q)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return yt||(yt=!0,setTimeout((()=>{throw t}),0)),t}}return t}class vt{constructor(t,e){this.asyncQueue=t,this.et=e,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(t){v("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{v("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(t){mt(t)?v("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await at(t)}await this.nt(6e4)}))}}class bt{constructor(t,e){this.localStore=t,this.persistence=e}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.it(e,t)))}it(t,e){const n=new Set;let s=e,i=!0;return ut.doWhile((()=>!0===i&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return v("IndexBackiller",`Processing collection: ${e}`),this.rt(t,e,s).next((t=>{s-=t,n.add(e)}));i=!1})))).next((()=>e-s))}rt(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(t,i).next((()=>this.ot(s,n))).next((n=>(v("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>i.size))}))))}ot(t,e){let n=t;return e.changes.forEach(((t,e)=>{const s=et(e);st(s,n)>0&&(n=s)})),new nt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class It{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ut(t),this.ct=t=>e.writeSequenceNumber(t))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}It.at=-1;class Tt{constructor(t,e,n,s,i,r,o,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=u}}class Et{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Et("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Et&&t.projectId===this.projectId&&t.database===this.database}}function _t(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function St(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function xt(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Dt(t){return null==t}function At(t){return 0===t&&1/t==-1/0}function Ct(t){return"number"==typeof t&&Number.isInteger(t)&&!At(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Nt extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function kt(){return"undefined"!=typeof atob}class Ot{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw t instanceof DOMException?new Nt("Invalid base64 string: "+t):t}}(t);return new Ot(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ot(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return B(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ot.EMPTY_BYTE_STRING=new Ot("");const Rt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mt(t){if(S(!!t),"string"==typeof t){let e=0;const n=Rt.exec(t);if(S(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ft(t.seconds),nanos:Ft(t.nanos)}}function Ft(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Lt(t){return"string"==typeof t?Ot.fromBase64String(t):Ot.fromUint8Array(t)}function Vt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Pt(t){const e=t.mapValue.fields.__previous_value__;return Vt(e)?Pt(e):e}function qt(t){const e=Mt(t.mapValue.fields.__local_write_time__.timestampValue);return new G(e.seconds,e.nanos)}const Ut={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Bt={nullValue:"NULL_VALUE"};function jt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Vt(t)?4:ne(t)?9007199254740991:10:_()}function Kt(t,e){if(t===e)return!0;const n=jt(t);if(n!==jt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qt(t).isEqual(qt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Mt(t.timestampValue),s=Mt(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Lt(t.bytesValue).isEqual(Lt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ft(t.geoPointValue.latitude)===Ft(e.geoPointValue.latitude)&&Ft(t.geoPointValue.longitude)===Ft(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ft(t.integerValue)===Ft(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ft(t.doubleValue),s=Ft(e.doubleValue);return n===s?At(n)===At(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return j(t.arrayValue.values||[],e.arrayValue.values||[],Kt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(_t(n)!==_t(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Kt(n[t],s[t])))return!1;return!0}(t,e);default:return _()}}function Gt(t,e){return void 0!==(t.values||[]).find((t=>Kt(t,e)))}function $t(t,e){if(t===e)return 0;const n=jt(t),s=jt(e);if(n!==s)return B(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return B(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ft(t.integerValue||t.doubleValue),s=Ft(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Qt(t.timestampValue,e.timestampValue);case 4:return Qt(qt(t),qt(e));case 5:return B(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Lt(t),s=Lt(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=B(n[t],s[t]);if(0!==e)return e}return B(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=B(Ft(t.latitude),Ft(e.latitude));return 0!==n?n:B(Ft(t.longitude),Ft(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=$t(n[t],s[t]);if(e)return e}return B(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Ut.mapValue&&e===Ut.mapValue)return 0;if(t===Ut.mapValue)return 1;if(e===Ut.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=B(s[t],r[t]);if(0!==e)return e;const o=$t(n[s[t]],i[r[t]]);if(0!==o)return o}return B(s.length,r.length)}(t.mapValue,e.mapValue);default:throw _()}}function Qt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return B(t,e);const n=Mt(t),s=Mt(e),i=B(n.seconds,s.seconds);return 0!==i?i:B(n.nanos,s.nanos)}function zt(t){return Ht(t)}function Ht(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Mt(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Lt(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,W.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Ht(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Ht(t.fields[i])}`;return n+"}"}(t.mapValue):_();var e,n}function Wt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Xt(t){return!!t&&"integerValue"in t}function Yt(t){return!!t&&"arrayValue"in t}function Jt(t){return!!t&&"nullValue"in t}function Zt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function te(t){return!!t&&"mapValue"in t}function ee(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return St(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=ee(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=ee(t.arrayValue.values[n]);return e}return Object.assign({},t)}function ne(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function re(t){return"nullValue"in t?Bt:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Wt(Et.empty(),W.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:_()}function se(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Wt(Et.empty(),W.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?Ut:_()}function ie(t,e){const n=$t(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function oe(t,e){const n=$t(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class ae{constructor(t,e){this.position=t,this.inclusive=e}}function ue(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?W.comparator(W.fromName(o.referenceValue),n.key):$t(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function ce(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Kt(t.position[n],e.position[n]))return!1;return!0}class he{}class le extends he{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Ie(t,e,n):"array-contains"===e?new Se(t,n):"in"===e?new xe(t,n):"not-in"===e?new De(t,n):"array-contains-any"===e?new Ae(t,n):new le(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Te(t,n):new Ee(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison($t(e,this.value)):null!==e&&jt(this.value)===jt(e)&&this.matchesComparison($t(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class de extends he{constructor(t,e){super(),this.filters=t,this.op=e,this.ft=null}static create(t,e){return new de(t,e)}matches(t){return fe(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.dt((t=>t.isInequality()));return null!==t?t.field:null}dt(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function fe(t){return"and"===t.op}function me(t){return"or"===t.op}function ge(t){return pe(t)&&fe(t)}function pe(t){for(const e of t.filters)if(e instanceof de)return!1;return!0}function ye(t){if(t instanceof le)return t.field.canonicalString()+t.op.toString()+zt(t.value);if(ge(t))return t.filters.map((t=>ye(t))).join(",");{const e=t.filters.map((t=>ye(t))).join(",");return`${t.op}(${e})`}}function we(t,e){return t instanceof le?function(t,e){return e instanceof le&&t.op===e.op&&t.field.isEqual(e.field)&&Kt(t.value,e.value)}(t,e):t instanceof de?function(t,e){return e instanceof de&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,s)=>t&&we(n,e.filters[s])),!0)}(t,e):void _()}function ve(t,e){const n=t.filters.concat(e);return de.create(n,t.op)}function be(t){return t instanceof le?function(t){return`${t.field.canonicalString()} ${t.op} ${zt(t.value)}`}(t):t instanceof de?function(t){return t.op.toString()+" {"+t.getFilters().map(be).join(" ,")+"}"}(t):"Filter"}class Ie extends le{constructor(t,e,n){super(t,e,n),this.key=W.fromName(n.referenceValue)}matches(t){const e=W.comparator(t.key,this.key);return this.matchesComparison(e)}}class Te extends le{constructor(t,e){super(t,"in",e),this.keys=_e("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ee extends le{constructor(t,e){super(t,"not-in",e),this.keys=_e("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function _e(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>W.fromName(t.referenceValue)))}class Se extends le{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Yt(e)&&Gt(e.arrayValue,this.value)}}class xe extends le{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Gt(this.value.arrayValue,e)}}class De extends le{constructor(t,e){super(t,"not-in",e)}matches(t){if(Gt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Gt(this.value.arrayValue,e)}}class Ae extends le{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Yt(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Gt(this.value.arrayValue,t)))}}class Ce{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ne(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ke{constructor(t,e){this.comparator=t,this.root=e||Re.EMPTY}insert(t,e){return new ke(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(t){return new ke(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Re.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Oe(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Oe(this.root,t,this.comparator,!1)}getReverseIterator(){return new Oe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Oe(this.root,t,this.comparator,!0)}}class Oe{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Re{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:Re.RED,this.left=null!=s?s:Re.EMPTY,this.right=null!=i?i:Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Re(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Re.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _();if(this.right.isRed())throw _();const t=this.left.check();if(t!==this.right.check())throw _();return t+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw _()}get value(){throw _()}get color(){throw _()}get left(){throw _()}get right(){throw _()}copy(t,e,n,s,i){return this}insert(t,e,n){return new Re(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Me{constructor(t){this.comparator=t,this.data=new ke(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Fe(this.data.getIterator())}getIteratorFrom(t){return new Fe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Me))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Me(this.comparator);return e.data=t,e}}class Fe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Le(t){return t.hasNext()?t.getNext():void 0}class Ve{constructor(t){this.fields=t,t.sort(H.comparator)}static empty(){return new Ve([])}unionWith(t){let e=new Me(H.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ve(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return j(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Pe{constructor(t){this.value=t}static empty(){return new Pe({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!te(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ee(e)}setAll(t){let e=H.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=ee(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());te(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Kt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];te(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){St(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Pe(ee(this.value))}}function qe(t){const e=[];return St(t.fields,((t,n)=>{const s=new H([t]);if(te(n)){const t=qe(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new Ve(e)}class Ue{constructor(t,e,n,s,i,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(t){return new Ue(t,0,$.min(),$.min(),$.min(),Pe.empty(),0)}static newFoundDocument(t,e,n,s){return new Ue(t,1,e,$.min(),n,s,0)}static newNoDocument(t,e){return new Ue(t,2,e,$.min(),$.min(),Pe.empty(),0)}static newUnknownDocument(t,e){return new Ue(t,3,e,$.min(),$.min(),Pe.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual($.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ue&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ue(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Be{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this._t=null}}function je(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Be(t,e,n,s,i,r,o)}function Ke(t){const e=D(t);if(null===e._t){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ye(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Dt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>zt(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>zt(t))).join(",")),e._t=t}return e._t}function Ge(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ne(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!we(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ce(t.startAt,e.startAt)&&ce(t.endAt,e.endAt)}function $e(t){return W.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Qe(t,e){return t.filters.filter((t=>t instanceof le&&t.field.isEqual(e)))}function ze(t,e,n){let s=Bt,i=!0;for(const n of Qe(t,e)){let t=Bt,e=!0;switch(n.op){case"<":case"<=":t=re(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=Bt}ie({value:s,inclusive:i},{value:t,inclusive:e})<0&&(s=t,i=e)}if(null!==n)for(let r=0;r<t.orderBy.length;++r)if(t.orderBy[r].field.isEqual(e)){const t=n.position[r];ie({value:s,inclusive:i},{value:t,inclusive:n.inclusive})<0&&(s=t,i=n.inclusive);break}return{value:s,inclusive:i}}function He(t,e,n){let s=Ut,i=!0;for(const n of Qe(t,e)){let t=Ut,e=!0;switch(n.op){case">=":case">":t=se(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=Ut}oe({value:s,inclusive:i},{value:t,inclusive:e})>0&&(s=t,i=e)}if(null!==n)for(let r=0;r<t.orderBy.length;++r)if(t.orderBy[r].field.isEqual(e)){const t=n.position[r];oe({value:s,inclusive:i},{value:t,inclusive:n.inclusive})>0&&(s=t,i=n.inclusive);break}return{value:s,inclusive:i}}class We{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=u,this.wt=null,this.gt=null,this.startAt,this.endAt}}function Xe(t,e,n,s,i,r,o,u){return new We(t,e,n,s,i,r,o,u)}function Ye(t){return new We(t)}function Je(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ze(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function tn(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function en(t){return null!==t.collectionGroup}function nn(t){const e=D(t);if(null===e.wt){e.wt=[];const t=tn(e),n=Ze(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new Ce(t)),e.wt.push(new Ce(H.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Ce(H.keyField(),t))}}}return e.wt}function rn(t){const e=D(t);if(!e.gt)if("F"===e.limitType)e.gt=je(e.path,e.collectionGroup,nn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of nn(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Ce(n.field,e))}const n=e.endAt?new ae(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ae(e.startAt.position,e.startAt.inclusive):null;e.gt=je(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.gt}function sn(t,e){e.getFirstInequalityField(),tn(t);const n=t.filters.concat([e]);return new We(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function on(t,e,n){return new We(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function an(t,e){return Ge(rn(t),rn(e))&&t.limitType===e.limitType}function un(t){return`${Ke(rn(t))}|lt:${t.limitType}`}function cn(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>be(t))).join(", ")}]`),Dt(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>zt(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>zt(t))).join(",")),`Target(${e})`}(rn(t))}; limitType=${t.limitType})`}function hn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):W.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of nn(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=ue(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,nn(t),e))&&!(t.endAt&&!function(t,e,n){const s=ue(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,nn(t),e))}(t,e)}function ln(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function dn(t){return(e,n)=>{let s=!1;for(const i of nn(t)){const t=fn(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function fn(t,e,n){const s=t.field.isKeyField()?W.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?$t(s,i):_()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return _()}}function mn(t,e){if(t.yt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:At(e)?"-0":e}}function gn(t){return{integerValue:""+t}}function pn(t,e){return Ct(e)?gn(e):mn(t,e)}class yn{constructor(){this._=void 0}}function wn(t,e,n){return t instanceof In?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Tn?En(t,e):t instanceof _n?Sn(t,e):function(t,e){const n=bn(t,e),s=Dn(n)+Dn(t.It);return Xt(n)&&Xt(t.It)?gn(s):mn(t.Tt,s)}(t,e)}function vn(t,e,n){return t instanceof Tn?En(t,e):t instanceof _n?Sn(t,e):n}function bn(t,e){return t instanceof xn?Xt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class In extends yn{}class Tn extends yn{constructor(t){super(),this.elements=t}}function En(t,e){const n=An(e);for(const e of t.elements)n.some((t=>Kt(t,e)))||n.push(e);return{arrayValue:{values:n}}}class _n extends yn{constructor(t){super(),this.elements=t}}function Sn(t,e){let n=An(e);for(const e of t.elements)n=n.filter((t=>!Kt(t,e)));return{arrayValue:{values:n}}}class xn extends yn{constructor(t,e){super(),this.Tt=t,this.It=e}}function Dn(t){return Ft(t.integerValue||t.doubleValue)}function An(t){return Yt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Cn{constructor(t,e){this.field=t,this.transform=e}}class Nn{constructor(t,e){this.version=t,this.transformResults=e}}class kn{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new kn}static exists(t){return new kn(void 0,t)}static updateTime(t){return new kn(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function On(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Rn{}function Mn(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Gn(t.key,kn.none()):new qn(t.key,t.data,kn.none());{const n=t.data,s=Pe.empty();let i=new Me(H.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),i=i.add(t)}return new Un(t.key,s,new Ve(i.toArray()),kn.none())}}function Fn(t,e,n){t instanceof qn?function(t,e,n){const s=t.value.clone(),i=jn(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Un?function(t,e,n){if(!On(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=jn(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Bn(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ln(t,e,n,s){return t instanceof qn?function(t,e,n,s){if(!On(t.precondition,e))return n;const i=t.value.clone(),r=Kn(t.fieldTransforms,s,e);return i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,s):t instanceof Un?function(t,e,n,s){if(!On(t.precondition,e))return n;const i=Kn(t.fieldTransforms,s,e),r=e.data;return r.setAll(Bn(t)),r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return On(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Vn(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=bn(s.transform,t||null);null!=i&&(null===n&&(n=Pe.empty()),n.set(s.field,i))}return n||null}function Pn(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&j(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Tn&&e instanceof Tn||t instanceof _n&&e instanceof _n?j(t.elements,e.elements,Kt):t instanceof xn&&e instanceof xn?Kt(t.It,e.It):t instanceof In&&e instanceof In}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class qn extends Rn{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Un extends Rn{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Bn(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function jn(t,e,n){const s=new Map;S(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,u=e.data.field(r.field);s.set(r.field,vn(o,u,n[i]))}return s}function Kn(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,wn(t,r,e))}return s}class Gn extends Rn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $n extends Rn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qn{constructor(t){this.count=t}}var zn,Hn;function Wn(t){switch(t){default:return _();case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0}}function Xn(t){if(void 0===t)return I("GRPC error has no .code"),A.UNKNOWN;switch(t){case zn.OK:return A.OK;case zn.CANCELLED:return A.CANCELLED;case zn.UNKNOWN:return A.UNKNOWN;case zn.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case zn.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case zn.INTERNAL:return A.INTERNAL;case zn.UNAVAILABLE:return A.UNAVAILABLE;case zn.UNAUTHENTICATED:return A.UNAUTHENTICATED;case zn.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case zn.NOT_FOUND:return A.NOT_FOUND;case zn.ALREADY_EXISTS:return A.ALREADY_EXISTS;case zn.PERMISSION_DENIED:return A.PERMISSION_DENIED;case zn.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case zn.ABORTED:return A.ABORTED;case zn.OUT_OF_RANGE:return A.OUT_OF_RANGE;case zn.UNIMPLEMENTED:return A.UNIMPLEMENTED;case zn.DATA_LOSS:return A.DATA_LOSS;default:return _()}}(Hn=zn||(zn={}))[Hn.OK=0]="OK",Hn[Hn.CANCELLED=1]="CANCELLED",Hn[Hn.UNKNOWN=2]="UNKNOWN",Hn[Hn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Hn[Hn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Hn[Hn.NOT_FOUND=5]="NOT_FOUND",Hn[Hn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Hn[Hn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Hn[Hn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Hn[Hn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Hn[Hn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Hn[Hn.ABORTED=10]="ABORTED",Hn[Hn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Hn[Hn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Hn[Hn.INTERNAL=13]="INTERNAL",Hn[Hn.UNAVAILABLE=14]="UNAVAILABLE",Hn[Hn.DATA_LOSS=15]="DATA_LOSS";class Yn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){St(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return xt(this.inner)}size(){return this.innerSize}}const Jn=new ke(W.comparator);function Zn(){return Jn}const er=new ke(W.comparator);function nr(...t){let e=er;for(const n of t)e=e.insert(n.key,n);return e}function rr(t){let e=er;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function sr(){return or()}function ir(){return or()}function or(){return new Yn((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ar=new ke(W.comparator),ur=new Me(W.comparator);function cr(...t){let e=ur;for(const n of t)e=e.add(n);return e}const lr=new Me(B);function dr(){return lr}class fr{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,mr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new fr($.min(),s,dr(),Zn(),cr())}}class mr{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new mr(n,e,cr(),cr(),cr())}}class gr{constructor(t,e,n,s){this.Et=t,this.removedTargetIds=e,this.key=n,this.At=s}}class pr{constructor(t,e){this.targetId=t,this.Rt=e}}class yr{constructor(t,e,n=Ot.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class wr{constructor(){this.Pt=0,this.vt=Tr(),this.bt=Ot.EMPTY_BYTE_STRING,this.Vt=!1,this.St=!0}get current(){return this.Vt}get resumeToken(){return this.bt}get Dt(){return 0!==this.Pt}get Ct(){return this.St}xt(t){t.approximateByteSize()>0&&(this.St=!0,this.bt=t)}Nt(){let t=cr(),e=cr(),n=cr();return this.vt.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:_()}})),new mr(this.bt,this.Vt,t,e,n)}kt(){this.St=!1,this.vt=Tr()}$t(t,e){this.St=!0,this.vt=this.vt.insert(t,e)}Mt(t){this.St=!0,this.vt=this.vt.remove(t)}Ot(){this.Pt+=1}Ft(){this.Pt-=1}Bt(){this.St=!0,this.Vt=!0}}class vr{constructor(t){this.Lt=t,this.qt=new Map,this.Ut=Zn(),this.Kt=Ir(),this.Gt=new Me(B)}Qt(t){for(const e of t.Et)t.At&&t.At.isFoundDocument()?this.jt(e,t.At):this.zt(e,t.key,t.At);for(const e of t.removedTargetIds)this.zt(e,t.key,t.At)}Wt(t){this.forEachTarget(t,(e=>{const n=this.Ht(e);switch(t.state){case 0:this.Jt(e)&&n.xt(t.resumeToken);break;case 1:n.Ft(),n.Dt||n.kt(),n.xt(t.resumeToken);break;case 2:n.Ft(),n.Dt||this.removeTarget(e);break;case 3:this.Jt(e)&&(n.Bt(),n.xt(t.resumeToken));break;case 4:this.Jt(e)&&(this.Yt(e),n.xt(t.resumeToken));break;default:_()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.qt.forEach(((t,n)=>{this.Jt(n)&&e(n)}))}Zt(t){const e=t.targetId,n=t.Rt.count,s=this.Xt(e);if(s){const t=s.target;if($e(t))if(0===n){const n=new W(t.path);this.zt(e,n,Ue.newNoDocument(n,$.min()))}else S(1===n);else this.te(e)!==n&&(this.Yt(e),this.Gt=this.Gt.add(e))}}ee(t){const e=new Map;this.qt.forEach(((n,s)=>{const i=this.Xt(s);if(i){if(n.current&&$e(i.target)){const e=new W(i.target.path);null!==this.Ut.get(e)||this.ne(s,e)||this.zt(s,e,Ue.newNoDocument(e,t))}n.Ct&&(e.set(s,n.Nt()),n.kt())}}));let n=cr();this.Kt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.Xt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.Ut.forEach(((e,n)=>n.setReadTime(t)));const s=new fr(t,e,this.Gt,this.Ut,n);return this.Ut=Zn(),this.Kt=Ir(),this.Gt=new Me(B),s}jt(t,e){if(!this.Jt(t))return;const n=this.ne(t,e.key)?2:0;this.Ht(t).$t(e.key,n),this.Ut=this.Ut.insert(e.key,e),this.Kt=this.Kt.insert(e.key,this.se(e.key).add(t))}zt(t,e,n){if(!this.Jt(t))return;const s=this.Ht(t);this.ne(t,e)?s.$t(e,1):s.Mt(e),this.Kt=this.Kt.insert(e,this.se(e).delete(t)),n&&(this.Ut=this.Ut.insert(e,n))}removeTarget(t){this.qt.delete(t)}te(t){const e=this.Ht(t).Nt();return this.Lt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ot(t){this.Ht(t).Ot()}Ht(t){let e=this.qt.get(t);return e||(e=new wr,this.qt.set(t,e)),e}se(t){let e=this.Kt.get(t);return e||(e=new Me(B),this.Kt=this.Kt.insert(t,e)),e}Jt(t){const e=null!==this.Xt(t);return e||v("WatchChangeAggregator","Detected inactive target",t),e}Xt(t){const e=this.qt.get(t);return e&&e.Dt?null:this.Lt.ie(t)}Yt(t){this.qt.set(t,new wr),this.Lt.getRemoteKeysForTarget(t).forEach((e=>{this.zt(t,e,null)}))}ne(t,e){return this.Lt.getRemoteKeysForTarget(t).has(e)}}function Ir(){return new ke(W.comparator)}function Tr(){return new ke(W.comparator)}const Er={asc:"ASCENDING",desc:"DESCENDING"},_r={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sr={and:"AND",or:"OR"};class xr{constructor(t,e){this.databaseId=t,this.yt=e}}function Dr(t,e){return t.yt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ar(t,e){return t.yt?e.toBase64():e.toUint8Array()}function Cr(t,e){return Dr(t,e.toTimestamp())}function Nr(t){return S(!!t),$.fromTimestamp(function(t){const e=Mt(t);return new G(e.seconds,e.nanos)}(t))}function kr(t,e){return function(t){return new rt(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Or(t){const e=rt.fromString(t);return S(Zr(e)),e}function Rr(t,e){return kr(t.databaseId,e.path)}function Mr(t,e){const n=Or(e);if(n.get(1)!==t.databaseId.projectId)throw new C(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new C(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new W(Pr(n))}function Fr(t,e){return kr(t.databaseId,e)}function Lr(t){const e=Or(t);return 4===e.length?rt.emptyPath():Pr(e)}function Vr(t){return new rt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Pr(t){return S(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function qr(t,e,n){return{name:Rr(t,e),fields:n.value.mapValue.fields}}function Ur(t,e,n){const s=Mr(t,e.name),i=Nr(e.updateTime),r=e.createTime?Nr(e.createTime):$.min(),o=new Pe({mapValue:{fields:e.fields}}),u=Ue.newFoundDocument(s,i,r,o);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function Br(t,e){let n;if(e instanceof qn)n={update:qr(t,e.key,e.value)};else if(e instanceof Gn)n={delete:Rr(t,e.key)};else if(e instanceof Un)n={update:qr(t,e.key,e.data),updateMask:Jr(e.fieldMask)};else{if(!(e instanceof $n))return _();n={verify:Rr(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof In)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Tn)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof _n)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xn)return{fieldPath:e.field.canonicalString(),increment:n.It};throw _()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Cr(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_()}(t,e.precondition)),n}function jr(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?kn.updateTime(Nr(t.updateTime)):void 0!==t.exists?kn.exists(t.exists):kn.none()}(e.currentDocument):kn.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)S("REQUEST_TIME"===e.setToServerValue),n=new In;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Tn(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new _n(t)}else"increment"in e?n=new xn(t,e.increment):_();const s=H.fromServerFormat(e.fieldPath);return new Cn(s,n)}(t,e))):[];if(e.update){e.update.name;const i=Mr(t,e.update.name),r=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Ve(e.map((t=>H.fromServerFormat(t))))}(e.updateMask);return new Un(i,r,t,n,s)}return new qn(i,r,n,s)}if(e.delete){const s=Mr(t,e.delete);return new Gn(s,n)}if(e.verify){const s=Mr(t,e.verify);return new $n(s,n)}return _()}function Kr(t,e){return{documents:[Fr(t,e.path)]}}function Gr(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Fr(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Fr(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0!==t.length)return Yr(de.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Wr(t.field),direction:Qr(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.yt||Dt(e)?e:{value:e}}(t,e.limit);var u;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function $r(t){let e=Lr(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){S(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=li(t);return e instanceof de&&ge(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Ce(Xr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let u=null;n.limit&&(u=function(t){let e;return e="object"==typeof t?t.value:t,Dt(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ae(n,e)}(n.startAt));let a=null;return n.endAt&&(a=function(t){const e=!t.before,n=t.values||[];return new ae(n,e)}(n.endAt)),Xe(e,i,o,r,u,"F",c,a)}function li(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Xr(t.unaryFilter.field);return le.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Xr(t.unaryFilter.field);return le.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Xr(t.unaryFilter.field);return le.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Xr(t.unaryFilter.field);return le.create(i,"!=",{nullValue:"NULL_VALUE"});default:return _()}}(t):void 0!==t.fieldFilter?function(t){return le.create(Xr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return de.create(t.compositeFilter.filters.map((t=>li(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return _()}}(t.compositeFilter.op))}(t):_()}function Qr(t){return Er[t]}function zr(t){return _r[t]}function Hr(t){return Sr[t]}function Wr(t){return{fieldPath:t.canonicalString()}}function Xr(t){return H.fromServerFormat(t.fieldPath)}function Yr(t){return t instanceof le?function(t){if("=="===t.op){if(Zt(t.value))return{unaryFilter:{field:Wr(t.field),op:"IS_NAN"}};if(Jt(t.value))return{unaryFilter:{field:Wr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Zt(t.value))return{unaryFilter:{field:Wr(t.field),op:"IS_NOT_NAN"}};if(Jt(t.value))return{unaryFilter:{field:Wr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wr(t.field),op:zr(t.op),value:t.value}}}(t):t instanceof de?function(t){const e=t.getFilters().map((t=>Yr(t)));return 1===e.length?e[0]:{compositeFilter:{op:Hr(t.op),filters:e}}}(t):_()}function Jr(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Zr(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ts(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=ns(e)),e=es(t.get(n),e);return ns(e)}function es(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function ns(t){return t+""}function rs(t){const e=t.length;if(S(e>=2),2===e)return S(""===t.charAt(0)&&""===t.charAt(1)),rt.emptyPath();const n=e-2,s=[];let i="";for(let r=0;r<e;){const e=t.indexOf("",r);switch((e<0||e>n)&&_(),t.charAt(e+1)){case"":const n=t.substring(r,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),s.push(o);break;case"":i+=t.substring(r,e),i+="\0";break;case"":i+=t.substring(r,e+1);break;default:_()}r=e+2}return new rt(s)}const ss=["userId","batchId"];function is(t,e){return[t,ts(e)]}function os(t,e,n){return[t,ts(e),n]}const as={},us=["prefixPath","collectionGroup","readTime","documentId"],cs=["prefixPath","collectionGroup","documentId"],hs=["collectionGroup","readTime","prefixPath","documentId"],ls=["canonicalId","targetId"],ds=["targetId","path"],fs=["path","targetId"],ms=["collectionId","parent"],gs=["indexId","uid"],ps=["uid","sequenceNumber"],ys=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ws=["indexId","uid","orderedDocumentKey"],vs=["userId","collectionPath","documentId"],bs=["userId","collectionPath","largestBatchId"],Is=["userId","collectionGroup","largestBatchId"],Ts=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Es=[...Ts,"documentOverlays"],_s=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ss=_s,xs=[...Ss,"indexConfiguration","indexState","indexEntries"];class Ds extends ot{constructor(t,e){super(),this.re=t,this.currentSequenceNumber=e}}function As(t,e){const n=D(t);return ht.M(n.re,e)}class Cs{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Fn(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ln(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ln(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ir();return this.mutations.forEach((s=>{const i=t.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=e.has(s.key)?null:o;const u=Mn(r,o);null!==u&&n.set(s.key,u),r.isValidDocument()||r.convertToNoDocument($.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),cr())}isEqual(t){return this.batchId===t.batchId&&j(this.mutations,t.mutations,((t,e)=>Pn(t,e)))&&j(this.baseMutations,t.baseMutations,((t,e)=>Pn(t,e)))}}class Ns{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){S(t.mutations.length===n.length);let s=ar;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new Ns(t,e,n,s)}}class ks{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Os{constructor(t,e,n,s,i=$.min(),r=$.min(),o=Ot.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Os(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Os(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Os(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Rs{constructor(t){this.oe=t}}function Ms(t,e){const n=e.key,s={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fs(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(t,e){return{name:Rr(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Dr(t,e.version.toTimestamp()),createTime:Dr(t,e.createTime.toTimestamp())}}(t.oe,e);else if(e.isNoDocument())s.noDocument={path:n.path.toArray(),readTime:Ls(e.version)};else{if(!e.isUnknownDocument())return _();s.unknownDocument={path:n.path.toArray(),version:Ls(e.version)}}return s}function Fs(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ls(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Vs(t){const e=new G(t.seconds,t.nanoseconds);return $.fromTimestamp(e)}function Ps(t,e){const n=(e.baseMutations||[]).map((e=>jr(t.oe,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>jr(t.oe,e))),i=G.fromMillis(e.localWriteTimeMs);return new Cs(e.batchId,i,n,s)}function qs(t){const e=Vs(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Vs(t.lastLimboFreeSnapshotVersion):$.min();let s;var i;return void 0!==t.query.documents?(S(1===(i=t.query).documents.length),s=rn(Ye(Lr(i.documents[0])))):s=function(t){return rn($r(t))}(t.query),new Os(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Ot.fromBase64String(t.resumeToken))}function Us(t,e){const n=Ls(e.snapshotVersion),s=Ls(e.lastLimboFreeSnapshotVersion);let i;i=$e(e.target)?Kr(t.oe,e.target):Gr(t.oe,e.target);const r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ke(e.target),readTime:n,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:i}}function Bs(t){const e=$r({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?on(e,e.limit,"L"):e}function js(t,e){return new ks(e.largestBatchId,jr(t.oe,e.overlayMutation))}function hr(t,e){const n=e.path.lastSegment();return[t,ts(e.path.popLast()),n]}function Ks(t,e,n,s){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:Ls(s.readTime),documentKey:ts(s.documentKey.path),largestBatchId:s.largestBatchId}}class Gs{getBundleMetadata(t,e){return $s(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:Vs(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return $s(t).put({bundleId:(n=e).id,createTime:Ls(Nr(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return Qs(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Bs(e.bundledQuery),readTime:Vs(e.readTime)};var e}))}saveNamedQuery(t,e){return Qs(t).put(function(t){return{name:t.name,readTime:Ls(Nr(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function $s(t){return As(t,"bundles")}function Qs(t){return As(t,"namedQueries")}class zs{constructor(t,e){this.Tt=t,this.userId=e}static ue(t,e){const n=e.uid||"";return new zs(t,n)}getOverlay(t,e){return Hs(t).get(hr(this.userId,e)).next((t=>t?js(this.Tt,t):null))}getOverlays(t,e){const n=sr();return ut.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((n,i)=>{const r=new ks(e,i);s.push(this.ce(t,r))})),ut.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((t=>s.add(ts(t.getCollectionPath()))));const i=[];return s.forEach((e=>{const s=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(Hs(t).Y("collectionPathOverlayIndex",s))})),ut.waitFor(i)}getOverlaysForCollection(t,e,n){const s=sr(),i=ts(e),r=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hs(t).W("collectionPathOverlayIndex",r).next((t=>{for(const e of t){const t=js(this.Tt,e);s.set(t.getKey(),t)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=sr();let r;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Hs(t).X({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=js(this.Tt,e);i.size()<s||o.largestBatchId===r?(i.set(o.getKey(),o),r=o.largestBatchId):n.done()})).next((()=>i))}ce(t,e){return Hs(t).put(function(t,e,n){const[s,i,r]=hr(e,n.mutation.key);return{userId:e,collectionPath:i,documentId:r,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Br(t.oe,n.mutation)}}(this.Tt,this.userId,e))}}function Hs(t){return As(t,"documentOverlays")}class Ws{constructor(){}ae(t,e){this.he(t,e),e.le()}he(t,e){if("nullValue"in t)this.fe(e,5);else if("booleanValue"in t)this.fe(e,10),e.de(t.booleanValue?1:0);else if("integerValue"in t)this.fe(e,15),e.de(Ft(t.integerValue));else if("doubleValue"in t){const n=Ft(t.doubleValue);isNaN(n)?this.fe(e,13):(this.fe(e,15),At(n)?e.de(0):e.de(n))}else if("timestampValue"in t){const n=t.timestampValue;this.fe(e,20),"string"==typeof n?e._e(n):(e._e(`${n.seconds||""}`),e.de(n.nanos||0))}else if("stringValue"in t)this.we(t.stringValue,e),this.me(e);else if("bytesValue"in t)this.fe(e,30),e.ge(Lt(t.bytesValue)),this.me(e);else if("referenceValue"in t)this.ye(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.fe(e,45),e.de(n.latitude||0),e.de(n.longitude||0)}else"mapValue"in t?ne(t)?this.fe(e,Number.MAX_SAFE_INTEGER):(this.pe(t.mapValue,e),this.me(e)):"arrayValue"in t?(this.Ie(t.arrayValue,e),this.me(e)):_()}we(t,e){this.fe(e,25),this.Te(t,e)}Te(t,e){e._e(t)}pe(t,e){const n=t.fields||{};this.fe(e,55);for(const t of Object.keys(n))this.we(t,e),this.he(n[t],e)}Ie(t,e){const n=t.values||[];this.fe(e,50);for(const t of n)this.he(t,e)}ye(t,e){this.fe(e,37),W.fromName(t).path.forEach((t=>{this.fe(e,60),this.Te(t,e)}))}fe(t,e){t.de(e)}me(t){t.de(2)}}function Xs(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function Ys(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const s=Xs(255&t[n]);if(e+=s,8!==s)break}return e}(t);return Math.ceil(e/8)}Ws.Ee=new Ws;class Js{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ae(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Re(n.value),n=e.next();this.Pe()}ve(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.be(n.value),n=e.next();this.Ve()}Se(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Re(t);else if(t<2048)this.Re(960|t>>>6),this.Re(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Re(480|t>>>12),this.Re(128|63&t>>>6),this.Re(128|63&t);else{const t=e.codePointAt(0);this.Re(240|t>>>18),this.Re(128|63&t>>>12),this.Re(128|63&t>>>6),this.Re(128|63&t)}}this.Pe()}De(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.be(t);else if(t<2048)this.be(960|t>>>6),this.be(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.be(480|t>>>12),this.be(128|63&t>>>6),this.be(128|63&t);else{const t=e.codePointAt(0);this.be(240|t>>>18),this.be(128|63&t>>>12),this.be(128|63&t>>>6),this.be(128|63&t)}}this.Ve()}Ce(t){const e=this.xe(t),n=Ys(e);this.Ne(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}ke(t){const e=this.xe(t),n=Ys(e);this.Ne(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}$e(){this.Me(255),this.Me(255)}Oe(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(t){this.Ne(t.length),this.buffer.set(t,this.position),this.position+=t.length}Be(){return this.buffer.slice(0,this.position)}xe(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}Re(t){const e=255&t;0===e?(this.Me(0),this.Me(255)):255===e?(this.Me(255),this.Me(0)):this.Me(e)}be(t){const e=255&t;0===e?(this.Fe(0),this.Fe(255)):255===e?(this.Fe(255),this.Fe(0)):this.Fe(t)}Pe(){this.Me(0),this.Me(1)}Ve(){this.Fe(0),this.Fe(1)}Me(t){this.Ne(1),this.buffer[this.position++]=t}Fe(t){this.Ne(1),this.buffer[this.position++]=~t}Ne(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class Zs{constructor(t){this.Le=t}ge(t){this.Le.Ae(t)}_e(t){this.Le.Se(t)}de(t){this.Le.Ce(t)}le(){this.Le.$e()}}class ti{constructor(t){this.Le=t}ge(t){this.Le.ve(t)}_e(t){this.Le.De(t)}de(t){this.Le.ke(t)}le(){this.Le.Oe()}}class ei{constructor(){this.Le=new Js,this.qe=new Zs(this.Le),this.Ue=new ti(this.Le)}seed(t){this.Le.seed(t)}Ke(t){return 0===t?this.qe:this.Ue}Be(){return this.Le.Be()}reset(){this.Le.reset()}}class ni{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}Ge(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new ni(this.indexId,this.documentKey,this.arrayValue,n)}}function ri(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=si(t.arrayValue,e.arrayValue),0!==n?n:(n=si(t.directionalValue,e.directionalValue),0!==n?n:W.comparator(t.documentKey,e.documentKey)))}function si(t,e){for(let n=0;n<t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}class br{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Qe=t.orderBy,this.je=[];for(const e of t.filters){const t=e;t.isInequality()?this.ze=t:this.je.push(t)}}We(t){S(t.collectionGroup===this.collectionId);const e=Y(t);if(void 0!==e&&!this.He(e))return!1;const n=J(t);let s=0,i=0;for(;s<n.length&&this.He(n[s]);++s);if(s===n.length)return!0;if(void 0!==this.ze){const t=n[s];if(!this.Je(this.ze,t)||!this.Ye(this.Qe[i++],t))return!1;++s}for(;s<n.length;++s){const t=n[s];if(i>=this.Qe.length||!this.Ye(this.Qe[i++],t))return!1}return!0}He(t){for(const e of this.je)if(this.Je(e,t))return!0;return!1}Je(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}Ye(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}function ii(t){var e,n;if(S(t instanceof le||t instanceof de),t instanceof le){if(t instanceof xe){const s=(null===(n=null===(e=t.value.arrayValue)||void 0===e?void 0:e.values)||void 0===n?void 0:n.map((e=>le.create(t.field,"==",e))))||[];return de.create(s,"or")}return t}const s=t.filters.map((t=>ii(t)));return de.create(s,t.op)}function oi(t){if(0===t.getFilters().length)return[];const e=hi(ii(t));return S(ci(e)),ai(e)||ui(e)?[e]:e.getFilters()}function ai(t){return t instanceof le}function ui(t){return t instanceof de&&ge(t)}function ci(t){return ai(t)||ui(t)||function(t){if(t instanceof de&&me(t)){for(const e of t.getFilters())if(!ai(e)&&!ui(e))return!1;return!0}return!1}(t)}function hi(t){if(S(t instanceof le||t instanceof de),t instanceof le)return t;if(1===t.filters.length)return hi(t.filters[0]);const e=t.filters.map((t=>hi(t)));let n=de.create(e,t.op);return n=mi(n),ci(n)?n:(S(n instanceof de),S(fe(n)),S(n.filters.length>1),n.filters.reduce(((t,e)=>di(t,e))))}function di(t,e){let n;return S(t instanceof le||t instanceof de),S(e instanceof le||e instanceof de),n=t instanceof le?e instanceof le?function(t,e){return de.create([t,e],"and")}(t,e):fi(t,e):e instanceof le?fi(e,t):function(t,e){if(S(t.filters.length>0&&e.filters.length>0),fe(t)&&fe(e))return ve(t,e.getFilters());const n=me(t)?t:e,s=me(t)?e:t,i=n.filters.map((t=>di(t,s)));return de.create(i,"or")}(t,e),mi(n)}function fi(t,e){if(fe(e))return ve(e,t.getFilters());{const n=e.filters.map((e=>di(t,e)));return de.create(n,"or")}}function mi(t){if(S(t instanceof le||t instanceof de),t instanceof le)return t;const e=t.getFilters();if(1===e.length)return mi(e[0]);if(pe(t))return t;const n=e.map((t=>mi(t))),s=[];return n.forEach((e=>{e instanceof le?s.push(e):e instanceof de&&(e.op===t.op?s.push(...e.filters):s.push(e))})),1===s.length?s[0]:de.create(s,t.op)}class gi{constructor(){this.Ze=new pi}addToCollectionParentIndex(t,e){return this.Ze.add(e),ut.resolve()}getCollectionParents(t,e){return ut.resolve(this.Ze.getEntries(e))}addFieldIndex(t,e){return ut.resolve()}deleteFieldIndex(t,e){return ut.resolve()}getDocumentsMatchingTarget(t,e){return ut.resolve(null)}getIndexType(t,e){return ut.resolve(0)}getFieldIndexes(t,e){return ut.resolve([])}getNextCollectionGroupToUpdate(t){return ut.resolve(null)}getMinOffset(t,e){return ut.resolve(nt.min())}getMinOffsetFromCollectionGroup(t,e){return ut.resolve(nt.min())}updateCollectionGroup(t,e,n){return ut.resolve()}updateIndexEntries(t,e){return ut.resolve()}}class pi{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Me(rt.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Me(rt.comparator)).toArray()}}const yi=new Uint8Array(0);class wi{constructor(t,e){this.user=t,this.databaseId=e,this.Xe=new pi,this.tn=new Yn((t=>Ke(t)),((t,e)=>Ge(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Xe.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.Xe.add(e)}));const i={collectionId:n,parent:ts(s)};return vi(t).put(i)}return ut.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[K(e),""],!1,!0);return vi(t).W(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(rs(s.parent))}return n}))}addFieldIndex(t,e){const n=Ii(t),s=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete s.indexId;const i=n.add(s);if(e.indexState){const n=Ti(t);return i.next((t=>{n.put(Ks(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=Ii(t),s=Ti(t),i=bi(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=bi(t);let s=!0;const i=new Map;return ut.forEach(this.en(e),(e=>this.nn(t,e).next((t=>{s&&(s=!!t),i.set(e,t)})))).next((()=>{if(s){let t=cr();const s=[];return ut.forEach(i,((i,r)=>{var o;v("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${Ke(e)}`);const u=function(t,e){const n=Y(e);if(void 0===n)return null;for(const e of Qe(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(r,i),c=function(t,e){const n=new Map;for(const s of J(e))for(const e of Qe(t,s.fieldPath))switch(e.op){case"==":case"in":n.set(s.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(s.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(r,i),a=function(t,e){const n=[];let s=!0;for(const i of J(e)){const e=0===i.kind?ze(t,i.fieldPath,t.startAt):He(t,i.fieldPath,t.startAt);n.push(e.value),s&&(s=e.inclusive)}return new ae(n,s)}(r,i),h=function(t,e){const n=[];let s=!0;for(const i of J(e)){const e=0===i.kind?He(t,i.fieldPath,t.endAt):ze(t,i.fieldPath,t.endAt);n.push(e.value),s&&(s=e.inclusive)}return new ae(n,s)}(r,i),l=this.sn(i,r,a),d=this.sn(i,r,h),f=this.rn(i,r,c),m=this.on(i.indexId,u,l,a.inclusive,d,h.inclusive,f);return ut.forEach(m,(i=>n.J(i,e.limit).next((e=>{e.forEach((e=>{const n=W.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),s.push(n))}))}))))})).next((()=>s))}return ut.resolve(null)}))}en(t){let e=this.tn.get(t);return e||(e=0===t.filters.length?[t]:oi(de.create(t.filters,"and")).map((e=>je(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt))),this.tn.set(t,e),e)}on(t,e,n,s,i,r,o){const u=(null!=e?e.length:1)*Math.max(n.length,i.length),c=u/(null!=e?e.length:1),a=[];for(let h=0;h<u;++h){const u=e?this.un(e[h/c]):yi,l=this.cn(t,u,n[h%c],s),d=this.an(t,u,i[h%c],r),f=o.map((e=>this.cn(t,u,e,!0)));a.push(...this.createRange(l,d,f))}return a}cn(t,e,n,s){const i=new ni(t,W.empty(),e,n);return s?i:i.Ge()}an(t,e,n,s){const i=new ni(t,W.empty(),e,n);return s?i.Ge():i}nn(t,e){const n=new br(e),s=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((t=>{let e=null;for(const s of t)n.We(s)&&(!e||s.fields.length>e.fields.length)&&(e=s);return e}))}getIndexType(t,e){let n=2;const s=this.en(e);return ut.forEach(s,(e=>this.nn(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new Me(H.comparator),n=!1;for(const s of t.filters)for(const t of s.getFlattenedFilters())t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field));for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>function(t){return null!==t.limit}(e)&&s.length>1&&2===n?1:n))}hn(t,e){const n=new ei;for(const s of J(t)){const t=e.data.field(s.fieldPath);if(null==t)return null;const i=n.Ke(s.kind);Ws.Ee.ae(t,i)}return n.Be()}un(t){const e=new ei;return Ws.Ee.ae(t,e.Ke(0)),e.Be()}ln(t,e){const n=new ei;return Ws.Ee.ae(Wt(this.databaseId,e),n.Ke(function(t){const e=J(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Be()}rn(t,e,n){if(null===n)return[];let s=[];s.push(new ei);let i=0;for(const r of J(t)){const t=n[i++];for(const n of s)if(this.fn(e,r.fieldPath)&&Yt(t))s=this.dn(s,r,t);else{const e=n.Ke(r.kind);Ws.Ee.ae(t,e)}}return this._n(s)}sn(t,e,n){return this.rn(t,e,n.position)}_n(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Be();return e}dn(t,e,n){const s=[...t],i=[];for(const t of n.arrayValue.values||[])for(const n of s){const s=new ei;s.seed(n.Be()),Ws.Ee.ae(t,s.Ke(e.kind)),i.push(s)}return i}fn(t,e){return!!t.filters.find((t=>t instanceof le&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Ii(t),s=Ti(t);return(e?n.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.W()).next((t=>{const e=[];return ut.forEach(t,(t=>s.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new Z(e.sequenceNumber,new nt(Vs(e.readTime),new W(rs(e.documentKey)),e.largestBatchId)):Z.empty(),s=t.fields.map((([t,e])=>new dt(H.fromServerFormat(t),e)));return new X(t.indexId,t.collectionGroup,s,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:B(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Ii(t),i=Ti(t);return this.wn(t).next((t=>s.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>ut.forEach(e,(e=>i.put(Ks(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return ut.forEach(e,((e,s)=>{const i=n.get(e.collectionGroup);return(i?ut.resolve(i):this.getFieldIndexes(t,e.collectionGroup)).next((i=>(n.set(e.collectionGroup,i),ut.forEach(i,(n=>this.mn(t,e,n).next((e=>{const i=this.gn(s,n);return e.isEqual(i)?ut.resolve():this.yn(t,s,n,e,i)})))))))}))}pn(t,e,n,s){return bi(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.ln(n,e.key),documentKey:e.key.path.toArray()})}In(t,e,n,s){return bi(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.ln(n,e.key),e.key.path.toArray()])}mn(t,e,n){const s=bi(t);let i=new Me(ri);return s.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.ln(n,e)])},((t,s)=>{i=i.add(new ni(n.indexId,e,s.arrayValue,s.directionalValue))})).next((()=>i))}gn(t,e){let n=new Me(ri);const s=this.hn(e,t);if(null==s)return n;const i=Y(e);if(null!=i){const r=t.data.field(i.fieldPath);if(Yt(r))for(const i of r.arrayValue.values||[])n=n.add(new ni(e.indexId,t.key,this.un(i),s))}else n=n.add(new ni(e.indexId,t.key,yi,s));return n}yn(t,e,n,s,i){v("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const r=[];return function(t,e,n,s,i){const r=t.getIterator(),o=e.getIterator();let u=Le(r),c=Le(o);for(;u||c;){let t=!1,e=!1;if(u&&c){const s=n(u,c);s<0?e=!0:s>0&&(t=!0)}else null!=u?e=!0:t=!0;t?(s(c),c=Le(o)):e?(i(u),u=Le(r)):(u=Le(r),c=Le(o))}}(s,i,ri,(s=>{r.push(this.pn(t,e,n,s))}),(s=>{r.push(this.In(t,e,n,s))})),ut.waitFor(r)}wn(t){let e=1;return Ti(t).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,s)=>{s.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>ri(t,e))).filter(((t,e,n)=>!e||0!==ri(t,n[e-1])));const s=[];s.push(t);for(const i of n){const n=ri(i,t),r=ri(i,e);if(0===n)s[0]=t.Ge();else if(n>0&&r<0)s.push(i),s.push(i.Ge());else if(r>0)break}s.push(e);const i=[];for(let t=0;t<s.length;t+=2){if(this.Tn(s[t],s[t+1]))return[];const e=[s[t].indexId,this.uid,s[t].arrayValue,s[t].directionalValue,yi,[]],n=[s[t+1].indexId,this.uid,s[t+1].arrayValue,s[t+1].directionalValue,yi,[]];i.push(IDBKeyRange.bound(e,n))}return i}Tn(t,e){return ri(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Ei)}getMinOffset(t,e){return ut.mapArray(this.en(e),(e=>this.nn(t,e).next((t=>t||_())))).next(Ei)}}function vi(t){return As(t,"collectionParents")}function bi(t){return As(t,"indexEntries")}function Ii(t){return As(t,"indexConfiguration")}function Ti(t){return As(t,"indexState")}function Ei(t){S(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let s=1;s<t.length;s++){const i=t[s].indexState.offset;st(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new nt(e.readTime,e.documentKey,n)}const _i={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Si{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Si(t,Si.DEFAULT_COLLECTION_PERCENTILE,Si.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function xi(t,e,n){const s=t.store("mutations"),i=t.store("documentMutations"),r=[],o=IDBKeyRange.only(n.batchId);let u=0;const c=s.X({range:o},((t,e,n)=>(u++,n.delete())));r.push(c.next((()=>{S(1===u)})));const a=[];for(const t of n.mutations){const s=os(e,t.key.path,n.batchId);r.push(i.delete(s)),a.push(t.key)}return ut.waitFor(r).next((()=>a))}function Di(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _();e=t.noDocument}return JSON.stringify(e).length}Si.DEFAULT_COLLECTION_PERCENTILE=10,Si.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Si.DEFAULT=new Si(41943040,Si.DEFAULT_COLLECTION_PERCENTILE,Si.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Si.DISABLED=new Si(-1,0,0);class Ai{constructor(t,e,n,s){this.userId=t,this.Tt=e,this.indexManager=n,this.referenceDelegate=s,this.En={}}static ue(t,e,n,s){S(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new Ai(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ni(t).X({index:"userMutationsIndex",range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=ki(t),r=Ni(t);return r.add({}).next((o=>{S("number"==typeof o);const u=new Cs(o,e,n,s),c=function(t,e,n){const s=n.baseMutations.map((e=>Br(t.oe,e))),i=n.mutations.map((e=>Br(t.oe,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:s,mutations:i}}(this.Tt,this.userId,u),a=[];let h=new Me(((t,e)=>B(t.canonicalString(),e.canonicalString())));for(const t of s){const e=os(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),a.push(r.put(c)),a.push(i.put(e,as))}return h.forEach((e=>{a.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.En[o]=u.keys()})),ut.waitFor(a).next((()=>u))}))}lookupMutationBatch(t,e){return Ni(t).get(e).next((t=>t?(S(t.userId===this.userId),Ps(this.Tt,t)):null))}An(t,e){return this.En[e]?ut.resolve(this.En[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.En[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ni(t).X({index:"userMutationsIndex",range:s},((t,e,s)=>{e.userId===this.userId&&(S(e.batchId>=n),i=Ps(this.Tt,e)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ni(t).X({index:"userMutationsIndex",range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ni(t).W("userMutationsIndex",e).next((t=>t.map((t=>Ps(this.Tt,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=is(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return ki(t).X({range:s},((n,s,r)=>{const[o,u,c]=n,a=rs(u);if(o===this.userId&&e.path.isEqual(a))return Ni(t).get(c).next((t=>{if(!t)throw _();S(t.userId===this.userId),i.push(Ps(this.Tt,t))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Me(B);const s=[];return e.forEach((e=>{const i=is(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=ki(t).X({range:r},((t,s,i)=>{const[r,o,u]=t,c=rs(o);r===this.userId&&e.path.isEqual(c)?n=n.add(u):i.done()}));s.push(o)})),ut.waitFor(s).next((()=>this.Rn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=is(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new Me(B);return ki(t).X({range:r},((t,e,i)=>{const[r,u,c]=t,a=rs(u);r===this.userId&&n.isPrefixOf(a)?a.length===s&&(o=o.add(c)):i.done()})).next((()=>this.Rn(t,o)))}Rn(t,e){const n=[],s=[];return e.forEach((e=>{s.push(Ni(t).get(e).next((t=>{if(null===t)throw _();S(t.userId===this.userId),n.push(Ps(this.Tt,t))})))})),ut.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return xi(t.re,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Pn(e.batchId)})),ut.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Pn(t){delete this.En[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return ut.resolve();const n=IDBKeyRange.lowerBound([this.userId]),s=[];return ki(t).X({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=rs(t[1]);s.push(e)}else n.done()})).next((()=>{S(0===s.length)}))}))}containsKey(t,e){return Ci(t,this.userId,e)}vn(t){return Oi(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Ci(t,e,n){const s=is(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return ki(t).X({range:r,Z:!0},((t,n,s)=>{const[r,u,c]=t;r===e&&u===i&&(o=!0),s.done()})).next((()=>o))}function Ni(t){return As(t,"mutations")}function ki(t){return As(t,"documentMutations")}function Oi(t){return As(t,"mutationQueues")}class Ri{constructor(t){this.bn=t}next(){return this.bn+=2,this.bn}static Vn(){return new Ri(0)}static Sn(){return new Ri(-1)}}class Mi{constructor(t,e){this.referenceDelegate=t,this.Tt=e}allocateTargetId(t){return this.Dn(t).next((e=>{const n=new Ri(e.highestTargetId);return e.highestTargetId=n.next(),this.Cn(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Dn(t).next((t=>$.fromTimestamp(new G(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Dn(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Dn(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Cn(t,s))))}addTargetData(t,e){return this.xn(t,e).next((()=>this.Dn(t).next((n=>(n.targetCount+=1,this.Nn(e,n),this.Cn(t,n))))))}updateTargetData(t,e){return this.xn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Fi(t).delete(e.targetId))).next((()=>this.Dn(t))).next((e=>(S(e.targetCount>0),e.targetCount-=1,this.Cn(t,e))))}removeTargets(t,e,n){let s=0;const i=[];return Fi(t).X(((r,o)=>{const u=qs(o);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(s++,i.push(this.removeTargetData(t,u)))})).next((()=>ut.waitFor(i))).next((()=>s))}forEachTarget(t,e){return Fi(t).X(((t,n)=>{const s=qs(n);e(s)}))}Dn(t){return Li(t).get("targetGlobalKey").next((t=>(S(null!==t),t)))}Cn(t,e){return Li(t).put("targetGlobalKey",e)}xn(t,e){return Fi(t).put(Us(this.Tt,e))}Nn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Dn(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Ke(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Fi(t).X({range:s,index:"queryTargetsIndex"},((t,n,s)=>{const r=qs(n);Ge(e,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=Vi(t);return e.forEach((e=>{const r=ts(e.path);s.push(i.put({targetId:n,path:r})),s.push(this.referenceDelegate.addReference(t,n,e))})),ut.waitFor(s)}removeMatchingKeys(t,e,n){const s=Vi(t);return ut.forEach(e,(e=>{const i=ts(e.path);return ut.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Vi(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Vi(t);let i=cr();return s.X({range:n,Z:!0},((t,e,n)=>{const s=rs(t[1]),r=new W(s);i=i.add(r)})).next((()=>i))}containsKey(t,e){const n=ts(e.path),s=IDBKeyRange.bound([n],[K(n)],!1,!0);let i=0;return Vi(t).X({index:"documentTargetsIndex",Z:!0,range:s},(([t,e],n,s)=>{0!==t&&(i++,s.done())})).next((()=>i>0))}ie(t,e){return Fi(t).get(e).next((t=>t?qs(t):null))}}function Fi(t){return As(t,"targets")}function Li(t){return As(t,"targetGlobal")}function Vi(t){return As(t,"targetDocuments")}function Pi([t,e],[n,s]){const i=B(t,n);return 0===i?B(e,s):i}class qi{constructor(t){this.kn=t,this.buffer=new Me(Pi),this.$n=0}Mn(){return++this.$n}On(t){const e=[t,this.Mn()];if(this.buffer.size<this.kn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Pi(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Ui{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Fn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Bn(6e4)}stop(){this.Fn&&(this.Fn.cancel(),this.Fn=null)}get started(){return null!==this.Fn}Bn(t){v("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Fn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Fn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){mt(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await at(t)}await this.Bn(3e5)}))}}class Bi{constructor(t,e){this.Ln=t,this.params=e}calculateTargetCount(t,e){return this.Ln.qn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return ut.resolve(It.at);const n=new qi(e);return this.Ln.forEachTarget(t,(t=>n.On(t.sequenceNumber))).next((()=>this.Ln.Un(t,(t=>n.On(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Ln.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Ln.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector","Garbage collection skipped; disabled"),ut.resolve(_i)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_i):this.Kn(t,e)))}getCacheSize(t){return this.Ln.getCacheSize(t)}Kn(t,e){let n,s,i,r,o,h,a;const l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,r=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,h=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(a=Date.now(),y()<=c.a.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-l}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(h-o)+"ms\n"+`\tRemoved ${t} documents in `+(a-h)+"ms\n"+`Total Duration: ${a-l}ms`),ut.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t}))))}}class ji{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Bi(t,e)}(this,e)}qn(t){const e=this.Gn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Gn(t){let e=0;return this.Un(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Un(t,e){return this.Qn(t,((t,n)=>e(n)))}addReference(t,e,n){return Ki(t,n)}removeReference(t,e,n){return Ki(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Ki(t,e)}jn(t,e){return function(t,e){let n=!1;return Oi(t).tt((s=>Ci(t,s,e).next((t=>(t&&(n=!0),ut.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Qn(t,((r,o)=>{if(o<=e){const e=this.jn(t,r).next((e=>{if(!e)return i++,n.getEntry(t,r).next((()=>(n.removeEntry(r,$.min()),Vi(t).delete([0,ts(r.path)]))))}));s.push(e)}})).next((()=>ut.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Ki(t,e)}Qn(t,e){const n=Vi(t);let s,i=It.at;return n.X({index:"documentTargetsIndex"},(([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==It.at&&e(new W(rs(s)),i),i=o,s=r):i=It.at})).next((()=>{i!==It.at&&e(new W(rs(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Ki(t,e){return Vi(t).put(function(t,e){return{targetId:0,path:ts(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class Gi{constructor(){this.changes=new Yn((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ue.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ut.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class $i{constructor(t){this.Tt=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Wi(t).put(n)}removeEntry(t,e,n){return Wi(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Fs(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.zn(t,n))))}getEntry(t,e){let n=Ue.newInvalidDocument(e);return Wi(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(Xi(e))},((t,s)=>{n=this.Wn(e,s)})).next((()=>n))}Hn(t,e){let n={size:0,document:Ue.newInvalidDocument(e)};return Wi(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(Xi(e))},((t,s)=>{n={document:this.Wn(e,s),size:Di(s)}})).next((()=>n))}getEntries(t,e){let n=Zn();return this.Jn(t,e,((t,e)=>{const s=this.Wn(t,e);n=n.insert(t,s)})).next((()=>n))}Yn(t,e){let n=Zn(),s=new ke(W.comparator);return this.Jn(t,e,((t,e)=>{const i=this.Wn(t,e);n=n.insert(t,i),s=s.insert(t,Di(e))})).next((()=>({documents:n,Zn:s})))}Jn(t,e,n){if(e.isEmpty())return ut.resolve();let s=new Me(Ji);e.forEach((t=>s=s.add(t)));const i=IDBKeyRange.bound(Xi(s.first()),Xi(s.last())),r=s.getIterator();let o=r.getNext();return Wi(t).X({index:"documentKeyIndex",range:i},((t,e,s)=>{const i=W.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&Ji(o,i)<0;)n(o,null),o=r.getNext();o&&o.isEqual(i)&&(n(o,e),o=r.hasNext()?r.getNext():null),o?s.j(Xi(o)):s.done()})).next((()=>{for(;o;)n(o,null),o=r.hasNext()?r.getNext():null}))}getDocumentsMatchingQuery(t,e,n,s){const i=e.path,r=[i.popLast().toArray(),i.lastSegment(),Fs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Wi(t).W(IDBKeyRange.bound(r,o,!0)).next((t=>{let n=Zn();for(const i of t){const t=this.Wn(W.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);t.isFoundDocument()&&(hn(e,t)||s.has(t.key))&&(n=n.insert(t.key,t))}return n}))}getAllFromCollectionGroup(t,e,n,s){let i=Zn();const r=Yi(e,n),o=Yi(e,nt.max());return Wi(t).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,o,!0)},((t,e,n)=>{const r=this.Wn(W.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);i=i.insert(r.key,r),i.size===s&&n.done()})).next((()=>i))}newChangeBuffer(t){return new zi(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Hi(t).get("remoteDocumentGlobalKey").next((t=>(S(!!t),t)))}zn(t,e){return Hi(t).put("remoteDocumentGlobalKey",e)}Wn(t,e){if(e){const t=function(t,e){let n;if(e.document)n=Ur(t.oe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=W.fromSegments(e.noDocument.path),s=Vs(e.noDocument.readTime);n=Ue.newNoDocument(t,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return _();{const t=W.fromSegments(e.unknownDocument.path),s=Vs(e.unknownDocument.version);n=Ue.newUnknownDocument(t,s)}}return e.readTime&&n.setReadTime(function(t){const e=new G(t[0],t[1]);return $.fromTimestamp(e)}(e.readTime)),n}(this.Tt,e);if(!t.isNoDocument()||!t.version.isEqual($.min()))return t}return Ue.newInvalidDocument(t)}}function Qi(t){return new $i(t)}class zi extends Gi{constructor(t,e){super(),this.Xn=t,this.trackRemovals=e,this.ts=new Yn((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new Me(((t,e)=>B(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.ts.get(i);if(e.push(this.Xn.removeEntry(t,i,o.readTime)),r.isValidDocument()){const u=Ms(this.Xn.Tt,r);s=s.add(i.path.popLast());const c=Di(u);n+=c-o.size,e.push(this.Xn.addEntry(t,i,u))}else if(n-=o.size,this.trackRemovals){const n=Ms(this.Xn.Tt,r.convertToNoDocument($.min()));e.push(this.Xn.addEntry(t,i,n))}})),s.forEach((n=>{e.push(this.Xn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.Xn.updateMetadata(t,n)),ut.waitFor(e)}getFromCache(t,e){return this.Xn.Hn(t,e).next((t=>(this.ts.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.Xn.Yn(t,e).next((({documents:t,Zn:e})=>(e.forEach(((e,n)=>{this.ts.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function Hi(t){return As(t,"remoteDocumentGlobal")}function Wi(t){return As(t,"remoteDocumentsV14")}function Xi(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Yi(t,e){const n=e.documentKey.path.toArray();return[t,Fs(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Ji(t,e){const n=t.path.toArray(),s=e.path.toArray();let i=0;for(let t=0;t<n.length-2&&t<s.length-2;++t)if(i=B(n[t],s[t]),i)return i;return i=B(n.length,s.length),i||(i=B(n[n.length-2],s[s.length-2]),i||B(n[n.length-1],s[s.length-1]))}class Zi{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class to{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Ln(n.mutation,t,Ve.empty(),G.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,cr()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=cr()){const s=sr();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=nr();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=sr();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,cr())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let i=Zn();const r=or(),o=or();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof Un)?i=i.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),Ln(o.mutation,e,o.mutation.getFieldMask(),G.now())):r.set(e.key,Ve.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Zi(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=or();let s=new ke(((t,e)=>t-e)),i=cr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Ve.empty();o=i.applyToLocalView(r,o),n.set(t,o);const u=(s.get(i.batchId)||cr()).add(t);s=s.insert(i.batchId,u)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),u=s.key,c=s.value,a=ir();c.forEach((t=>{if(!i.has(t)){const s=Mn(e.get(t),n.get(t));null!==s&&a.set(t,s),i=i.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,u,a))}return ut.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return W.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):en(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):ut.resolve(sr());let o=-1,u=i;return r.next((e=>ut.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?ut.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{u=u.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,u,e,cr()))).next((t=>({batchId:o,changes:rr(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new W(e)).next((t=>{let e=nr();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const s=e.collectionGroup;let i=nr();return this.indexManager.getCollectionParents(t,s).next((r=>ut.forEach(r,(r=>{const o=function(t,e){return new We(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s)))).next((t=>{s.forEach(((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,Ue.newInvalidDocument(s)))}));let n=nr();return t.forEach(((t,i)=>{const r=s.get(t);void 0!==r&&Ln(r.mutation,i,Ve.empty(),G.now()),hn(e,i)&&(n=n.insert(t,i))})),n}))}}class eo{constructor(t){this.Tt=t,this.es=new Map,this.ns=new Map}getBundleMetadata(t,e){return ut.resolve(this.es.get(e))}saveBundleMetadata(t,e){var n;return this.es.set(e.id,{id:(n=e).id,version:n.version,createTime:Nr(n.createTime)}),ut.resolve()}getNamedQuery(t,e){return ut.resolve(this.ns.get(e))}saveNamedQuery(t,e){return this.ns.set(e.name,function(t){return{name:t.name,query:Bs(t.bundledQuery),readTime:Nr(t.readTime)}}(e)),ut.resolve()}}class no{constructor(){this.overlays=new ke(W.comparator),this.ss=new Map}getOverlay(t,e){return ut.resolve(this.overlays.get(e))}getOverlays(t,e){const n=sr();return ut.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.ce(t,e,s)})),ut.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.ss.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.ss.delete(n)),ut.resolve()}getOverlaysForCollection(t,e,n){const s=sr(),i=e.length+1,r=new W(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return ut.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new ke(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=sr(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=sr(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return ut.resolve(o)}ce(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.ss.get(s.largestBatchId).delete(n.key);this.ss.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new ks(e,n));let i=this.ss.get(e);void 0===i&&(i=cr(),this.ss.set(e,i)),this.ss.set(e,i.add(n.key))}}class ro{constructor(){this.rs=new Me(so.os),this.us=new Me(so.cs)}isEmpty(){return this.rs.isEmpty()}addReference(t,e){const n=new so(t,e);this.rs=this.rs.add(n),this.us=this.us.add(n)}hs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ls(new so(t,e))}fs(t,e){t.forEach((t=>this.removeReference(t,e)))}ds(t){const e=new W(new rt([])),n=new so(e,t),s=new so(e,t+1),i=[];return this.us.forEachInRange([n,s],(t=>{this.ls(t),i.push(t.key)})),i}_s(){this.rs.forEach((t=>this.ls(t)))}ls(t){this.rs=this.rs.delete(t),this.us=this.us.delete(t)}ws(t){const e=new W(new rt([])),n=new so(e,t),s=new so(e,t+1);let i=cr();return this.us.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new so(t,0),n=this.rs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class so{constructor(t,e){this.key=t,this.gs=e}static os(t,e){return W.comparator(t.key,e.key)||B(t.gs,e.gs)}static cs(t,e){return B(t.gs,e.gs)||W.comparator(t.key,e.key)}}class io{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ys=1,this.ps=new Me(so.os)}checkEmpty(t){return ut.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const i=this.ys;this.ys++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Cs(i,e,n,s);this.mutationQueue.push(r);for(const e of s)this.ps=this.ps.add(new so(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ut.resolve(r)}lookupMutationBatch(t,e){return ut.resolve(this.Is(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.Ts(n),i=s<0?0:s;return ut.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ut.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(t){return ut.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new so(e,0),s=new so(e,Number.POSITIVE_INFINITY),i=[];return this.ps.forEachInRange([n,s],(t=>{const e=this.Is(t.gs);i.push(e)})),ut.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Me(B);return e.forEach((t=>{const e=new so(t,0),s=new so(t,Number.POSITIVE_INFINITY);this.ps.forEachInRange([e,s],(t=>{n=n.add(t.gs)}))})),ut.resolve(this.Es(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;W.isDocumentKey(i)||(i=i.child(""));const r=new so(new W(i),0);let o=new Me(B);return this.ps.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.gs)),!0)}),r),ut.resolve(this.Es(o))}Es(t){const e=[];return t.forEach((t=>{const n=this.Is(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){S(0===this.As(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ps;return ut.forEach(e.mutations,(s=>{const i=new so(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ps=n}))}Pn(t){}containsKey(t,e){const n=new so(e,0),s=this.ps.firstAfterOrEqual(n);return ut.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,ut.resolve()}As(t,e){return this.Ts(t)}Ts(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Is(t){const e=this.Ts(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class oo{constructor(t){this.Rs=t,this.docs=new ke(W.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.Rs(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ut.resolve(n?n.document.mutableCopy():Ue.newInvalidDocument(e))}getEntries(t,e){let n=Zn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ue.newInvalidDocument(t))})),ut.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Zn();const r=e.path,o=new W(r.child("")),u=this.docs.getIteratorFrom(o);for(;u.hasNext();){const{key:t,value:{document:o}}=u.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||st(et(o),n)<=0||(s.has(o.key)||hn(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ut.resolve(i)}getAllFromCollectionGroup(t,e,n,s){_()}Ps(t,e){return ut.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ao(this)}getSize(t){return ut.resolve(this.size)}}class ao extends Gi{constructor(t){super(),this.Xn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Xn.addEntry(t,s)):this.Xn.removeEntry(n)})),ut.waitFor(e)}getFromCache(t,e){return this.Xn.getEntry(t,e)}getAllFromCache(t,e){return this.Xn.getEntries(t,e)}}class uo{constructor(t){this.persistence=t,this.vs=new Yn((t=>Ke(t)),Ge),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.bs=0,this.Vs=new ro,this.targetCount=0,this.Ss=Ri.Vn()}forEachTarget(t,e){return this.vs.forEach(((t,n)=>e(n))),ut.resolve()}getLastRemoteSnapshotVersion(t){return ut.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ut.resolve(this.bs)}allocateTargetId(t){return this.highestTargetId=this.Ss.next(),ut.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.bs&&(this.bs=e),ut.resolve()}xn(t){this.vs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ss=new Ri(e),this.highestTargetId=e),t.sequenceNumber>this.bs&&(this.bs=t.sequenceNumber)}addTargetData(t,e){return this.xn(e),this.targetCount+=1,ut.resolve()}updateTargetData(t,e){return this.xn(e),ut.resolve()}removeTargetData(t,e){return this.vs.delete(e.target),this.Vs.ds(e.targetId),this.targetCount-=1,ut.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.vs.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.vs.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),ut.waitFor(i).next((()=>s))}getTargetCount(t){return ut.resolve(this.targetCount)}getTargetData(t,e){const n=this.vs.get(e)||null;return ut.resolve(n)}addMatchingKeys(t,e,n){return this.Vs.hs(e,n),ut.resolve()}removeMatchingKeys(t,e,n){this.Vs.fs(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),ut.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Vs.ds(e),ut.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Vs.ws(e);return ut.resolve(n)}containsKey(t,e){return ut.resolve(this.Vs.containsKey(e))}}class co{constructor(t,e){this.Ds={},this.overlays={},this.Cs=new It(0),this.xs=!1,this.xs=!0,this.referenceDelegate=t(this),this.Ns=new uo(this),this.indexManager=new gi,this.remoteDocumentCache=function(t){return new oo(t)}((t=>this.referenceDelegate.ks(t))),this.Tt=new Rs(e),this.$s=new eo(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new no,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Ds[t.toKey()];return n||(n=new io(e,this.referenceDelegate),this.Ds[t.toKey()]=n),n}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$s}runTransaction(t,e,n){v("MemoryPersistence","Starting transaction:",t);const s=new ho(this.Cs.next());return this.referenceDelegate.Ms(),n(s).next((t=>this.referenceDelegate.Os(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Fs(t,e){return ut.or(Object.values(this.Ds).map((n=>()=>n.containsKey(t,e))))}}class ho extends ot{constructor(t){super(),this.currentSequenceNumber=t}}class lo{constructor(t){this.persistence=t,this.Bs=new ro,this.Ls=null}static qs(t){return new lo(t)}get Us(){if(this.Ls)return this.Ls;throw _()}addReference(t,e,n){return this.Bs.addReference(n,e),this.Us.delete(n.toString()),ut.resolve()}removeReference(t,e,n){return this.Bs.removeReference(n,e),this.Us.add(n.toString()),ut.resolve()}markPotentiallyOrphaned(t,e){return this.Us.add(e.toString()),ut.resolve()}removeTarget(t,e){this.Bs.ds(e.targetId).forEach((t=>this.Us.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Us.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ms(){this.Ls=new Set}Os(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ut.forEach(this.Us,(n=>{const s=W.fromPath(n);return this.Ks(t,s).next((t=>{t||e.removeEntry(s,$.min())}))})).next((()=>(this.Ls=null,e.apply(t))))}updateLimboDocument(t,e){return this.Ks(t,e).next((t=>{t?this.Us.delete(e.toString()):this.Us.add(e.toString())}))}ks(t){return 0}Ks(t,e){return ut.or([()=>ut.resolve(this.Bs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Fs(t,e)])}}class fo{constructor(t){this.Tt=t}F(t,e,n,s){const i=new ct("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ss,{unique:!0}),t.createObjectStore("documentMutations")}(t),mo(t),function(t){t.createObjectStore("remoteDocuments")}(t));let r=ut.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),mo(t)),r=r.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(t,e){return e.store("mutations").W().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ss,{unique:!0});const s=e.store("mutations"),i=n.map((t=>s.put(t)));return ut.waitFor(i)}))}(t,i)))),r=r.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&s>=5&&(r=r.next((()=>this.Gs(i)))),n<6&&s>=6&&(r=r.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Qs(i))))),n<7&&s>=7&&(r=r.next((()=>this.js(i)))),n<8&&s>=8&&(r=r.next((()=>this.zs(t,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&s>=10&&(r=r.next((()=>this.Ws(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&s>=12&&(r=r.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:vs});e.createIndex("collectionPathOverlayIndex",bs,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Is,{unique:!1})}(t)}))),n<13&&s>=13&&(r=r.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:us});e.createIndex("documentKeyIndex",cs),e.createIndex("collectionGroupIndex",hs)}(t))).next((()=>this.Hs(t,i))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&s>=14&&(r=r.next((()=>this.Js(t,i)))),n<15&&s>=15&&(r=r.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:gs}).createIndex("sequenceNumberIndex",ps,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:ys}).createIndex("documentKeyIndex",ws,{unique:!1})}(t)))),r}Qs(t){let e=0;return t.store("remoteDocuments").X(((t,n)=>{e+=Di(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Gs(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.W().next((e=>ut.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",s).next((n=>ut.forEach(n,(n=>{S(n.userId===e.userId);const s=Ps(this.Tt,n);return xi(t,e.userId,s).next((()=>{}))}))))}))))}js(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const s=[];return n.X(((n,i)=>{const r=new rt(n),o=function(t){return[0,ts(t)]}(r);s.push(e.get(o).next((n=>n?ut.resolve():(n=>e.put({targetId:0,path:ts(n),sequenceNumber:t.highestListenSequenceNumber}))(r))))})).next((()=>ut.waitFor(s)))}))}zs(t,e){t.createObjectStore("collectionParents",{keyPath:ms});const n=e.store("collectionParents"),s=new pi,i=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:ts(s)})}};return e.store("remoteDocuments").X({Z:!0},((t,e)=>{const n=new rt(t);return i(n.popLast())})).next((()=>e.store("documentMutations").X({Z:!0},(([t,e,n],s)=>{const r=rs(e);return i(r.popLast())}))))}Ws(t){const e=t.store("targets");return e.X(((t,n)=>{const s=qs(n),i=Us(this.Tt,s);return e.put(i)}))}Hs(t,e){const n=e.store("remoteDocuments"),s=[];return n.X(((t,n)=>{const i=e.store("remoteDocumentsV14"),r=(o=n,o.document?new W(rt.fromString(o.document.name).popFirst(5)):o.noDocument?W.fromSegments(o.noDocument.path):o.unknownDocument?W.fromSegments(o.unknownDocument.path):_()).path.toArray();var o;const u={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};s.push(i.put(u))})).next((()=>ut.waitFor(s)))}Js(t,e){const n=e.store("mutations"),s=Qi(this.Tt),i=new co(lo.qs,this.Tt.oe);return n.W().next((t=>{const n=new Map;return t.forEach((t=>{var e;let s=null!==(e=n.get(t.userId))&&void 0!==e?e:cr();Ps(this.Tt,t).keys().forEach((t=>s=s.add(t))),n.set(t.userId,s)})),ut.forEach(n,((t,n)=>{const r=new f(n),o=zs.ue(this.Tt,r),u=i.getIndexManager(r),c=Ai.ue(r,this.Tt,u,i.referenceDelegate);return new to(s,c,o,u).recalculateAndSaveOverlaysForDocumentKeys(new Ds(e,It.at),t).next()}))}))}}function mo(t){t.createObjectStore("targetDocuments",{keyPath:ds}).createIndex("documentTargetsIndex",fs,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ls,{unique:!0}),t.createObjectStore("targetGlobal")}const go="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class po{constructor(t,e,n,s,i,r,o,u,c,a,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Ys=i,this.window=r,this.document=o,this.Zs=c,this.Xs=a,this.ti=h,this.Cs=null,this.xs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ei=null,this.inForeground=!1,this.ni=null,this.si=null,this.ii=Number.NEGATIVE_INFINITY,this.ri=t=>Promise.resolve(),!po.C())throw new C(A.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ji(this,s),this.oi=e+"main",this.Tt=new Rs(u),this.ui=new ht(this.oi,this.ti,new fo(this.Tt)),this.Ns=new Mi(this.referenceDelegate,this.Tt),this.remoteDocumentCache=Qi(this.Tt),this.$s=new Gs,this.window&&this.window.localStorage?this.ci=this.window.localStorage:(this.ci=null,!1===a&&I("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(A.FAILED_PRECONDITION,go);return this.hi(),this.li(),this.fi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Ns.getHighestSequenceNumber(t)))})).then((t=>{this.Cs=new It(t,this.Zs)})).then((()=>{this.xs=!0})).catch((t=>(this.ui&&this.ui.close(),Promise.reject(t))))}di(t){return this.ri=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ui.L((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Ys.enqueueAndForget((async()=>{this.started&&await this.ai()})))}ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>wo(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this._i(t).next((t=>{t||(this.isPrimary=!1,this.Ys.enqueueRetryable((()=>this.ri(!1))))}))})).next((()=>this.wi(t))).next((e=>this.isPrimary&&!e?this.mi(t).next((()=>!1)):!!e&&this.gi(t).next((()=>!0)))))).catch((t=>{if(mt(t))return v("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Ys.enqueueRetryable((()=>this.ri(t))),this.isPrimary=t}))}_i(t){return yo(t).get("owner").next((t=>ut.resolve(this.yi(t))))}pi(t){return wo(t).delete(this.clientId)}async Ii(){if(this.isPrimary&&!this.Ti(this.ii,18e5)){this.ii=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=As(t,"clientMetadata");return e.W().next((t=>{const n=this.Ei(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return ut.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.ci)for(const e of t)this.ci.removeItem(this.Ai(e.clientId))}}fi(){this.si=this.Ys.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ai().then((()=>this.Ii())).then((()=>this.fi()))))}yi(t){return!!t&&t.ownerId===this.clientId}wi(t){return this.Xs?ut.resolve(!0):yo(t).get("owner").next((e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)){if(this.yi(e)&&this.networkEnabled)return!0;if(!this.yi(e)){if(!e.allowTabSynchronization)throw new C(A.FAILED_PRECONDITION,go);return!1}}return!(!this.networkEnabled||!this.inForeground)||wo(t).W().next((t=>void 0===this.Ei(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xs=!1,this.Pi(),this.si&&(this.si.cancel(),this.si=null),this.vi(),this.bi(),await this.ui.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new Ds(t,It.at);return this.mi(e).next((()=>this.pi(e)))})),this.ui.close(),this.Vi()}Ei(t,e){return t.filter((t=>this.Ti(t.updateTimeMs,e)&&!this.Ri(t.clientId)))}Si(){return this.runTransaction("getActiveClients","readonly",(t=>wo(t).W().next((t=>this.Ei(t,18e5).map((t=>t.clientId))))))}get started(){return this.xs}getMutationQueue(t,e){return Ai.ue(t,this.Tt,e,this.referenceDelegate)}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new wi(t,this.Tt.oe.databaseId)}getDocumentOverlayCache(t){return zs.ue(this.Tt,t)}getBundleCache(){return this.$s}runTransaction(t,e,n){v("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite",i=15===(r=this.ti)?xs:14===r?Ss:13===r?_s:12===r?Es:11===r?Ts:void _();var r;let o;return this.ui.runTransaction(t,s,i,(s=>(o=new Ds(s,this.Cs?this.Cs.next():It.at),"readwrite-primary"===e?this._i(o).next((t=>!!t||this.wi(o))).next((e=>{if(!e)throw I(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ys.enqueueRetryable((()=>this.ri(!1))),new C(A.FAILED_PRECONDITION,it);return n(o)})).next((t=>this.gi(o).next((()=>t)))):this.Di(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}Di(t){return yo(t).get("owner").next((t=>{if(null!==t&&this.Ti(t.leaseTimestampMs,5e3)&&!this.Ri(t.ownerId)&&!this.yi(t)&&!(this.Xs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(A.FAILED_PRECONDITION,go)}))}gi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yo(t).put("owner",e)}static C(){return ht.C()}mi(t){const e=yo(t);return e.get("owner").next((t=>this.yi(t)?(v("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):ut.resolve()))}Ti(t,e){const n=Date.now();return!(t<n-e||t>n&&(I(`Detected an update time that is in the future: ${t} > ${n}`),1))}hi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ni=()=>{this.Ys.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ai())))},this.document.addEventListener("visibilitychange",this.ni),this.inForeground="visible"===this.document.visibilityState)}vi(){this.ni&&(this.document.removeEventListener("visibilitychange",this.ni),this.ni=null)}li(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ei=()=>{this.Pi();const t=/(?:Version|Mobile)\/1[456]/;Object(h.z)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Ys.enterRestrictedMode(!0),this.Ys.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ei))}bi(){this.ei&&(this.window.removeEventListener("pagehide",this.ei),this.ei=null)}Ri(t){var e;try{const n=null!==(null===(e=this.ci)||void 0===e?void 0:e.getItem(this.Ai(t)));return v("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return I("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Pi(){if(this.ci)try{this.ci.setItem(this.Ai(this.clientId),String(Date.now()))}catch(t){I("Failed to set zombie client id.",t)}}Vi(){if(this.ci)try{this.ci.removeItem(this.Ai(this.clientId))}catch(t){}}Ai(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function yo(t){return As(t,"owner")}function wo(t){return As(t,"clientMetadata")}function vo(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class bo{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Ci=n,this.xi=s}static Ni(t,e){let n=cr(),s=cr();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new bo(t,e.fromCache,n,s)}}class Io{constructor(){this.ki=!1}initialize(t,e){this.$i=t,this.indexManager=e,this.ki=!0}getDocumentsMatchingQuery(t,e,n,s){return this.Mi(t,e).next((i=>i||this.Oi(t,e,s,n))).next((n=>n||this.Fi(t,e)))}Mi(t,e){if(Je(e))return ut.resolve(null);let n=rn(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=on(e,null,"F"),n=rn(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const i=cr(...s);return this.$i.getDocuments(t,i).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.Bi(e,s);return this.Li(e,r,i,n.readTime)?this.Mi(t,on(e,null,"F")):this.qi(t,r,e,n)}))))})))))}Oi(t,e,n,s){return Je(e)||s.isEqual($.min())?this.Fi(t,e):this.$i.getDocuments(t,n).next((i=>{const r=this.Bi(e,i);return this.Li(e,r,n,s)?this.Fi(t,e):(y()<=c.a.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),cn(e)),this.qi(t,r,e,tt(s,-1)))}))}Bi(t,e){let n=new Me(dn(t));return e.forEach(((e,s)=>{hn(t,s)&&(n=n.add(s))})),n}Li(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fi(t,e){return y()<=c.a.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",cn(e)),this.$i.getDocumentsMatchingQuery(t,e,nt.min())}qi(t,e,n,s){return this.$i.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class To{constructor(t,e,n,s){this.persistence=t,this.Ui=e,this.Tt=s,this.Ki=new ke(B),this.Gi=new Yn((t=>Ke(t)),Ge),this.Qi=new Map,this.ji=t.getRemoteDocumentCache(),this.Ns=t.getTargetCache(),this.$s=t.getBundleCache(),this.zi(n)}zi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new to(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ki)))}}function Eo(t,e,n,s){return new To(t,e,n,s)}async function _o(t,e){const n=D(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((i=>(s=i,n.zi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=cr();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Wi:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function So(t){const e=D(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ns.getLastRemoteSnapshotVersion(t)))}function xo(t,e,n){let s=cr(),i=cr();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=Zn();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual($.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):v("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Hi:s,Ji:i}}))}function Do(t,e){const n=D(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function Ao(t,e){const n=D(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Ns.getTargetData(t,e).next((i=>i?(s=i,ut.resolve(s)):n.Ns.allocateTargetId(t).next((i=>(s=new Os(e,i,0,t.currentSequenceNumber),n.Ns.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ki.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ki=n.Ki.insert(t.targetId,t),n.Gi.set(e,t.targetId)),t}))}async function Co(t,e,n){const s=D(t),i=s.Ki.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!mt(t))throw t;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ki=s.Ki.remove(e),s.Gi.delete(i.target)}function No(t,e,n){const s=D(t);let i=$.min(),r=cr();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=D(t),i=s.Gi.get(n);return void 0!==i?ut.resolve(s.Ki.get(i)):s.Ns.getTargetData(e,n)}(s,t,rn(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Ns.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Ui.getDocumentsMatchingQuery(t,e,n?i:$.min(),n?r:cr()))).next((t=>(Ro(s,ln(e),t),{documents:t,Yi:r})))))}function ko(t,e){const n=D(t),s=D(n.Ns),i=n.Ki.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.ie(t,e).next((t=>t?t.target:null))))}function Oo(t,e){const n=D(t),s=n.Qi.get(e)||$.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.ji.getAllFromCollectionGroup(t,e,tt(s,-1),Number.MAX_SAFE_INTEGER))).then((t=>(Ro(n,e,t),t)))}function Ro(t,e,n){let s=t.Qi.get(e)||$.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.Qi.set(e,s)}async function Mo(t,e,n=cr()){const s=await Ao(t,rn(Bs(e.bundledQuery))),i=D(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const r=Nr(e.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i.$s.saveNamedQuery(t,e);const o=s.withResumeToken(Ot.EMPTY_BYTE_STRING,r);return i.Ki=i.Ki.insert(o.targetId,o),i.Ns.updateTargetData(t,o).next((()=>i.Ns.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>i.Ns.addMatchingKeys(t,n,s.targetId))).next((()=>i.$s.saveNamedQuery(t,e)))}))}function Fo(t,e){return`firestore_clients_${t}_${e}`}function Lo(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function Vo(t,e){return`firestore_targets_${t}_${e}`}class Po{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static er(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new C(s.error.code,s.error.message))),r?new Po(t,e,s.state,i):(I("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}nr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class qo{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static er(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new C(n.error.code,n.error.message))),i?new qo(t,n.state,s):(I("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}nr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Uo{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static er(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=dr();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Ct(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Uo(t,i):(I("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Bo{constructor(t,e){this.clientId=t,this.onlineState=e}static er(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Bo(e.clientId,e.onlineState):(I("SharedClientState",`Failed to parse online state: ${t}`),null)}}class jo{constructor(){this.activeTargetIds=dr()}sr(t){this.activeTargetIds=this.activeTargetIds.add(t)}ir(t){this.activeTargetIds=this.activeTargetIds.delete(t)}nr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ko{constructor(t,e,n,s,i){this.window=t,this.Ys=e,this.persistenceKey=n,this.rr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ur=this.cr.bind(this),this.ar=new ke(B),this.started=!1,this.hr=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.lr=Fo(this.persistenceKey,this.rr),this.dr=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.ar=this.ar.insert(this.rr,new jo),this._r=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.wr=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.mr=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.gr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.yr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.ur)}static C(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Si();for(const e of t){if(e===this.rr)continue;const t=this.getItem(Fo(this.persistenceKey,e));if(t){const n=Uo.er(e,t);n&&(this.ar=this.ar.insert(n.clientId,n))}}this.pr();const e=this.storage.getItem(this.gr);if(e){const t=this.Ir(e);t&&this.Tr(t)}for(const t of this.hr)this.cr(t);this.hr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.dr,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Er(this.ar)}isActiveQueryTarget(t){let e=!1;return this.ar.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Ar(t,"pending")}updateMutationState(t,e,n){this.Ar(t,e,n),this.Rr(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(Vo(this.persistenceKey,t));if(n){const s=qo.er(t,n);s&&(e=s.state)}}return this.Pr.sr(t),this.pr(),e}removeLocalQueryTarget(t){this.Pr.ir(t),this.pr()}isLocalQueryTarget(t){return this.Pr.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Vo(this.persistenceKey,t))}updateQueryState(t,e,n){this.vr(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Rr(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.br(t)}notifyBundleLoaded(t){this.Vr(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ur),this.removeItem(this.lr),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return v("SharedClientState","READ",t,e),e}setItem(t,e){v("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){v("SharedClientState","REMOVE",t),this.storage.removeItem(t)}cr(t){const e=t;if(e.storageArea===this.storage){if(v("SharedClientState","EVENT",e.key,e.newValue),e.key===this.lr)return void I("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ys.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this._r.test(e.key)){if(null==e.newValue){const t=this.Sr(e.key);return this.Dr(t,null)}{const t=this.Cr(e.key,e.newValue);if(t)return this.Dr(t.clientId,t)}}else if(this.wr.test(e.key)){if(null!==e.newValue){const t=this.Nr(e.key,e.newValue);if(t)return this.kr(t)}}else if(this.mr.test(e.key)){if(null!==e.newValue){const t=this.$r(e.key,e.newValue);if(t)return this.Mr(t)}}else if(e.key===this.gr){if(null!==e.newValue){const t=this.Ir(e.newValue);if(t)return this.Tr(t)}}else if(e.key===this.dr){const t=function(t){let e=It.at;if(null!=t)try{const n=JSON.parse(t);S("number"==typeof n),e=n}catch(t){I("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==It.at&&this.sequenceNumberHandler(t)}else if(e.key===this.yr){const t=this.Or(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Fr(t))))}}else this.hr.push(e)}))}}get Pr(){return this.ar.get(this.rr)}pr(){this.setItem(this.lr,this.Pr.nr())}Ar(t,e,n){const s=new Po(this.currentUser,t,e,n),i=Lo(this.persistenceKey,this.currentUser,t);this.setItem(i,s.nr())}Rr(t){const e=Lo(this.persistenceKey,this.currentUser,t);this.removeItem(e)}br(t){const e={clientId:this.rr,onlineState:t};this.storage.setItem(this.gr,JSON.stringify(e))}vr(t,e,n){const s=Vo(this.persistenceKey,t),i=new qo(t,e,n);this.setItem(s,i.nr())}Vr(t){const e=JSON.stringify(Array.from(t));this.setItem(this.yr,e)}Sr(t){const e=this._r.exec(t);return e?e[1]:null}Cr(t,e){const n=this.Sr(t);return Uo.er(n,e)}Nr(t,e){const n=this.wr.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Po.er(new f(i),s,e)}$r(t,e){const n=this.mr.exec(t),s=Number(n[1]);return qo.er(s,e)}Ir(t){return Bo.er(t)}Or(t){return JSON.parse(t)}async kr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Br(t.batchId,t.state,t.error);v("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Mr(t){return this.syncEngine.Lr(t.targetId,t.state,t.error)}Dr(t,e){const n=e?this.ar.insert(t,e):this.ar.remove(t),s=this.Er(this.ar),i=this.Er(n),r=[],o=[];return i.forEach((t=>{s.has(t)||r.push(t)})),s.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.qr(r,o).then((()=>{this.ar=n}))}Tr(t){this.ar.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Er(t){let e=dr();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class Go{constructor(){this.Ur=new jo,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Ur.sr(t),this.Kr[t]||"not-current"}updateQueryState(t,e,n){this.Kr[t]=e}removeLocalQueryTarget(t){this.Ur.ir(t)}isLocalQueryTarget(t){return this.Ur.activeTargetIds.has(t)}clearQueryState(t){delete this.Kr[t]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(t){return this.Ur.activeTargetIds.has(t)}start(){return this.Ur=new jo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class $o{Gr(t){}shutdown(){}}class Qo{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(t){this.Hr.push(t)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Hr)t(0)}Wr(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Hr)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let zo=null;function Ho(){return null===zo?zo=268435456+Math.round(2147483648*Math.random()):zo++,"0x"+zo.toString(16)}const Wo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xo{constructor(t){this.Yr=t.Yr,this.Zr=t.Zr}Xr(t){this.eo=t}no(t){this.so=t}onMessage(t){this.io=t}close(){this.Zr()}send(t){this.Yr(t)}ro(){this.eo()}oo(t){this.so(t)}uo(t){this.io(t)}}const Yo="WebChannelConnection";class Jo extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.co=e+"://"+t.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(t,e,n,s,i){const r=Ho(),o=this.fo(t,e);v("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const u={};return this._o(u,s,i),this.wo(t,o,u,n).then((e=>(v("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw T("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}mo(t,e,n,s,i,r){return this.lo(t,e,n,s,i)}_o(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+b,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}fo(t,e){const n=Wo[t];return`${this.co}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}wo(t,e,n,s){const i=Ho();return new Promise(((r,o)=>{const u=new l.g;u.setWithCredentials(!0),u.listenOnce(l.c.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case l.a.NO_ERROR:const e=u.getResponseJson();v(Yo,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),r(e);break;case l.a.TIMEOUT:v(Yo,`RPC '${t}' ${i} timed out`),o(new C(A.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=u.getStatus();if(v(Yo,`RPC '${t}' ${i} failed with status:`,n,"response text:",u.getResponseText()),n>0){let t=u.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(A).indexOf(e)>=0?e:A.UNKNOWN}(e.status);o(new C(t,e.message))}else o(new C(A.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new C(A.UNAVAILABLE,"Connection failed."));break;default:_()}}finally{v(Yo,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(s);v(Yo,`RPC '${t}' ${i} sending request:`,s),u.send(e,"POST",c,n,15)}))}yo(t,e,n){const s=Ho(),i=[this.co,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(l.h)(),o=Object(l.i)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new l.d({})),this._o(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const c=i.join("");v(Yo,`Creating RPC '${t}' stream ${s}: ${c}`,u);const a=r.createWebChannel(c,u);let h=!1,d=!1;const f=new Xo({Yr:e=>{d?v(Yo,`Not sending because RPC '${t}' stream ${s} is closed:`,e):(h||(v(Yo,`Opening RPC '${t}' stream ${s} transport.`),a.open(),h=!0),v(Yo,`RPC '${t}' stream ${s} sending:`,e),a.send(e))},Zr:()=>a.close()}),m=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return m(a,l.f.EventType.OPEN,(()=>{d||v(Yo,`RPC '${t}' stream ${s} transport opened.`)})),m(a,l.f.EventType.CLOSE,(()=>{d||(d=!0,v(Yo,`RPC '${t}' stream ${s} transport closed`),f.oo())})),m(a,l.f.EventType.ERROR,(e=>{d||(d=!0,T(Yo,`RPC '${t}' stream ${s} transport errored:`,e),f.oo(new C(A.UNAVAILABLE,"The operation could not be completed")))})),m(a,l.f.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];S(!!i);const r=i,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){v(Yo,`RPC '${t}' stream ${s} received error:`,o);const e=o.status;let n=function(t){const e=zn[t];if(void 0!==e)return Xn(e)}(e),i=o.message;void 0===n&&(n=A.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.oo(new C(n,i)),a.close()}else v(Yo,`RPC '${t}' stream ${s} received:`,i),f.uo(i)}})),m(o,l.b.STAT_EVENT,(e=>{e.stat===l.e.PROXY?v(Yo,`RPC '${t}' stream ${s} detected buffering proxy`):e.stat===l.e.NOPROXY&&v(Yo,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{f.ro()}),0),f}}function Zo(){return"undefined"!=typeof window?window:null}function ta(){return"undefined"!=typeof document?document:null}function ea(t){return new xr(t,!0)}class na{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Ys=t,this.timerId=e,this.po=n,this.Io=s,this.To=i,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}Po(){this.Eo=this.To}vo(t){this.cancel();const e=Math.floor(this.Eo+this.bo()),n=Math.max(0,Date.now()-this.Ro),s=Math.max(0,e-n);s>0&&v("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Eo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,s,(()=>(this.Ro=Date.now(),t()))),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}bo(){return(Math.random()-.5)*this.Eo}}class ra{constructor(t,e,n,s,i,r,o,u){this.Ys=t,this.So=n,this.Do=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new na(t,e)}$o(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.$o()&&await this.close(0)}Fo(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,(()=>this.Lo())))}qo(t){this.Uo(),this.stream.send(t)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(t,e){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,4!==t?this.ko.reset():e&&e.code===A.RESOURCE_EXHAUSTED?(I(e.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.ko.Po()):e&&e.code===A.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Go(),this.stream.close(),this.stream=null),this.state=t,await this.listener.no(e)}Go(){}auth(){this.state=1;const t=this.Qo(this.Co),e=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Co===e&&this.jo(t,n)}),(e=>{t((()=>{const t=new C(A.UNKNOWN,"Fetching auth token failed: "+e.message);return this.zo(t)}))}))}jo(t,e){const n=this.Qo(this.Co);this.stream=this.Wo(t,e),this.stream.Xr((()=>{n((()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.no((t=>{n((()=>this.zo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Oo(){this.state=5,this.ko.vo((async()=>{this.state=0,this.start()}))}zo(t){return v("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Qo(t){return e=>{this.Ys.enqueueAndForget((()=>this.Co===t?e():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class sa extends ra{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.Tt=i}Wo(t,e){return this.connection.yo("Listen",t,e)}onMessage(t){this.ko.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.yt?(S(void 0===e||"string"==typeof e),Ot.fromBase64String(e||"")):(S(void 0===e||e instanceof Uint8Array),Ot.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(t){const e=void 0===t.code?A.UNKNOWN:Xn(t.code);return new C(e,t.message||"")}(o);n=new yr(s,i,r,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Mr(t,s.document.name),r=Nr(s.document.updateTime),o=s.document.createTime?Nr(s.document.createTime):$.min(),u=new Pe({mapValue:{fields:s.document.fields}}),c=Ue.newFoundDocument(i,r,o,u),a=s.targetIds||[],h=s.removedTargetIds||[];n=new gr(a,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Mr(t,s.document),r=s.readTime?Nr(s.readTime):$.min(),o=Ue.newNoDocument(i,r),u=s.removedTargetIds||[];n=new gr([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Mr(t,s.document),r=s.removedTargetIds||[];n=new gr([],r,i,null)}else{if(!("filter"in e))return _();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Qn(s),r=t.targetId;n=new pr(r,i)}}return n}(this.Tt,t),n=function(t){if(!("targetChange"in t))return $.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?$.min():e.readTime?Nr(e.readTime):$.min()}(t);return this.listener.Ho(e,n)}Jo(t){const e={};e.database=Vr(this.Tt),e.addTarget=function(t,e){let n;const s=e.target;return n=$e(s)?{documents:Kr(t,s)}:{query:Gr(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Ar(t,e.resumeToken):e.snapshotVersion.compareTo($.min())>0&&(n.readTime=Dr(t,e.snapshotVersion.toTimestamp())),n}(this.Tt,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.Tt,t);n&&(e.labels=n),this.qo(e)}Yo(t){const e={};e.database=Vr(this.Tt),e.removeTarget=t,this.qo(e)}}class ia extends ra{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.Tt=i,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(t,e){return this.connection.yo("Write",t,e)}onMessage(t){if(S(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Zo){this.ko.reset();const e=function(t,e){return t&&t.length>0?(S(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Nr(t.updateTime):Nr(e);return n.isEqual($.min())&&(n=Nr(e)),new Nn(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Nr(t.commitTime);return this.listener.eu(n,e)}return S(!t.writeResults||0===t.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const t={};t.database=Vr(this.Tt),this.qo(t)}tu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Br(this.Tt,t)))};this.qo(e)}}class oa extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.Tt=s,this.iu=!1}ru(){if(this.iu)throw new C(A.FAILED_PRECONDITION,"The client has already been terminated.")}lo(t,e,n){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.lo(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new C(A.UNKNOWN,t.toString())}))}mo(t,e,n,s){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.mo(t,e,n,i,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new C(A.UNKNOWN,t.toString())}))}terminate(){this.iu=!0}}class aa{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve()))))}fu(t){"Online"===this.state?this.hu("Unknown"):(this.ou++,this.ou>=1&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.hu("Offline")))}set(t){this.du(),this.ou=0,"Online"===t&&(this.cu=!1),this.hu(t)}hu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}lu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(I(e),this.cu=!1):v("OnlineStateTracker",e)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class ua{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=i,this.yu.Gr((t=>{n.enqueueAndForget((async()=>{ya(this)&&(v("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=D(t);e.mu.add(4),await ha(e),e.pu.set("Unknown"),e.mu.delete(4),await ca(e)}(this))}))})),this.pu=new aa(n,s)}}async function ca(t){if(ya(t))for(const e of t.gu)await e(!0)}async function ha(t){for(const e of t.gu)await e(!1)}function la(t,e){const n=D(t);n.wu.has(e.targetId)||(n.wu.set(e.targetId,e),pa(n)?ga(n):Fa(n).Mo()&&fa(n,e))}function da(t,e){const n=D(t),s=Fa(n);n.wu.delete(e),s.Mo()&&ma(n,e),0===n.wu.size&&(s.Mo()?s.Bo():ya(n)&&n.pu.set("Unknown"))}function fa(t,e){t.Iu.Ot(e.targetId),Fa(t).Jo(e)}function ma(t,e){t.Iu.Ot(e),Fa(t).Yo(e)}function ga(t){t.Iu=new vr({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ie:e=>t.wu.get(e)||null}),Fa(t).start(),t.pu.au()}function pa(t){return ya(t)&&!Fa(t).$o()&&t.wu.size>0}function ya(t){return 0===D(t).mu.size}function wa(t){t.Iu=void 0}async function va(t){t.wu.forEach(((e,n)=>{fa(t,e)}))}async function ba(t,e){wa(t),pa(t)?(t.pu.fu(e),ga(t)):t.pu.set("Unknown")}async function Ia(t,e,n){if(t.pu.set("Online"),e instanceof yr&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.wu.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.wu.delete(s),t.Iu.removeTarget(s))}(t,e)}catch(n){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ta(t,n)}else if(e instanceof gr?t.Iu.Qt(e):e instanceof pr?t.Iu.Zt(e):t.Iu.Wt(e),!n.isEqual($.min()))try{const e=await So(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Iu.ee(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.wu.get(s);i&&t.wu.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.wu.get(e);if(!n)return;t.wu.set(e,n.withResumeToken(Ot.EMPTY_BYTE_STRING,n.snapshotVersion)),ma(t,e);const s=new Os(n.target,e,1,n.sequenceNumber);fa(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){v("RemoteStore","Failed to raise snapshot:",e),await Ta(t,e)}}async function Ta(t,e,n){if(!mt(e))throw e;t.mu.add(1),await ha(t),t.pu.set("Offline"),n||(n=()=>So(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{v("RemoteStore","Retrying IndexedDB access"),await n(),t.mu.delete(1),await ca(t)}))}function Ea(t,e){return e().catch((n=>Ta(t,n,e)))}async function _a(t){const e=D(t),n=La(e);let s=e._u.length>0?e._u[e._u.length-1].batchId:-1;for(;Sa(e);)try{const t=await Do(e.localStore,s);if(null===t){0===e._u.length&&n.Bo();break}s=t.batchId,xa(e,t)}catch(t){await Ta(e,t)}Da(e)&&Aa(e)}function Sa(t){return ya(t)&&t._u.length<10}function xa(t,e){t._u.push(e);const n=La(t);n.Mo()&&n.Xo&&n.tu(e.mutations)}function Da(t){return ya(t)&&!La(t).$o()&&t._u.length>0}function Aa(t){La(t).start()}async function Ca(t){La(t).su()}async function Na(t){const e=La(t);for(const n of t._u)e.tu(n.mutations)}async function ka(t,e,n){const s=t._u.shift(),i=Ns.from(s,e,n);await Ea(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await _a(t)}async function Oa(t,e){e&&La(t).Xo&&await async function(t,e){if(Wn(n=e.code)&&n!==A.ABORTED){const n=t._u.shift();La(t).Fo(),await Ea(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await _a(t)}var n}(t,e),Da(t)&&Aa(t)}async function Ra(t,e){const n=D(t);n.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const s=ya(n);n.mu.add(3),await ha(n),s&&n.pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.mu.delete(3),await ca(n)}async function Ma(t,e){const n=D(t);e?(n.mu.delete(2),await ca(n)):e||(n.mu.add(2),await ha(n),n.pu.set("Unknown"))}function Fa(t){return t.Tu||(t.Tu=function(t,e,n){const s=D(t);return s.ru(),new sa(e,s.connection,s.authCredentials,s.appCheckCredentials,s.Tt,n)}(t.datastore,t.asyncQueue,{Xr:va.bind(null,t),no:ba.bind(null,t),Ho:Ia.bind(null,t)}),t.gu.push((async e=>{e?(t.Tu.Fo(),pa(t)?ga(t):t.pu.set("Unknown")):(await t.Tu.stop(),wa(t))}))),t.Tu}function La(t){return t.Eu||(t.Eu=function(t,e,n){const s=D(t);return s.ru(),new ia(e,s.connection,s.authCredentials,s.appCheckCredentials,s.Tt,n)}(t.datastore,t.asyncQueue,{Xr:Ca.bind(null,t),no:Oa.bind(null,t),nu:Na.bind(null,t),eu:ka.bind(null,t)}),t.gu.push((async e=>{e?(t.Eu.Fo(),await _a(t)):(await t.Eu.stop(),t._u.length>0&&(v("RemoteStore",`Stopping write stream with ${t._u.length} pending writes`),t._u=[]))}))),t.Eu}class Va{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new q,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new Va(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(A.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pa(t,e){if(I("AsyncQueue",`${e}: ${t}`),mt(t))return new C(A.UNAVAILABLE,`${e}: ${t}`);throw t}class qa{constructor(t){this.comparator=t?(e,n)=>t(e,n)||W.comparator(e.key,n.key):(t,e)=>W.comparator(t.key,e.key),this.keyedMap=nr(),this.sortedSet=new ke(this.comparator)}static emptySet(t){return new qa(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof qa))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new qa;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Ua{constructor(){this.Au=new ke(W.comparator)}track(t){const e=t.doc.key,n=this.Au.get(e);n?0!==t.type&&3===n.type?this.Au=this.Au.insert(e,t):3===t.type&&1!==n.type?this.Au=this.Au.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Au=this.Au.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Au=this.Au.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Au=this.Au.remove(e):1===t.type&&2===n.type?this.Au=this.Au.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Au=this.Au.insert(e,{type:2,doc:t.doc}):_():this.Au=this.Au.insert(e,t)}Ru(){const t=[];return this.Au.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Ba{constructor(t,e,n,s,i,r,o,u,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,s,i){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new Ba(t,e,qa.emptySet(e),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&an(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ja{constructor(){this.Pu=void 0,this.listeners=[]}}class Ka{constructor(){this.queries=new Yn((t=>un(t)),an),this.onlineState="Unknown",this.vu=new Set}}async function Ga(t,e){const n=D(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new ja),i)try{r.Pu=await n.onListen(s)}catch(t){const n=Pa(t,`Initialization of query '${cn(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.bu(n.onlineState),r.Pu&&e.Vu(r.Pu)&&Ha(n)}async function $a(t,e){const n=D(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function Qa(t,e){const n=D(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.Vu(t)&&(s=!0);i.Pu=t}}s&&Ha(n)}function za(t,e,n){const s=D(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function Ha(t){t.vu.forEach((t=>{t.next()}))}class Wa{constructor(t,e,n){this.query=t,this.Su=e,this.Du=!1,this.Cu=null,this.onlineState="Unknown",this.options=n||{}}Vu(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ba(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Du?this.xu(t)&&(this.Su.next(t),e=!0):this.Nu(t,this.onlineState)&&(this.ku(t),e=!0),this.Cu=t,e}onError(t){this.Su.error(t)}bu(t){this.onlineState=t;let e=!1;return this.Cu&&!this.Du&&this.Nu(this.Cu,t)&&(this.ku(this.Cu),e=!0),e}Nu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.$u||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}xu(t){if(t.docChanges.length>0)return!0;const e=this.Cu&&this.Cu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ku(t){t=Ba.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Du=!0,this.Su.next(t)}}class Xa{constructor(t,e){this.Mu=t,this.byteLength=e}Ou(){return"metadata"in this.Mu}}class Ya{constructor(t){this.Tt=t}Zi(t){return Mr(this.Tt,t)}Xi(t){return t.metadata.exists?Ur(this.Tt,t.document,!1):Ue.newNoDocument(this.Zi(t.metadata.name),this.tr(t.metadata.readTime))}tr(t){return Nr(t)}}class Ja{constructor(t,e,n){this.Fu=t,this.localStore=e,this.Tt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Za(t)}Bu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.Mu.namedQuery)this.queries.push(t.Mu.namedQuery);else if(t.Mu.documentMetadata){this.documents.push({metadata:t.Mu.documentMetadata}),t.Mu.documentMetadata.exists||++e;const n=rt.fromString(t.Mu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.Mu.document&&(this.documents[this.documents.length-1].document=t.Mu.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Lu(t){const e=new Map,n=new Ya(this.Tt);for(const s of t)if(s.metadata.queries){const t=n.Zi(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||cr()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const i=D(t);let r=cr(),o=Zn();for(const t of n){const n=e.Zi(t.metadata.name);t.document&&(r=r.add(n));const s=e.Xi(t);s.setReadTime(e.tr(t.metadata.readTime)),o=o.insert(n,s)}const u=i.ji.newChangeBuffer({trackRemovals:!0}),c=await Ao(i,function(t){return rn(Ye(rt.fromString(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>xo(t,u,o).next((e=>(u.apply(t),e))).next((e=>i.Ns.removeMatchingKeysForTargetId(t,c.targetId).next((()=>i.Ns.addMatchingKeys(t,r,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(t,e.Hi,e.Ji))).next((()=>e.Hi))))))}(this.localStore,new Ya(this.Tt),this.documents,this.Fu.id),e=this.Lu(this.documents);for(const t of this.queries)await Mo(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,qu:this.collectionGroups,Uu:t}}}function Za(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class tu{constructor(t){this.key=t}}class eu{constructor(t){this.key=t}}class nu{constructor(t,e){this.query=t,this.Ku=e,this.Gu=null,this.hasCachedResults=!1,this.current=!1,this.Qu=cr(),this.mutatedKeys=cr(),this.ju=dn(t),this.zu=new qa(this.ju)}get Wu(){return this.Ku}Hu(t,e){const n=e?e.Ju:new Ua,s=e?e.zu:this.zu;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const a=s.get(t),h=hn(this.query,e)?e:null,l=!!a&&this.mutatedKeys.has(a.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;a&&h?a.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Yu(a,h)||(n.track({type:2,doc:h}),f=!0,(u&&this.ju(h,u)>0||c&&this.ju(h,c)<0)&&(o=!0)):!a&&h?(n.track({type:0,doc:h}),f=!0):a&&!h&&(n.track({type:1,doc:a}),f=!0,(u||c)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{zu:r,Ju:n,Li:o,mutatedKeys:i}}Yu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.zu;this.zu=t.zu,this.mutatedKeys=t.mutatedKeys;const i=t.Ju.Ru();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _()}};return n(t)-n(e)}(t.type,e.type)||this.ju(t.doc,e.doc))),this.Zu(n);const r=e?this.Xu():[],o=0===this.Qu.size&&this.current?1:0,u=o!==this.Gu;return this.Gu=o,0!==i.length||u?{snapshot:new Ba(this.query,t.zu,s,i,t.mutatedKeys,0===o,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),tc:r}:{tc:r}}bu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({zu:this.zu,Ju:new Ua,mutatedKeys:this.mutatedKeys,Li:!1},!1)):{tc:[]}}ec(t){return!this.Ku.has(t)&&!!this.zu.has(t)&&!this.zu.get(t).hasLocalMutations}Zu(t){t&&(t.addedDocuments.forEach((t=>this.Ku=this.Ku.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ku=this.Ku.delete(t))),this.current=t.current)}Xu(){if(!this.current)return[];const t=this.Qu;this.Qu=cr(),this.zu.forEach((t=>{this.ec(t.key)&&(this.Qu=this.Qu.add(t.key))}));const e=[];return t.forEach((t=>{this.Qu.has(t)||e.push(new eu(t))})),this.Qu.forEach((n=>{t.has(n)||e.push(new tu(n))})),e}nc(t){this.Ku=t.Yi,this.Qu=cr();const e=this.Hu(t.documents);return this.applyChanges(e,!0)}sc(){return Ba.fromInitialDocuments(this.query,this.zu,this.mutatedKeys,0===this.Gu,this.hasCachedResults)}}class ru{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class su{constructor(t){this.key=t,this.ic=!1}}class iu{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.rc={},this.oc=new Yn((t=>un(t)),an),this.uc=new Map,this.cc=new Set,this.ac=new ke(W.comparator),this.hc=new Map,this.lc=new ro,this.fc={},this.dc=new Map,this._c=Ri.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}async function ou(t,e){const n=Ou(t);let s,i;const r=n.oc.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.sc();else{const t=await Ao(n.localStore,rn(e));n.isPrimaryClient&&la(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await au(n,e,s,"current"===r,t.resumeToken)}return i}async function au(t,e,n,s,i){t.mc=(e,n,s)=>async function(t,e,n,s){let i=e.view.Hu(n);i.Li&&(i=await No(t.localStore,e.query,!1).then((({documents:t})=>e.view.Hu(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return wu(t,e.targetId,o.tc),o.snapshot}(t,e,n,s);const r=await No(t.localStore,e,!0),o=new nu(e,r.Yi),u=o.Hu(r.documents),c=mr.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,i),a=o.applyChanges(u,t.isPrimaryClient,c);wu(t,n,a.tc);const h=new ru(e,n,o);return t.oc.set(e,h),t.uc.has(n)?t.uc.get(n).push(e):t.uc.set(n,[e]),a.snapshot}async function uu(t,e){const n=D(t),s=n.oc.get(e),i=n.uc.get(s.targetId);if(i.length>1)return n.uc.set(s.targetId,i.filter((t=>!an(t,e)))),void n.oc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Co(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),da(n.remoteStore,s.targetId),pu(n,s.targetId)})).catch(at)):(pu(n,s.targetId),await Co(n.localStore,s.targetId,!0))}async function cu(t,e){const n=D(t);try{const t=await function(t,e){const n=D(t),s=e.snapshotVersion;let i=n.Ki;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.ji.newChangeBuffer({trackRemovals:!0});i=n.Ki;const o=[];e.targetChanges.forEach(((r,u)=>{const c=i.get(u);if(!c)return;o.push(n.Ns.removeMatchingKeys(t,r.removedDocuments,u).next((()=>n.Ns.addMatchingKeys(t,r.addedDocuments,u))));let a=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(u)?a=a.withResumeToken(Ot.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):r.resumeToken.approximateByteSize()>0&&(a=a.withResumeToken(r.resumeToken,s)),i=i.insert(u,a),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,a,r)&&o.push(n.Ns.updateTargetData(t,a))}));let u=Zn(),c=cr();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(xo(t,r,e.documentUpdates).next((t=>{u=t.Hi,c=t.Ji}))),!s.isEqual($.min())){const e=n.Ns.getLastRemoteSnapshotVersion(t).next((e=>n.Ns.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return ut.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,u,c))).next((()=>u))})).then((t=>(n.Ki=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.hc.get(e);s&&(S(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.ic=!0:t.modifiedDocuments.size>0?S(s.ic):t.removedDocuments.size>0&&(S(s.ic),s.ic=!1))})),await Iu(n,t,e)}catch(t){await at(t)}}function hu(t,e,n){const s=D(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.oc.forEach(((n,s)=>{const i=s.view.bu(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=D(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.bu(e)&&(s=!0)})),s&&Ha(n)}(s.eventManager,e),t.length&&s.rc.Ho(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function lu(t,e,n){const s=D(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.hc.get(e),r=i&&i.key;if(r){let t=new ke(W.comparator);t=t.insert(r,Ue.newNoDocument(r,$.min()));const n=cr().add(r),i=new fr($.min(),new Map,new Me(B),t,n);await cu(s,i),s.ac=s.ac.remove(r),s.hc.delete(e),bu(s)}else await Co(s.localStore,e,!1).then((()=>pu(s,e,n))).catch(at)}async function du(t,e){const n=D(t),s=e.batch.batchId;try{const t=await function(t,e){const n=D(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.ji.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=ut.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);S(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=cr();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(n.localStore,e);gu(n,s,null),mu(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Iu(n,t)}catch(t){await at(t)}}async function fu(t,e,n){const s=D(t);try{const t=await function(t,e){const n=D(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(S(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);gu(s,e,n),mu(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Iu(s,t)}catch(n){await at(n)}}function mu(t,e){(t.dc.get(e)||[]).forEach((t=>{t.resolve()})),t.dc.delete(e)}function gu(t,e,n){const s=D(t);let i=s.fc[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.fc[s.currentUser.toKey()]=i}}function pu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.uc.get(e))t.oc.delete(s),n&&t.rc.gc(s,n);t.uc.delete(e),t.isPrimaryClient&&t.lc.ds(e).forEach((e=>{t.lc.containsKey(e)||yu(t,e)}))}function yu(t,e){t.cc.delete(e.path.canonicalString());const n=t.ac.get(e);null!==n&&(da(t.remoteStore,n),t.ac=t.ac.remove(e),t.hc.delete(n),bu(t))}function wu(t,e,n){for(const s of n)s instanceof tu?(t.lc.addReference(s.key,e),vu(t,s)):s instanceof eu?(v("SyncEngine","Document no longer in limbo: "+s.key),t.lc.removeReference(s.key,e),t.lc.containsKey(s.key)||yu(t,s.key)):_()}function vu(t,e){const n=e.key,s=n.path.canonicalString();t.ac.get(n)||t.cc.has(s)||(v("SyncEngine","New document in limbo: "+n),t.cc.add(s),bu(t))}function bu(t){for(;t.cc.size>0&&t.ac.size<t.maxConcurrentLimboResolutions;){const e=t.cc.values().next().value;t.cc.delete(e);const n=new W(rt.fromString(e)),s=t._c.next();t.hc.set(s,new su(n)),t.ac=t.ac.insert(n,s),la(t.remoteStore,new Os(rn(Ye(n.path)),s,2,It.at))}}async function Iu(t,e,n){const s=D(t),i=[],r=[],o=[];s.oc.isEmpty()||(s.oc.forEach(((t,u)=>{o.push(s.mc(u,e,n).then((t=>{if((t||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(u.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=bo.Ni(u.targetId,t);r.push(e)}})))})),await Promise.all(o),s.rc.Ho(i),await async function(t,e){const n=D(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ut.forEach(e,(e=>ut.forEach(e.Ci,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>ut.forEach(e.xi,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!mt(t))throw t;v("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ki.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.Ki=n.Ki.insert(e,i)}}}(s.localStore,r))}async function Tu(t,e){const n=D(t);if(!n.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());const t=await _o(n.localStore,e);n.currentUser=e,function(t,e){t.dc.forEach((t=>{t.forEach((t=>{t.reject(new C(A.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.dc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Iu(n,t.Wi)}}function Eu(t,e){const n=D(t),s=n.hc.get(e);if(s&&s.ic)return cr().add(s.key);{let t=cr();const s=n.uc.get(e);if(!s)return t;for(const e of s){const s=n.oc.get(e);t=t.unionWith(s.view.Wu)}return t}}async function _u(t,e){const n=D(t),s=await No(n.localStore,e.query,!0),i=e.view.nc(s);return n.isPrimaryClient&&wu(n,e.targetId,i.tc),i}async function Su(t,e){const n=D(t);return Oo(n.localStore,e).then((t=>Iu(n,t)))}async function xu(t,e,n,s){const i=D(t),r=await function(t,e){const n=D(t),s=D(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.An(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):ut.resolve(null)))))}(i.localStore,e);null!==r?("pending"===n?await _a(i.remoteStore):"acknowledged"===n||"rejected"===n?(gu(i,e,s||null),mu(i,e),function(t,e){D(D(t).mutationQueue).Pn(e)}(i.localStore,e)):_(),await Iu(i,r)):v("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Du(t,e,n){const s=D(t),i=[],r=[];for(const t of e){let e;const n=s.uc.get(t);if(n&&0!==n.length){e=await Ao(s.localStore,rn(n[0]));for(const t of n){const e=s.oc.get(t),n=await _u(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await ko(s.localStore,t);e=await Ao(s.localStore,n),await au(s,Au(n),t,!1,e.resumeToken)}i.push(e)}return s.rc.Ho(r),i}function Au(t){return Xe(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Cu(t){const e=D(t);return D(D(e.localStore).persistence).Si()}async function Nu(t,e,n,s){const i=D(t);if(i.wc)return void v("SyncEngine","Ignoring unexpected query state notification.");const r=i.uc.get(e);if(r&&r.length>0)switch(n){case"current":case"not-current":{const t=await Oo(i.localStore,ln(r[0])),s=fr.createSynthesizedRemoteEventForCurrentChange(e,"current"===n,Ot.EMPTY_BYTE_STRING);await Iu(i,t,s);break}case"rejected":await Co(i.localStore,e,!0),pu(i,e,s);break;default:_()}}async function ku(t,e,n){const s=Ou(t);if(s.wc){for(const t of e){if(s.uc.has(t)){v("SyncEngine","Adding an already active target "+t);continue}const e=await ko(s.localStore,t),n=await Ao(s.localStore,e);await au(s,Au(e),n.targetId,!1,n.resumeToken),la(s.remoteStore,n)}for(const t of n)s.uc.has(t)&&await Co(s.localStore,t,!1).then((()=>{da(s.remoteStore,t),pu(s,t)})).catch(at)}}function Ou(t){const e=D(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=cu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Eu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lu.bind(null,e),e.rc.Ho=Qa.bind(null,e.eventManager),e.rc.gc=za.bind(null,e.eventManager),e}function Ru(t){const e=D(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=du.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=fu.bind(null,e),e}class Mu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.Tt=ea(t.databaseInfo.databaseId),this.sharedClientState=this.Ic(t),this.persistence=this.Tc(t),await this.persistence.start(),this.localStore=this.Ec(t),this.gcScheduler=this.Ac(t,this.localStore),this.indexBackfillerScheduler=this.Rc(t,this.localStore)}Ac(t,e){return null}Rc(t,e){return null}Ec(t){return Eo(this.persistence,new Io,t.initialUser,this.Tt)}Tc(t){return new co(lo.qs,this.Tt)}Ic(t){return new Go}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Fu extends Mu{constructor(t,e,n){super(),this.Pc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Pc.initialize(this,t),await Ru(this.Pc.syncEngine),await _a(this.Pc.remoteStore),await this.persistence.di((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Ec(t){return Eo(this.persistence,new Io,t.initialUser,this.Tt)}Ac(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new Ui(n,t.asyncQueue,e)}Rc(t,e){const n=new bt(e,this.persistence);return new vt(t.asyncQueue,n)}Tc(t){const e=vo(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Si.withCacheSize(this.cacheSizeBytes):Si.DEFAULT;return new po(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Zo(),ta(),this.Tt,this.sharedClientState,!!this.forceOwnership)}Ic(t){return new Go}}class Lu extends Fu{constructor(t,e){super(t,e,!1),this.Pc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Pc.syncEngine;this.sharedClientState instanceof Ko&&(this.sharedClientState.syncEngine={Br:xu.bind(null,e),Lr:Nu.bind(null,e),qr:ku.bind(null,e),Si:Cu.bind(null,e),Fr:Su.bind(null,e)},await this.sharedClientState.start()),await this.persistence.di((async t=>{await async function(t,e){const n=D(t);if(Ou(n),Ru(n),!0===e&&!0!==n.wc){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Du(n,t.toArray());n.wc=!0,await Ma(n.remoteStore,!0);for(const t of e)la(n.remoteStore,t)}else if(!1===e&&!1!==n.wc){const t=[];let e=Promise.resolve();n.uc.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>(pu(n,i),Co(n.localStore,i,!0)))),da(n.remoteStore,i)})),await e,await Du(n,t),function(t){const e=D(t);e.hc.forEach(((t,n)=>{da(e.remoteStore,n)})),e.lc._s(),e.hc=new Map,e.ac=new ke(W.comparator)}(n),n.wc=!1,await Ma(n.remoteStore,!1)}}(this.Pc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}Ic(t){const e=Zo();if(!Ko.C(e))throw new C(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=vo(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Ko(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class Vu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>hu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Tu.bind(null,this.syncEngine),await Ma(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ka}createDatastore(t){const e=ea(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Jo(s));var s;return function(t,e,n,s){return new oa(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>hu(this.syncEngine,t,0),r=Qo.C()?new Qo:new $o,new ua(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const u=new iu(t,e,n,s,i,r);return o&&(u.wc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=D(t);v("RemoteStore","RemoteStore shutting down."),e.mu.add(5),await ha(e),e.yu.shutdown(),e.pu.set("Unknown")}(this.remoteStore)}}function Pu(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class qu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.vc(this.observer.next,t)}error(t){this.observer.error?this.vc(this.observer.error,t):I("Uncaught Error in snapshot listener:",t.toString())}bc(){this.muted=!0}vc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Uu{constructor(t,e){this.Vc=t,this.Tt=e,this.metadata=new q,this.buffer=new Uint8Array,this.Sc=new TextDecoder("utf-8"),this.Dc().then((t=>{t&&t.Ou()?this.metadata.resolve(t.Mu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.Mu)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Vc.cancel()}async getMetadata(){return this.metadata.promise}async yc(){return await this.getMetadata(),this.Dc()}async Dc(){const t=await this.Cc();if(null===t)return null;const e=this.Sc.decode(t),n=Number(e);isNaN(n)&&this.xc(`length string (${e}) is not valid number`);const s=await this.Nc(n);return new Xa(JSON.parse(s),t.length+n)}kc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async Cc(){for(;this.kc()<0&&!await this.$c(););if(0===this.buffer.length)return null;const t=this.kc();t<0&&this.xc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Nc(t){for(;this.buffer.length<t;)await this.$c()&&this.xc("Reached the end of bundle when more is expected.");const e=this.Sc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}xc(t){throw this.Vc.cancel(),new Error(`Invalid bundle format: ${t}`)}async $c(){const t=await this.Vc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Bu{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new C(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=D(t),s=Vr(n.Tt)+"/documents",i={documents:e.map((t=>Rr(n.Tt,t)))},r=await n.mo("BatchGetDocuments",s,i,e.length),o=new Map;r.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){S(!!e.found),e.found.name,e.found.updateTime;const n=Mr(t,e.found.name),s=Nr(e.found.updateTime),i=e.found.createTime?Nr(e.found.createTime):$.min(),r=new Pe({mapValue:{fields:e.found.fields}});return Ue.newFoundDocument(n,s,i,r)}(t,e):"missing"in e?function(t,e){S(!!e.missing),S(!!e.readTime);const n=Mr(t,e.missing),s=Nr(e.readTime);return Ue.newNoDocument(n,s)}(t,e):_()}(n.Tt,t);o.set(e.key.toString(),e)}));const u=[];return e.forEach((t=>{const e=o.get(t.toString());S(!!e),u.push(e)})),u}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Gn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=W.fromPath(e);this.mutations.push(new $n(n,this.precondition(n)))})),await async function(t,e){const n=D(t),s=Vr(n.Tt)+"/documents",i={writes:e.map((t=>Br(n.Tt,t)))};await n.lo("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw _();e=$.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual($.min())?kn.exists(!1):kn.updateTime(e):kn.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual($.min()))throw new C(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return kn.updateTime(e)}return kn.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class ju{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.Mc=n.maxAttempts,this.ko=new na(this.asyncQueue,"transaction_retry")}run(){this.Mc-=1,this.Oc()}Oc(){this.ko.vo((async()=>{const t=new Bu(this.datastore),e=this.Fc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Bc(t)}))))})).catch((t=>{this.Bc(t)}))}))}Fc(t){try{const e=this.updateFunction(t);return!Dt(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Bc(t){this.Mc>0&&this.Lc(t)?(this.Mc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Oc(),Promise.resolve())))):this.deferred.reject(t)}Lc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!Wn(e)}return!1}}class Ku{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=f.UNAUTHENTICATED,this.clientId=U.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{v("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(v("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(A.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new q;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Pa(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Gu(t,e){t.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await _o(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function $u(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Qu(t);v("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>Ra(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Ra(e.remoteStore,n))),t.onlineComponents=e}async function Qu(t){return t.offlineComponents||(v("FirestoreClient","Using default OfflineComponentProvider"),await Gu(t,new Mu)),t.offlineComponents}async function zu(t){return t.onlineComponents||(v("FirestoreClient","Using default OnlineComponentProvider"),await $u(t,new Vu)),t.onlineComponents}function Hu(t){return Qu(t).then((t=>t.persistence))}function Wu(t){return Qu(t).then((t=>t.localStore))}function Xu(t){return zu(t).then((t=>t.remoteStore))}function Yu(t){return zu(t).then((t=>t.syncEngine))}function Ju(t){return zu(t).then((t=>t.datastore))}async function Zu(t){const e=await zu(t),n=e.eventManager;return n.onListen=ou.bind(null,e.syncEngine),n.onUnlisten=uu.bind(null,e.syncEngine),n}function tc(t,e,n={}){const s=new q;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new qu({next:r=>{e.enqueueAndForget((()=>$a(t,o)));const u=r.docs.has(n);!u&&r.fromCache?i.reject(new C(A.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&r.fromCache&&s&&"server"===s.source?i.reject(new C(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Wa(Ye(n.path),r,{includeMetadataChanges:!0,$u:!0});return Ga(t,o)}(await Zu(t),t.asyncQueue,e,n,s))),s.promise}function ec(t,e,n={}){const s=new q;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new qu({next:n=>{e.enqueueAndForget((()=>$a(t,o))),n.fromCache&&"server"===s.source?i.reject(new C(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Wa(n,r,{includeMetadataChanges:!0,$u:!0});return Ga(t,o)}(await Zu(t),t.asyncQueue,e,n,s))),s.promise}function nc(t,e,n,s){const i=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new Uu(t,e)}(function(t,e){if(t instanceof Uint8Array)return Pu(t,e);if(t instanceof ArrayBuffer)return Pu(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,ea(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=D(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=D(t),s=Nr(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.$s.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s)),Promise.resolve(new Set);n._updateProgress(Za(s));const i=new Ja(s,t.localStore,e.Tt);let r=await e.yc();for(;r;){const t=await i.Bu(r);t&&n._updateProgress(t),r=await e.yc()}const o=await i.complete();return await Iu(t,o.Uu,void 0),await function(t,e){const n=D(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.$s.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress),Promise.resolve(o.qu)}catch(t){return T("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(s,e,n).then((t=>{s.sharedClientState.notifyBundleLoaded(t)}))}(await Yu(t),i,s)}))}const rc=new Map;function sc(t,e,n){if(!n)throw new C(A.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ic(t,e,n,s){if(!0===e&&!0===s)throw new C(A.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function oc(t){if(!W.isDocumentKey(t))throw new C(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function ac(t){if(W.isDocumentKey(t))throw new C(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function uc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_()}function cc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new C(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=uc(t);throw new C(A.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function hc(t,e){if(e<=0)throw new C(A.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class lc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new C(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new C(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ic("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class dc{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new C(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new k;switch(t.type){case"gapi":const e=t.client;return new F(e,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new C(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=rc.get(t);e&&(v("ComponentProvider","Removing Datastore"),rc.delete(t),e.terminate())}(this),Promise.resolve()}}function fc(t,e,n,s={}){var i;const r=(t=cc(t,dc))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&T("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=f.MOCK_USER;else{e=Object(h.g)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new C(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(r)}t._authCredentials=new O(new N(e,n))}}class mc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new mc(this.firestore,t,this._key)}}class gc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new gc(this.firestore,t,this._query)}}class pc extends gc{constructor(t,e,n){super(t,e,Ye(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new mc(this.firestore,null,new W(t))}withConverter(t){return new pc(this.firestore,t,this._path)}}function yc(t,e,...n){if(t=Object(h.p)(t),sc("collection","path",e),t instanceof dc){const s=rt.fromString(e,...n);return ac(s),new pc(t,null,s)}{if(!(t instanceof mc||t instanceof pc))throw new C(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(rt.fromString(e,...n));return ac(s),new pc(t.firestore,null,s)}}function th(t,e){if(t=cc(t,dc),sc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(A.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new gc(t,null,function(t){return new We(rt.emptyPath(),t)}(e))}function wc(t,e,...n){if(t=Object(h.p)(t),1===arguments.length&&(e=U.R()),sc("doc","path",e),t instanceof dc){const s=rt.fromString(e,...n);return oc(s),new mc(t,null,new W(s))}{if(!(t instanceof mc||t instanceof pc))throw new C(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(rt.fromString(e,...n));return oc(s),new mc(t.firestore,t instanceof pc?t.converter:null,new W(s))}}function vc(t,e){return t=Object(h.p)(t),e=Object(h.p)(e),(t instanceof mc||t instanceof pc)&&(e instanceof mc||e instanceof pc)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function bc(t,e){return t=Object(h.p)(t),e=Object(h.p)(e),t instanceof gc&&e instanceof gc&&t.firestore===e.firestore&&an(t._query,e._query)&&t.converter===e.converter}class Ic{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new na(this,"async_queue_retry"),this.Hc=()=>{const t=ta();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ko.Vo()};const t=ta();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Jc(),this.Yc(t)}enterRestrictedMode(t){if(!this.Kc){this.Kc=!0,this.zc=t||!1;const e=ta();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Hc)}}enqueue(t){if(this.Jc(),this.Kc)return new Promise((()=>{}));const e=new q;return this.Yc((()=>this.Kc&&this.zc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Uc.push(t),this.Zc())))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(t){if(!mt(t))throw t;v("AsyncQueue","Operation failed with retryable error: "+t)}this.Uc.length>0&&this.ko.vo((()=>this.Zc()))}}Yc(t){const e=this.qc.then((()=>(this.jc=!0,t().catch((t=>{this.Qc=t,this.jc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw I("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.jc=!1,t))))));return this.qc=e,e}enqueueAfterDelay(t,e,n){this.Jc(),this.Wc.indexOf(t)>-1&&(e=0);const s=Va.createAndSchedule(this,t,e,n,(t=>this.Xc(t)));return this.Gc.push(s),s}Jc(){this.Qc&&_()}verifyOperationInProgress(){}async ta(){let t;do{t=this.qc,await t}while(t!==this.qc)}ea(t){for(const e of this.Gc)if(e.timerId===t)return!0;return!1}na(t){return this.ta().then((()=>{this.Gc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Gc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ta()}))}sa(t){this.Wc.push(t)}Xc(t){const e=this.Gc.indexOf(t);this.Gc.splice(e,1)}}function Tc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Ec{constructor(){this._progressObserver={},this._taskCompletionResolver=new q,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const _c=-1;class Sc extends dc{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Ic,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Dc(this),this._firestoreClient.terminate()}}function xc(t){return t._firestoreClient||Dc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Dc(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new Tt(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Ku(t._authCredentials,t._appCheckCredentials,t._queue,s)}function Ac(t,e){Vc(t=cc(t,Sc));const n=xc(t),s=t._freezeSettings(),i=new Vu;return Nc(n,i,new Fu(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function Cc(t){Vc(t=cc(t,Sc));const e=xc(t),n=t._freezeSettings(),s=new Vu;return Nc(e,s,new Lu(s,n.cacheSizeBytes))}function Nc(t,e,n){const s=new q;return t.asyncQueue.enqueue((async()=>{try{await Gu(t,n),await $u(t,e),s.resolve()}catch(t){const e=t;if(!function(t){return"FirebaseError"===t.name?t.code===A.FAILED_PRECONDITION||t.code===A.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(e))throw e;T("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e)}})).then((()=>s.promise))}function kc(t){if(t._initialized&&!t._terminated)throw new C(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new q;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!ht.C())return Promise.resolve();const e=t+"main";await ht.delete(e)}(vo(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Oc(t){return function(t){const e=new q;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=D(t);ya(n.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=D(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.dc.get(t)||[];s.push(e),n.dc.set(t,s)}catch(t){const n=Pa(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Yu(t),e))),e.promise}(xc(t=cc(t,Sc)))}function Rc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Hu(t),n=await Xu(t);return e.setNetworkEnabled(!0),function(t){const e=D(t);return e.mu.delete(0),ca(e)}(n)}))}(xc(t=cc(t,Sc)))}function Mc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Hu(t),n=await Xu(t);return e.setNetworkEnabled(!1),async function(t){const e=D(t);e.mu.add(0),await ha(e),e.pu.set("Offline")}(n)}))}(xc(t=cc(t,Sc)))}function Fc(t,e){const n=xc(t=cc(t,Sc)),s=new Ec;return nc(n,t._databaseId,e,s),s}function Lc(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=D(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.$s.getNamedQuery(t,e)))}(await Wu(t),e)))}(xc(t=cc(t,Sc)),e).then((e=>e?new gc(t,null,e.query):null))}function Vc(t){if(t._initialized||t._terminated)throw new C(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Pc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Pc(Ot.fromBase64String(t))}catch(t){throw new C(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Pc(Ot.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class qc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new C(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new H(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Uc{constructor(t){this._methodName=t}}class Bc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return B(this._lat,t._lat)||B(this._long,t._long)}}const jc=/^__.*__$/;class Kc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Un(t,this.data,this.fieldMask,e,this.fieldTransforms):new qn(t,this.data,e,this.fieldTransforms)}}class Gc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Un(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function $c(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _()}}class Qc{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.Tt=n,this.ignoreUndefinedProperties=s,void 0===i&&this.ia(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(t){return new Qc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.oa({path:n,ca:!1});return s.aa(t),s}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.oa({path:n,ca:!1});return s.ia(),s}la(t){return this.oa({path:void 0,ca:!0})}fa(t){return fh(t,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ia(){if(this.path)for(let t=0;t<this.path.length;t++)this.aa(this.path.get(t))}aa(t){if(0===t.length)throw this.fa("Document fields must not be empty");if($c(this.ra)&&jc.test(t))throw this.fa('Document fields cannot begin and end with "__"')}}class zc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.Tt=n||ea(t)}wa(t,e,n,s=!1){return new Qc({ra:t,methodName:e,_a:n,path:H.emptyPath(),ca:!1,da:s},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function Hc(t){const e=t._freezeSettings(),n=ea(t._databaseId);return new zc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Wc(t,e,n,s,i,r={}){const o=t.wa(r.merge||r.mergeFields?2:0,e,n,i);ch("Data must be an object, but it was:",o,s);const u=ah(s,o);let c,a;if(r.merge)c=new Ve(o.fieldMask),a=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=hh(e,s,n);if(!o.contains(i))throw new C(A.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);mh(t,i)||t.push(i)}c=new Ve(t),a=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,a=o.fieldTransforms;return new Kc(new Pe(u),c,a)}class Xc extends Uc{_toFieldTransform(t){if(2!==t.ra)throw 1===t.ra?t.fa(`${this._methodName}() can only appear at the top level of your update data`):t.fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Xc}}function Yc(t,e,n){return new Qc({ra:3,_a:e.settings._a,methodName:t._methodName,ca:n},e.databaseId,e.Tt,e.ignoreUndefinedProperties)}class Jc extends Uc{_toFieldTransform(t){return new Cn(t.path,new In)}isEqual(t){return t instanceof Jc}}class Zc extends Uc{constructor(t,e){super(t),this.ma=e}_toFieldTransform(t){const e=Yc(this,t,!0),n=this.ma.map((t=>oh(t,e))),s=new Tn(n);return new Cn(t.path,s)}isEqual(t){return this===t}}class eh extends Uc{constructor(t,e){super(t),this.ma=e}_toFieldTransform(t){const e=Yc(this,t,!0),n=this.ma.map((t=>oh(t,e))),s=new _n(n);return new Cn(t.path,s)}isEqual(t){return this===t}}class nh extends Uc{constructor(t,e){super(t),this.ga=e}_toFieldTransform(t){const e=new xn(t.Tt,pn(t.Tt,this.ga));return new Cn(t.path,e)}isEqual(t){return this===t}}function rh(t,e,n,s){const i=t.wa(1,e,n);ch("Data must be an object, but it was:",i,s);const r=[],o=Pe.empty();St(s,((t,s)=>{const u=dh(e,t,n);s=Object(h.p)(s);const c=i.ha(u);if(s instanceof Xc)r.push(u);else{const t=oh(s,c);null!=t&&(r.push(u),o.set(u,t))}}));const u=new Ve(r);return new Gc(o,u,i.fieldTransforms)}function sh(t,e,n,s,i,r){const o=t.wa(1,e,n),u=[hh(e,s,n)],c=[i];if(r.length%2!=0)throw new C(A.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)u.push(hh(e,r[t])),c.push(r[t+1]);const a=[],l=Pe.empty();for(let t=u.length-1;t>=0;--t)if(!mh(a,u[t])){const e=u[t];let n=c[t];n=Object(h.p)(n);const s=o.ha(e);if(n instanceof Xc)a.push(e);else{const t=oh(n,s);null!=t&&(a.push(e),l.set(e,t))}}const d=new Ve(a);return new Gc(l,d,o.fieldTransforms)}function ih(t,e,n,s=!1){return oh(n,t.wa(s?4:3,e))}function oh(t,e){if(uh(t=Object(h.p)(t)))return ch("Unsupported field value:",e,t),ah(t,e);if(t instanceof Uc)return function(t,e){if(!$c(e.ra))throw e.fa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.fa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ca&&4!==e.ra)throw e.fa("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=oh(i,e.la(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(h.p)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return pn(e.Tt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=G.fromDate(t);return{timestampValue:Dr(e.Tt,n)}}if(t instanceof G){const n=new G(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Dr(e.Tt,n)}}if(t instanceof Bc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Pc)return{bytesValue:Ar(e.Tt,t._byteString)};if(t instanceof mc){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.fa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:kr(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.fa(`Unsupported field value: ${uc(t)}`)}(t,e)}function ah(t,e){const n={};return xt(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):St(t,((t,s)=>{const i=oh(s,e.ua(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function uh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof G||t instanceof Bc||t instanceof Pc||t instanceof mc||t instanceof Uc)}function ch(t,e,n){if(!uh(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=uc(n);throw"an object"===s?e.fa(t+" a custom object"):e.fa(t+" "+s)}}function hh(t,e,n){if((e=Object(h.p)(e))instanceof qc)return e._internalPath;if("string"==typeof e)return dh(t,e);throw fh("Field path arguments must be of type string or ",t,!1,void 0,n)}const lh=new RegExp("[~\\*/\\[\\]]");function dh(t,e,n){if(e.search(lh)>=0)throw fh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new qc(...e.split("."))._internalPath}catch(r){throw fh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function fh(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new C(A.INVALID_ARGUMENT,u+t+c)}function mh(t,e){return t.some((t=>t.isEqual(e)))}class gh{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new mc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new ph(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(yh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class ph extends gh{data(){return super.data()}}function yh(t,e){return"string"==typeof e?dh(t,e):e instanceof qc?e._internalPath:e._delegate._internalPath}function ol(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new C(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ul{}class wh extends ul{}function vh(t,e,...n){let s=[];e instanceof ul&&s.push(e),s=s.concat(n),function(t){const e=t.filter((t=>t instanceof Th)).length,n=t.filter((t=>t instanceof bh)).length;if(e>1||e>0&&n>0)throw new C(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const e of s)t=e._apply(t);return t}class bh extends wh{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new bh(t,e,n)}_apply(t){const e=this._parse(t);return Vh(t._query,e),new gc(t.firestore,t.converter,sn(t._query,e))}_parse(t){const e=Hc(t.firestore),n=function(t,e,n,s,i,r,o){let u;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new C(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){Lh(o,r);const e=[];for(const n of o)e.push(Fh(s,t,n));u={arrayValue:{values:e}}}else u=Fh(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Lh(o,r),u=ih(n,"where",o,"in"===r||"not-in"===r);return le.create(i,r,u)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function Ih(t,e,n){const s=e,i=yh("where",t);return bh._create(i,s,n)}class Th extends ul{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Th(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:de.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const s=e.getFlattenedFilters();for(const t of s)Vh(n,t),n=sn(n,t)}(t._query,e),new gc(t.firestore,t.converter,sn(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Eh extends wh{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Eh(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new C(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new C(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Ce(e,n);return function(t,e){if(null===Ze(t)){const n=tn(t);null!==n&&Ph(t,n,e.field)}}(t,s),s}(t._query,this._field,this._direction);return new gc(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new We(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function _h(t,e="asc"){const n=e,s=yh("orderBy",t);return Eh._create(s,n)}class Sh extends wh{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new Sh(t,e,n)}_apply(t){return new gc(t.firestore,t.converter,on(t._query,this._limit,this._limitType))}}function xh(t){return hc("limit",t),Sh._create("limit",t,"F")}function Dh(t){return hc("limitToLast",t),Sh._create("limitToLast",t,"L")}class Ah extends wh{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new Ah(t,e,n)}_apply(t){const e=Mh(t,this.type,this._docOrFields,this._inclusive);return new gc(t.firestore,t.converter,function(t,e){return new We(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function Ch(...t){return Ah._create("startAt",t,!0)}function Nh(...t){return Ah._create("startAfter",t,!1)}class kh extends wh{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new kh(t,e,n)}_apply(t){const e=Mh(t,this.type,this._docOrFields,this._inclusive);return new gc(t.firestore,t.converter,function(t,e){return new We(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Oh(...t){return kh._create("endBefore",t,!1)}function Rh(...t){return kh._create("endAt",t,!0)}function Mh(t,e,n,s){if(n[0]=Object(h.p)(n[0]),n[0]instanceof gh)return function(t,e,n,s,i){if(!s)throw new C(A.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of nn(t))if(n.field.isKeyField())r.push(Wt(e,s.key));else{const t=s.data.field(n.field);if(Vt(t))throw new C(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new C(A.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new ae(r,i)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=Hc(t.firestore);return function(t,e,n,s,i,r){const o=t.explicitOrderBy;if(i.length>o.length)throw new C(A.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const u=[];for(let r=0;r<i.length;r++){const c=i[r];if(o[r].field.isKeyField()){if("string"!=typeof c)throw new C(A.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof c}`);if(!en(t)&&-1!==c.indexOf("/"))throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(rt.fromString(c));if(!W.isDocumentKey(n))throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new W(n);u.push(Wt(e,i))}else{const t=ih(n,s,c);u.push(t)}}return new ae(u,r)}(t._query,t.firestore._databaseId,i,e,n,s)}}function Fh(t,e,n){if("string"==typeof(n=Object(h.p)(n))){if(""===n)throw new C(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!en(e)&&-1!==n.indexOf("/"))throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(rt.fromString(n));if(!W.isDocumentKey(s))throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Wt(t,new W(s))}if(n instanceof mc)return Wt(t,n._key);throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uc(n)}.`)}function Lh(t,e){if(!Array.isArray(t)||0===t.length)throw new C(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Vh(t,e){if(e.isInequality()){const n=tn(t),s=e.field;if(null!==n&&!n.isEqual(s))throw new C(A.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${s.toString()}'`);const i=Ze(t);null!==i&&Ph(t,s,i)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new C(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new C(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function Ph(t,e,n){if(!n.isEqual(e))throw new C(A.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class qh{convertValue(t,e="none"){switch(jt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ft(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Lt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw _()}}convertObject(t,e){const n={};return St(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new Bc(Ft(t.latitude),Ft(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Pt(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(qt(t));default:return null}}convertTimestamp(t){const e=Mt(t);return new G(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=rt.fromString(t);S(Zr(n));const s=new Et(n.get(1),n.get(3)),i=new W(n.popFirst(5));return s.isEqual(e)||I(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function Uh(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class Bh extends qh{constructor(t){super(),this.firestore=t}convertBytes(t){return new Pc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new mc(this.firestore,null,e)}}class jh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Kh extends gh{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Gh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(yh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Gh extends Kh{data(t={}){return super.data(t)}}class $h{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new jh(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Gh(this._firestore,this._userDataWriter,n.key,n,new jh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const s=new Gh(t._firestore,t._userDataWriter,n.doc.key,n.doc,new jh(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Gh(t._firestore,t._userDataWriter,e.doc.key,e.doc,new jh(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Qh(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Qh(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _()}}function zh(t,e){return t instanceof Kh&&e instanceof Kh?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof $h&&e instanceof $h&&t._firestore===e._firestore&&bc(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Hh(t){t=cc(t,mc);const e=cc(t.firestore,Sc);return tc(xc(e),t._key).then((n=>hl(e,t,n)))}class Wh extends qh{constructor(t){super(),this.firestore=t}convertBytes(t){return new Pc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new mc(this.firestore,null,e)}}function Xh(t){t=cc(t,mc);const e=cc(t.firestore,Sc),n=xc(e),s=new Wh(e);return function(t,e){const n=new q;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=D(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new C(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=Pa(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await Wu(t),e,n))),n.promise}(n,t._key).then((n=>new Kh(e,s,t._key,n,new jh(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Yh(t){t=cc(t,mc);const e=cc(t.firestore,Sc);return tc(xc(e),t._key,{source:"server"}).then((n=>hl(e,t,n)))}function Jh(t){t=cc(t,gc);const e=cc(t.firestore,Sc),n=xc(e),s=new Wh(e);return ol(t._query),ec(n,t._query).then((n=>new $h(e,s,t,n)))}function Zh(t){t=cc(t,gc);const e=cc(t.firestore,Sc),n=xc(e),s=new Wh(e);return function(t,e){const n=new q;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await No(t,e,!0),i=new nu(e,s.Yi),r=i.Hu(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){const s=Pa(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await Wu(t),e,n))),n.promise}(n,t._query).then((n=>new $h(e,s,t,n)))}function tl(t){t=cc(t,gc);const e=cc(t.firestore,Sc),n=xc(e),s=new Wh(e);return ec(n,t._query,{source:"server"}).then((n=>new $h(e,s,t,n)))}function el(t,e,n){t=cc(t,mc);const s=cc(t.firestore,Sc),i=Uh(t.converter,e,n);return cl(s,[Wc(Hc(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,kn.none())])}function nl(t,e,n,...s){t=cc(t,mc);const i=cc(t.firestore,Sc),r=Hc(i);let o;return o="string"==typeof(e=Object(h.p)(e))||e instanceof qc?sh(r,"updateDoc",t._key,e,n,s):rh(r,"updateDoc",t._key,e),cl(i,[o.toMutation(t._key,kn.exists(!0))])}function rl(t){return cl(cc(t.firestore,Sc),[new Gn(t._key,kn.none())])}function sl(t,e){const n=cc(t.firestore,Sc),s=wc(t),i=Uh(t.converter,e);return cl(n,[Wc(Hc(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,kn.exists(!1))]).then((()=>s))}function il(t,...e){var n,s,i;t=Object(h.p)(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Tc(e[o])||(r=e[o],o++);const u={includeMetadataChanges:r.includeMetadataChanges};if(Tc(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,a,l;if(t instanceof mc)a=cc(t.firestore,Sc),l=Ye(t._key.path),c={next:n=>{e[o]&&e[o](hl(a,t,n))},error:e[o+1],complete:e[o+2]};else{const n=cc(t,gc);a=cc(n.firestore,Sc),l=n._query;const s=new Wh(a);c={next:t=>{e[o]&&e[o](new $h(a,s,n,t))},error:e[o+1],complete:e[o+2]},ol(t._query)}return function(t,e,n,s){const i=new qu(s),r=new Wa(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>Ga(await Zu(t),r))),()=>{i.bc(),t.asyncQueue.enqueueAndForget((async()=>$a(await Zu(t),r)))}}(xc(a),l,u,c)}function al(t,e){return function(t,e){const n=new qu(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){D(t).vu.add(e),e.next()}(await Zu(t),n))),()=>{n.bc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){D(t).vu.delete(e)}(await Zu(t),n)))}}(xc(t=cc(t,Sc)),Tc(e)?e:{next:e})}function cl(t,e){return function(t,e){const n=new q;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=Ru(t);try{const t=await function(t,e){const n=D(t),s=G.now(),i=e.reduce(((t,e)=>t.add(e.key)),cr());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let u=Zn(),c=cr();return n.ji.getEntries(t,i).next((t=>{u=t,u.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,u))).next((i=>{r=i;const o=[];for(const t of e){const e=Vn(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Un(t.key,e,qe(e.value.mapValue),kn.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:rr(r)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.fc[t.currentUser.toKey()];s||(s=new ke(B)),s=s.insert(e,n),t.fc[t.currentUser.toKey()]=s}(s,t.batchId,n),await Iu(s,t.changes),await _a(s.remoteStore)}catch(t){const e=Pa(t,"Failed to persist write");n.reject(e)}}(await Yu(t),e,n))),n.promise}(xc(t),e)}function hl(t,e,n){const s=n.docs.get(e._key),i=new Wh(t);return new Kh(t,i,e._key,s,new jh(n.hasPendingWrites,n.fromCache),e.converter)}const ll={maxAttempts:5};class fl{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Hc(t)}set(t,e,n){this._verifyNotCommitted();const s=ml(t,this._firestore),i=Uh(s.converter,e,n),r=Wc(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,kn.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=ml(t,this._firestore);let r;return r="string"==typeof(e=Object(h.p)(e))||e instanceof qc?sh(this._dataReader,"WriteBatch.update",i._key,e,n,s):rh(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(r.toMutation(i._key,kn.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=ml(t,this._firestore);return this._mutations=this._mutations.concat(new Gn(e._key,kn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ml(t,e){if((t=Object(h.p)(t)).firestore!==e)throw new C(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class gl extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Hc(t)}get(t){const e=ml(t,this._firestore),n=new Bh(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return _();const s=t[0];if(s.isFoundDocument())return new gh(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new gh(this._firestore,n,e._key,null,e.converter);throw _()}))}set(t,e,n){const s=ml(t,this._firestore),i=Uh(s.converter,e,n),r=Wc(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(t,e,n,...s){const i=ml(t,this._firestore);let r;return r="string"==typeof(e=Object(h.p)(e))||e instanceof qc?sh(this._dataReader,"Transaction.update",i._key,e,n,s):rh(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,r),this}delete(t){const e=ml(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=ml(t,this._firestore),n=new Wh(this._firestore);return super.get(t).then((t=>new Kh(this._firestore,n,e._key,t._document,new jh(!1,!1),e.converter)))}}function pl(t,e,n){t=cc(t,Sc);const s=Object.assign(Object.assign({},ll),n);return function(t){if(t.maxAttempts<1)throw new C(A.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(t,e,n){const s=new q;return t.asyncQueue.enqueueAndForget((async()=>{const i=await Ju(t);new ju(t.asyncQueue,i,n,e,s).run()})),s.promise}(xc(t),(n=>e(new gl(t,n))),s)}function yl(){return new Xc("deleteField")}function wl(){return new Jc("serverTimestamp")}function vl(...t){return new Zc("arrayUnion",t)}function bl(...t){return new eh("arrayRemove",t)}function Il(t){return new nh("increment",t)}!function(t,e=!0){!function(t){b=t}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((t,{instanceIdentifier:n,options:s})=>{const i=t.getProvider("app").getImmediate(),r=new Sc(new R(t.getProvider("auth-internal")),new V(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new C(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Et(t.options.projectId,e)}(i,n),i);return s=Object.assign({useFetchStreams:e},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(d,"3.9.0",t),Object(r.registerVersion)(d,"3.9.0","esm2017")}()}).call(this,n(187))},661:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return ir})),n.d(e,"b",(function(){return ar})),n.d(e,"c",(function(){return or})),n.d(e,"d",(function(){return cr})),n.d(e,"e",(function(){return ur})),n.d(e,"f",(function(){return lr})),n.d(e,"g",(function(){return dr})),n.d(e,"h",(function(){return rr})),n.d(e,"i",(function(){return sr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(a,b,t){return a.call.apply(a.bind,arguments)}function v(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:v).apply(null,arguments)}function I(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function T(a,b){function t(){}t.prototype=b.prototype,a.X=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.Wb=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function E(){this.s=this.s,this.o=this.o}E.prototype.s=!1,E.prototype.na=function(){var a;!this.s&&(this.s=!0,this.M(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y))},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const _=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1};function S(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function x(a,b){for(let t=1;t<arguments.length;t++){const e=arguments[t];if(f(e)){const t=a.length||0,n=e.length||0;a.length=t+n;for(let r=0;r<n;r++)a[t+r]=e[r]}else a.push(e)}}function D(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function C(a){return/^[\s\xa0]*$/.test(a)}var N=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function k(a,b){return a<b?-1:a>b?1:0}function O(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function R(a){return-1!=O().indexOf(a)}function M(a){return M[" "](a),a}M[" "]=d;var F,a,L=R("Opera"),V=R("Trident")||R("MSIE"),P=R("Edge"),U=P||V,B=R("Gecko")&&!(-1!=O().toLowerCase().indexOf("webkit")&&!R("Edge"))&&!(R("Trident")||R("MSIE"))&&!R("Edge"),j=-1!=O().toLowerCase().indexOf("webkit")&&!R("Edge");function K(){var a=l.document;return a?a.documentMode:void 0}t:{var G="",$=(a=O(),B?/rv:([^\);]+)(\)|;)/.exec(a):P?/Edge\/([\d\.]+)/.exec(a):V?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):j?/WebKit\/(\S+)/.exec(a):L?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if($&&(G=$?$[1]:""),V){var Q=K();if(null!=Q&&Q>parseFloat(G)){F=String(Q);break t}}F=G}var z,H={};function W(){return function(a){var b=H;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}((function(){let a=0;const b=N(String(F)).split("."),t=N("9").split("."),e=Math.max(b.length,t.length);for(let o=0;0==a&&o<e;o++){var n=b[o]||"",r=t[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=k(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||k(0==n[2].length,0==r[2].length)||k(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))}if(l.document&&V){var X=K();z=X||(parseInt(F,10)||void 0)}else z=void 0;var Y=z;function J(a,b){if(D.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(B){t:{try{M(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Z[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&J.X.h.call(this)}}T(J,D);var Z={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.X.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var tt="closure_listenable_"+(1e6*Math.random()|0),et=0;function nt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ha=n,this.key=++et,this.ba=this.ea=!1}function st(a){a.ba=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function it(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function ot(a){const b={};for(const t in a)b[t]=a[t];return b}const at="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ut(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<at.length;n++)t=at[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function ct(a){this.src=a,this.g={},this.h=0}function ht(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=_(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(st(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function lt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.ba&&r.listener==b&&r.capture==!!t&&r.ha==e)return n}return-1}ct.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=lt(a,b,e,n);return-1<o?(b=a[o],t||(b.ea=!1)):((b=new nt(b,this.src,r,!!e,n)).ea=t,a.push(b)),b};var ft="closure_lm_"+(1e6*Math.random()|0),mt={};function gt(a,b,t,e,n){if(e&&e.once)return yt(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)gt(a,b[r],t,e,n);return null}return t=_t(t),a&&a[tt]?a.N(b,t,p(e)?!!e.capture:!!e,n):pt(a,b,t,!1,e,n)}function pt(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=Tt(a);if(c||(a[ft]=c=new ct(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}const b=It;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)A||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(bt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function yt(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)yt(a,b[r],t,e,n);return null}return t=_t(t),a&&a[tt]?a.O(b,t,p(e)?!!e.capture:!!e,n):pt(a,b,t,!0,e,n)}function wt(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)wt(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=_t(t),a&&a[tt]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=lt(r=a.g[b],t,e,n))&&(st(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=Tt(a))&&(b=a.g[b.toString()],a=-1,b&&(a=lt(b,t,e,n)),(t=-1<a?b[a]:null)&&vt(t))}function vt(a){if("number"!=typeof a&&a&&!a.ba){var b=a.src;if(b&&b[tt])ht(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(bt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=Tt(b))?(ht(t,a),0==t.h&&(t.src=null,b[ft]=null)):st(a)}}}function bt(a){return a in mt?mt[a]:mt[a]="on"+a}function It(a,b){if(a.ba)a=!0;else{b=new J(b,this);var t=a.listener,e=a.ha||a.src;a.ea&&vt(a),a=t.call(e,b)}return a}function Tt(a){return(a=a[ft])instanceof ct?a:null}var Et="__closure_events_fn_"+(1e9*Math.random()>>>0);function _t(a){return"function"==typeof a?a:(a[Et]||(a[Et]=function(b){return a.handleEvent(b)}),a[Et])}function St(){E.call(this),this.i=new ct(this),this.P=this,this.I=null}function xt(a,b){var t,e=a.I;if(e)for(t=[];e;e=e.I)t.push(e);if(a=a.P,e=b.type||b,"string"==typeof b)b=new D(b,a);else if(b instanceof D)b.target=b.target||a;else{var n=b;ut(b=new D(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=Dt(o,e,!0,b)&&n}if(n=Dt(o=b.g=a,e,!0,b)&&n,n=Dt(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=Dt(o=b.g=t[r],e,!1,b)&&n}function Dt(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.ba&&o.capture==t){var c=o.listener,u=o.ha||o.src;o.ea&&ht(a.i,o),n=!1!==c.call(u,e)&&n}}return n&&!e.defaultPrevented}T(St,E),St.prototype[tt]=!0,St.prototype.removeEventListener=function(a,b,t,e){wt(this,a,b,t,e)},St.prototype.M=function(){if(St.X.M.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)st(e[n]);delete a.g[t],a.h--}}this.I=null},St.prototype.N=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},St.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var At=l.JSON.stringify;function Ct(){var a=Lt;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Nt,kt=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Ot),(a=>a.reset()));class Ot{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Rt(a){l.setTimeout((()=>{throw a}),0)}function Mt(a,b){Nt||function(){var a=l.Promise.resolve(void 0);Nt=function(){a.then(Vt)}}(),Ft||(Nt(),Ft=!0),Lt.add(a,b)}var Ft=!1,Lt=new class{constructor(){this.h=this.g=null}add(a,b){const t=kt.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}};function Vt(){for(var a;a=Ct();){try{a.h.call(a.g)}catch(t){Rt(t)}var b=kt;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Ft=!1}function Pt(a,b){St.call(this),this.h=a||1,this.g=b||l,this.j=q(this.lb,this),this.l=Date.now()}function qt(a){a.ca=!1,a.R&&(a.g.clearTimeout(a.R),a.R=null)}function Ut(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Bt(a){a.g=Ut((()=>{a.g=null,a.i&&(a.i=!1,Bt(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}T(Pt,St),(r=Pt.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-a):(this.R&&(this.g.clearTimeout(this.R),this.R=null),xt(this,"tick"),this.ca&&(qt(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Pt.X.M.call(this),qt(this),delete this.g};class jt extends E{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:Bt(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Kt(a){E.call(this),this.h=a,this.g={}}T(Kt,E);var Gt=[];function $t(a,b,t,e){Array.isArray(t)||(t&&(Gt[0]=t.toString()),t=Gt);for(var n=0;n<t.length;n++){var r=gt(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Qt(a){it(a.g,(function(b,t){this.g.hasOwnProperty(t)&&vt(b)}),a),a.g={}}function zt(){this.g=!0}function Ht(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return At(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Kt.prototype.M=function(){Kt.X.M.call(this),Qt(this)},Kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},zt.prototype.Aa=function(){this.g=!1},zt.prototype.info=function(){};var Wt={},Xt=null;function Yt(){return Xt=Xt||new St}function Jt(a){D.call(this,Wt.Pa,a)}function Zt(a){const b=Yt();xt(b,new Jt(b))}function te(a,b){D.call(this,Wt.STAT_EVENT,a),this.stat=b}function ee(a){const b=Yt();xt(b,new te(b,a))}function ne(a,b){D.call(this,Wt.Qa,a),this.size=b}function re(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Wt.Pa="serverreachability",T(Jt,D),Wt.STAT_EVENT="statevent",T(te,D),Wt.Qa="timingevent",T(ne,D);var se={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ie={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function oe(){}function ae(a){return a.h||(a.h=a.i())}function ue(){}oe.prototype.h=null;var ce,he={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function le(){D.call(this,"d")}function de(){D.call(this,"c")}function fe(){}function me(a,b,t,e){this.l=a,this.j=b,this.m=t,this.U=e||1,this.S=new Kt(this),this.O=pe,a=U?125:void 0,this.T=new Pt(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new ge}function ge(){this.i=null,this.g="",this.h=!1}T(le,D),T(de,D),T(fe,oe),fe.prototype.g=function(){return new XMLHttpRequest},fe.prototype.i=function(){return{}},ce=new fe;var pe=45e3,ye={},we={};function ve(a,b,t){a.K=1,a.v=Pe(Re(b)),a.s=t,a.P=!0,be(a,null)}function be(a,b){a.F=Date.now(),_e(a),a.A=Re(a.v);var t=a.A,e=a.U;Array.isArray(e)||(e=[String(e)]),Ye(t.i,"t",e),a.C=0,t=a.l.H,a.h=new ge,a.g=Wn(a.l,t?b:null,!a.s),0<a.N&&(a.L=new jt(q(a.La,a,a.g),a.N)),$t(a.S,a.g,"readystatechange",a.ib),b=a.H?ot(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.da(a.A,a.u,a.s,b)):(a.u="GET",a.g.da(a.A,a.u,null,b)),Zt(),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),u=0;u<c.length;u++){var h=c[u].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.u,a.A,a.m,a.U,a.s)}function Ie(a){return!!a.g&&("GET"==a.u&&2!=a.K&&a.l.Da)}function Te(a,b,t){let e,n=!0;for(;!a.I&&a.C<t.length;){if(e=Ee(a,t),e==we){4==b&&(a.o=4,ee(14),n=!1),Ht(a.j,a.m,null,"[Incomplete Response]");break}if(e==ye){a.o=4,ee(15),Ht(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Ht(a.j,a.m,e,null),Ce(a,e)}Ie(a)&&e!=we&&e!=ye&&(a.h.g="",a.C=0),4!=b||0!=t.length||a.h.h||(a.o=1,ee(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.$&&(a.$=!0,(b=a.l).g==a&&b.$&&!b.K&&(b.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Bn(b),b.K=!0,ee(11))):(Ht(a.j,a.m,t,"[Invalid Chunked Response]"),Ae(a),De(a))}function Ee(a,b){var t=a.C,e=b.indexOf("\n",t);return-1==e?we:(t=Number(b.substring(t,e)),isNaN(t)?ye:(e+=1)+t>b.length?we:(b=b.substr(e,t),a.C=e+t,b))}function _e(a){a.V=Date.now()+a.O,Se(a,a.O)}function Se(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=re(q(a.gb,a),b)}function xe(a){a.B&&(l.clearTimeout(a.B),a.B=null)}function De(a){0==a.l.G||a.I||Gn(a.l,a)}function Ae(a){xe(a);var b=a.L;b&&"function"==typeof b.na&&b.na(),a.L=null,qt(a.T),Qt(a.S),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function Ce(a,b){try{var t=a.l;if(0!=t.G&&(t.g==a||rn(t.h,a)))if(!a.J&&rn(t.h,a)&&3==t.G){try{var e=t.Fa.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.F+3e3<a.F))break t;Kn(t),Rn(t)}Un(t),ee(18)}}else t.Ba=n[1],0<t.Ba-t.T&&37500>n[2]&&t.L&&0==t.A&&!t.v&&(t.v=re(q(t.cb,t),6e3));if(1>=nn(t.h)&&t.ja){try{t.ja()}catch(t){}t.ja=void 0}}else Qn(t,11)}else if((a.J||t.g==a)&&Kn(t),!C(b))for(n=t.Fa.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(t.T=h[0],h=h[1],2==t.G)if("c"==h[0]){t.I=h[1],t.ka=h[2];const n=h[3];null!=n&&(t.ma=n,t.j.info("VER="+t.ma));const l=h[4];null!=l&&(t.Ca=l,t.j.info("SVER="+t.Ca));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.J=e,t.j.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(sn(r,r.h),r.h=null))}if(e.D){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.za=t,Ve(e.F,e.D,t))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-a.F,t.j.info("Handshake RTT: "+t.P+"ms"));var o=a;if((e=t).sa=Hn(e,e.H?e.ka:null,e.V),o.J){on(e.h,o);var c=o,u=e.J;u&&c.setTimeout(u),c.B&&(xe(c),_e(c)),e.g=o}else qn(e);0<t.i.length&&Fn(t)}else"stop"!=h[0]&&"close"!=h[0]||Qn(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?Qn(t,7):On(t):"noop"!=h[0]&&t.l&&t.l.wa(h),t.A=0)}Zt()}catch(t){}}function Ne(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var t=function(a){if(a.oa&&"function"==typeof a.oa)return a.oa();if(!a.W||"function"!=typeof a.W){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(f(a)||"string"==typeof a){var b=[];a=a.length;for(var t=0;t<a;t++)b.push(t);return b}b=[],t=0;for(const e in a)b[t++]=e;return b}}}(a),e=function(a){if(a.W&&"function"==typeof a.W)return a.W();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length,r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}(r=me.prototype).setTimeout=function(a){this.O=a},r.ib=function(a){a=a.target;const b=this.L;b&&3==xn(a)?b.l():this.La(a)},r.La=function(a){try{if(a==this.g)t:{const d=xn(this.g);var b=this.g.Ea();this.g.aa();if(!(3>d)&&(3!=d||U||this.g&&(this.h.h||this.g.fa()||Dn(this.g)))){this.I||4!=d||7==b||Zt(),xe(this);var t=this.g.aa();this.Y=t;e:if(Ie(this)){var e=Dn(this.g);a="";var n=e.length,r=4==xn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ae(this),De(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.U,d,t),this.i){if(this.Z&&!this.J){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(c)){var h=c;break e}}h=null}if(!(t=h)){this.i=!1,this.o=3,ee(12),Ae(this),De(this);break t}Ht(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ce(this,t)}this.P?(Te(this,d,o),U&&this.i&&3==d&&($t(this.S,this.T,"tick",this.hb),this.T.start())):(Ht(this.j,this.m,o,null),Ce(this,o)),4==d&&Ae(this),this.i&&!this.I&&(4==d?Gn(this.l,this):(this.i=!1,_e(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ee(12)):(this.o=0,ee(13)),Ae(this),De(this)}}}catch(t){}},r.hb=function(){if(this.g){var a=xn(this.g),b=this.g.fa();this.C<b.length&&(xe(this),Te(this,a,b),this.i&&4!=a&&_e(this))}},r.cancel=function(){this.I=!0,Ae(this)},r.gb=function(){this.B=null;const a=Date.now();0<=a-this.V?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.K&&(Zt(),ee(17)),Ae(this),this.o=2,De(this)):Se(this,this.V-a)};var ke=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Oe(a,b){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof Oe){this.h=void 0!==b?b:a.h,Me(this,a.j),this.s=a.s,this.g=a.g,Fe(this,a.m),this.l=a.l,b=a.i;var t=new ze;t.i=b.i,b.g&&(t.g=new Map(b.g),t.h=b.h),Le(this,t),this.o=a.o}else a&&(t=String(a).match(ke))?(this.h=!!b,Me(this,t[1]||"",!0),this.s=qe(t[2]||""),this.g=qe(t[3]||"",!0),Fe(this,t[4]),this.l=qe(t[5]||"",!0),Le(this,t[6]||"",!0),this.o=qe(t[7]||"")):(this.h=!!b,this.i=new ze(null,this.h))}function Re(a){return new Oe(a)}function Me(a,b,t){a.j=t?qe(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Fe(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Le(a,b,t){b instanceof ze?(a.i=b,function(a,b){b&&!a.j&&(He(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(We(this,e),Ye(this,n,t))}),a)),a.j=b}(a.i,a.h)):(t||(b=Ue(b,$e)),a.i=new ze(b,a.h))}function Ve(a,b,t){a.i.set(b,t)}function Pe(a){return Ve(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function qe(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ue(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,Be),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Be(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Oe.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Ue(b,je,!0),":");var t=this.g;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(Ue(b,je,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&a.push("/"),a.push(Ue(t,"/"==t.charAt(0)?Ge:Ke,!0))),(t=this.i.toString())&&a.push("?",t),(t=this.o)&&a.push("#",Ue(t,Qe)),a.join("")};var je=/[#\/\?@]/g,Ke=/[#\?:]/g,Ge=/[#\?]/g,$e=/[#\?@]/g,Qe=/#/g;function ze(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function He(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function We(a,b){He(a),b=Je(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Xe(a,b){return He(a),b=Je(a,b),a.g.has(b)}function Ye(a,b,t){We(a,b),0<t.length&&(a.i=null,a.g.set(Je(a,b),S(t)),a.h+=t.length)}function Je(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=ze.prototype).add=function(a,b){He(this),this.i=null,a=Je(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){He(this),this.g.forEach((function(t,e){t.forEach((function(t){a.call(b,t,e,this)}),this)}),this)},r.oa=function(){He(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),t=[];for(let e=0;e<b.length;e++){const n=a[e];for(let r=0;r<n.length;r++)t.push(b[e])}return t},r.W=function(a){He(this);let b=[];if("string"==typeof a)Xe(this,a)&&(b=b.concat(this.g.get(Je(this,a))));else{a=Array.from(this.g.values());for(let t=0;t<a.length;t++)b=b.concat(a[t])}return b},r.set=function(a,b){return He(this),this.i=null,Xe(this,a=Je(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.W(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var t=0;t<b.length;t++){var e=b[t];const r=encodeURIComponent(String(e)),o=this.W(e);for(e=0;e<o.length;e++){var n=r;""!==o[e]&&(n+="="+encodeURIComponent(String(o[e]))),a.push(n)}}return this.i=a.join("&")};function Ze(a){this.l=a||tn,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ga&&l.g.Ga()&&l.g.Ga().$b),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tn=10;function en(a){return!!a.h||!!a.g&&a.g.size>=a.j}function nn(a){return a.h?1:a.g?a.g.size:0}function rn(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function sn(a,b){a.g?a.g.add(b):a.h=b}function on(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function an(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.D);return b}return S(a.i)}function un(){}function cn(){this.g=new un}function hn(a,b,t){const e=t||"";try{Ne(a,(function(t,n){let r=t;p(t)&&(r=At(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function dd(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function ln(a){this.l=a.ac||null,this.j=a.jb||!1}function dn(a,b){St.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ze.prototype.cancel=function(){if(this.i=an(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},un.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},un.prototype.parse=function(a){return l.JSON.parse(a,void 0)},T(ln,oe),ln.prototype.g=function(){return new dn(this.l,this.j)},ln.prototype.i=function(a){return function(){return a}}({}),T(dn,St);var fn=0;function mn(a){a.j.read().then(a.Ta.bind(a)).catch(a.ga.bind(a))}function gn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,pn(a)}function pn(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=dn.prototype).open=function(a,b){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,pn(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||l).fetch(new Request(this.B,b)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,gn(this)),this.readyState=fn},r.Wa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,pn(this)),this.g&&(this.readyState=3,pn(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;mn(this)}else a.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?gn(this):pn(this),3==this.readyState&&mn(this)}},r.Va=function(a){this.g&&(this.response=this.responseText=a,gn(this))},r.Ua=function(a){this.g&&(this.response=a,gn(this))},r.ga=function(){this.g&&gn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(dn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var yn=l.JSON.parse;function wn(a){St.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=vn,this.K=this.L=!1}T(wn,St);var vn="",bn=/^https?$/i,In=["POST","PUT"];function Tn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,En(a),_n(a)}function En(a){a.D||(a.D=!0,xt(a,"complete"),xt(a,"error"))}function td(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=xn(a)||2!=a.aa()))if(a.v&&4==xn(a))Ut(a.Ha,0,a);else if(xt(a,"readystatechange"),4==xn(a)){a.h=!1;try{const c=a.aa();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===c){var n=String(a.H).match(ke)[1]||null;if(!n&&l.self&&l.self.location){var r=l.self.location.protocol;n=r.substr(0,r.length-1)}e=!bn.test(n?n.toLowerCase():"")}t=e}if(t)xt(a,"complete"),xt(a,"success");else{a.m=6;try{var o=2<xn(a)?a.g.statusText:""}catch(t){o=""}a.j=o+" ["+a.aa()+"]",En(a)}}finally{_n(a)}}}function _n(a,b){if(a.g){Sn(a);const t=a.g,e=a.C[0]?d:null;a.g=null,a.C=null,b||xt(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function Sn(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function xn(a){return a.g?a.g.readyState:0}function Dn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case vn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function An(a){let b="";return it(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}function Cn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=An(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Ve(a,b,t))}function Nn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function kn(a){this.Ca=0,this.i=[],this.j=new zt,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Nn("failFast",!1,a),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Nn("baseRetryDelayMs",5e3,a),this.bb=Nn("retryDelaySeedMs",1e4,a),this.$a=Nn("forwardChannelMaxRetries",2,a),this.ta=Nn("forwardChannelRequestTimeoutMs",2e4,a),this.ra=a&&a.xmlHttpFactory||void 0,this.Da=a&&a.Zb||!1,this.J=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.I="",this.h=new Ze(a&&a.concurrentRequestLimit),this.Fa=new cn,this.O=a&&a.fastHandshake||!1,this.N=a&&a.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=a&&a.Xb||!1,a&&a.Aa&&this.j.Aa(),a&&a.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&a&&a.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function On(a){if(Mn(a),3==a.G){var b=a.U++,t=Re(a.F);Ve(t,"SID",a.I),Ve(t,"RID",b),Ve(t,"TYPE","terminate"),Vn(a,t),(b=new me(a,a.j,b,void 0)).K=2,b.v=Pe(Re(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.v.toString(),"")),!t&&l.Image&&((new Image).src=b.v,t=!0),t||(b.g=Wn(b.l,null),b.g.da(b.v)),b.F=Date.now(),_e(b)}zn(a)}function Rn(a){a.g&&(Bn(a),a.g.cancel(),a.g=null)}function Mn(a){Rn(a),a.u&&(l.clearTimeout(a.u),a.u=null),Kn(a),a.h.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Fn(a){en(a.h)||a.m||(a.m=!0,Mt(a.Ja,a),a.C=0)}function Ln(a,b){var t;t=b?b.m:a.U++;const e=Re(a.F);Ve(e,"SID",a.I),Ve(e,"RID",t),Ve(e,"AID",a.T),Vn(a,e),a.o&&a.s&&Cn(e,a.o,a.s),t=new me(a,a.j,t,a.C+1),null===a.o&&(t.H=a.s),b&&(a.i=b.D.concat(a.i)),b=Pn(a,t,1e3),t.setTimeout(Math.round(.5*a.ta)+Math.round(.5*a.ta*Math.random())),sn(a.h,t),ve(t,e,b)}function Vn(a,b){a.ia&&it(a.ia,(function(t,e){Ve(b,e,t)})),a.l&&Ne({},(function(t,e){Ve(b,e,t)}))}function Pn(a,b,t){t=Math.min(a.i.length,t);var e=a.l?q(a.l.Ra,a.l,a):null;t:{var n=a.i;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let u=0;u<t;u++){let t=n[u].h;const h=n[u].g;if(t-=r,0>t)r=Math.max(0,n[u].h-100),c=!1;else try{hn(h,o,"req"+t+"_")}catch(t){e&&e(h)}}if(c){e=o.join("&");break t}}}return a=a.i.splice(0,t),b.D=a,e}function qn(a){a.g||a.u||(a.Z=1,Mt(a.Ia,a),a.A=0)}function Un(a){return!(a.g||a.u||3<=a.A)&&(a.Z++,a.u=re(q(a.Ia,a),$n(a,a.A)),a.A++,!0)}function Bn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function jn(a){a.g=new me(a,a.j,"rpc",a.Z),null===a.o&&(a.g.H=a.s),a.g.N=0;var b=Re(a.sa);Ve(b,"RID","rpc"),Ve(b,"SID",a.I),Ve(b,"CI",a.L?"0":"1"),Ve(b,"AID",a.T),Ve(b,"TYPE","xmlhttp"),Vn(a,b),a.o&&a.s&&Cn(b,a.o,a.s),a.J&&a.g.setTimeout(a.J);var t=a.g;a=a.ka,t.K=1,t.v=Pe(Re(b)),t.s=null,t.P=!0,be(t,a)}function Kn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function Gn(a,b){var t=null;if(a.g==b){Kn(a),Bn(a),a.g=null;var e=2}else{if(!rn(a.h,b))return;t=b.D,on(a.h,b),e=1}if(0!=a.G)if(a.pa=b.Y,b.i)if(1==e){t=b.s?b.s.length:0,b=Date.now()-b.F;var n=a.C;xt(e=Yt(),new ne(e,t)),Fn(a)}else qn(a);else if(3==(n=b.o)||0==n&&0<a.pa||!(1==e&&function(a,b){return!(nn(a.h)>=a.h.j-(a.m?1:0)||(a.m?(a.i=b.D.concat(a.i),0):1==a.G||2==a.G||a.C>=(a.Za?0:a.$a)||(a.m=re(q(a.Ja,a,b),$n(a,a.C)),a.C++,0)))}(a,b)||2==e&&Un(a)))switch(t&&0<t.length&&(b=a.h,b.i=b.i.concat(t)),n){case 1:Qn(a,5);break;case 4:Qn(a,10);break;case 3:Qn(a,6);break;default:Qn(a,2)}}function $n(a,b){let t=a.Xa+Math.floor(Math.random()*a.bb);return a.l||(t*=2),t*b}function Qn(a,b){if(a.j.info("Error code "+b),2==b){var t=null;a.l&&(t=null);var e=q(a.kb,a);t||(t=new Oe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Me(t,"https"),Pe(t)),function(a,b){const t=new zt;if(l.Image){const e=new Image;e.onload=I(dd,t,e,"TestLoadImage: loaded",!0,b),e.onerror=I(dd,t,e,"TestLoadImage: error",!1,b),e.onabort=I(dd,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=I(dd,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else ee(2);a.G=0,a.l&&a.l.va(b),zn(a),Mn(a)}function zn(a){if(a.G=0,a.la=[],a.l){const b=an(a.h);0==b.length&&0==a.i.length||(x(a.la,b),x(a.la,a.i),a.h.i.length=0,S(a.i),a.i.length=0),a.l.ua()}}function Hn(a,b,t){var e=t instanceof Oe?Re(t):new Oe(t,void 0);if(""!=e.g)b&&(e.g=b+"."+e.g),Fe(e,e.m);else{var n=l.location;e=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new Oe(null,void 0);e&&Me(r,e),b&&(r.g=b),n&&Fe(r,n),t&&(r.l=t),e=r}return t=a.D,b=a.za,t&&b&&Ve(e,t,b),Ve(e,"VER",a.ma),Vn(a,e),e}function Wn(a,b,t){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return(b=t&&a.Da&&!a.ra?new wn(new ln({jb:!0})):new wn(a.ra)).Ka(a.H),b}function Xn(){}function Yn(){if(V&&!(10<=Number(Y)))throw Error("Environmental error: no available transport.")}function Jn(a,b){St.call(this),this.g=new kn(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya}),this.g.S=a,(a=b&&b.Yb)&&!C(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!C(b)&&(this.g.D=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new nr(this)}function Zn(a){le.call(this);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function er(){de.call(this),this.status=1}function nr(a){this.g=a}(r=wn.prototype).Ka=function(a){this.L=a},r.da=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ce.g(),this.C=this.u?ae(this.u):ae(ce),this.g.onreadystatechange=q(this.Ha,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(t){return void Tn(this,t)}if(a=t||"",t=new Map(this.headers),e)if(Object.getPrototypeOf(e)===Object.prototype)for(var n in e)t.set(n,e[n]);else{if("function"!=typeof e.keys||"function"!=typeof e.get)throw Error("Unknown input type for opt_headers: "+String(e));for(const n of e.keys())t.set(n,e.get(n))}e=Array.from(t.keys()).find((t=>"content-type"==t.toLowerCase())),n=l.FormData&&a instanceof l.FormData,!(0<=_(In,b))||e||n||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,n]of t)this.g.setRequestHeader(e,n);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Sn(this),0<this.B&&((this.K=function(a){return V&&W()&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.qa,this)):this.A=Ut(this.qa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){Tn(this,t)}},r.qa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xt(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,xt(this,"complete"),xt(this,"abort"),_n(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),_n(this,!0)),wn.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?td(this):this.fb())},r.fb=function(){td(this)},r.aa=function(){try{return 2<xn(this)?this.g.status:-1}catch(t){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Sa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),yn(b)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=kn.prototype).ma=8,r.G=1,r.Ja=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const n=new me(this,this.j,a,void 0);let r=this.s;if(this.S&&(r?(r=ot(r),ut(r,this.S)):r=this.S),null!==this.o||this.N||(n.H=r,r=null),this.O)t:{for(var b=0,t=0;t<this.i.length;t++){var e=this.i[t];if(void 0===(e="__data__"in e.g&&"string"==typeof(e=e.g.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.i.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=Pn(this,n,b),Ve(t=Re(this.F),"RID",a),Ve(t,"CVER",22),this.D&&Ve(t,"X-HTTP-Session-Id",this.D),Vn(this,t),r&&(this.N?b="headers="+encodeURIComponent(String(An(r)))+"&"+b:this.o&&Cn(t,this.o,r)),sn(this.h,n),this.Ya&&Ve(t,"TYPE","init"),this.O?(Ve(t,"$req",b),Ve(t,"SID","null"),n.Z=!0,ve(n,t,null)):ve(n,t,b),this.G=2}}else 3==this.G&&(a?Ln(this,a):0==this.i.length||en(this.h)||Ln(this))},r.Ia=function(){if(this.u=null,jn(this),this.$&&!(this.K||null==this.g||0>=this.P)){var a=2*this.P;this.j.info("BP detection timer enabled: "+a),this.B=re(q(this.eb,this),a)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,ee(10),Rn(this),jn(this))},r.cb=function(){null!=this.v&&(this.v=null,Rn(this),Un(this),ee(19))},r.kb=function(a){a?(this.j.info("Successfully pinged google.com"),ee(2)):(this.j.info("Failed to ping google.com"),ee(1))},(r=Xn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},Yn.prototype.g=function(a,b){return new Jn(a,b)},T(Jn,St),Jn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,t=this.h||void 0;ee(0),a.V=b,a.ia=t||{},a.L=a.Y,a.F=Hn(a,null,a.V),Fn(a)},Jn.prototype.close=function(){On(this.g)},Jn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var t={};t.__data__=a,a=t}else this.v&&((t={}).__data__=At(a),a=t);b.i.push(new class{constructor(a,b){this.h=a,this.g=b}}(b.ab++,a)),3==b.G&&Fn(b)},Jn.prototype.M=function(){this.g.l=null,delete this.j,On(this.g),delete this.g,Jn.X.M.call(this)},T(Zn,le),T(er,de),T(nr,Xn),nr.prototype.xa=function(){xt(this.g,"a")},nr.prototype.wa=function(a){xt(this.g,new Zn(a))},nr.prototype.va=function(a){xt(this.g,new er)},nr.prototype.ua=function(){xt(this.g,"b")},Yn.prototype.createWebChannel=Yn.prototype.g,Jn.prototype.send=Jn.prototype.u,Jn.prototype.open=Jn.prototype.m,Jn.prototype.close=Jn.prototype.close,se.NO_ERROR=0,se.TIMEOUT=8,se.HTTP_ERROR=6,ie.COMPLETE="complete",ue.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",St.prototype.listen=St.prototype.N,wn.prototype.listenOnce=wn.prototype.O,wn.prototype.getLastError=wn.prototype.Oa,wn.prototype.getLastErrorCode=wn.prototype.Ea,wn.prototype.getStatus=wn.prototype.aa,wn.prototype.getResponseJson=wn.prototype.Sa,wn.prototype.getResponseText=wn.prototype.fa,wn.prototype.send=wn.prototype.da,wn.prototype.setWithCredentials=wn.prototype.Ka;var rr=c.createWebChannelTransport=function(){return new Yn},sr=c.getStatEventTarget=function(){return Yt()},ir=c.ErrorCode=se,or=c.EventType=ie,ar=c.Event=Wt,ur=c.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},cr=c.FetchXmlHttpFactory=ln,lr=c.WebChannel=ue,dr=c.XhrIo=wn}).call(this,n(76))},687:function(t,e,n){"use strict";n.r(e);var r=n(617),o=n(660),c=n(598),h=n(600);function l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(t){this._delegate=t}static fromBase64String(t){return f(),new m(o.b.fromBase64String(t))}static fromUint8Array(t){return d(),new m(o.b.fromUint8Array(t))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const object=t;for(const t of e)if(t in object&&"function"==typeof object[t])return!0;return!1}(t,["next","error","complete"])}class w{enableIndexedDbPersistence(t,e){return Object(o.F)(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Object(o.G)(t._delegate)}clearIndexedDbPersistence(t){return Object(o.x)(t._delegate)}}class v{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof o.m||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Object(o.A)(this._delegate,t,e,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(t){return Object(o.Y)(this._delegate,t)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new M(this,Object(o.y)(this._delegate,t))}catch(t){throw x(t,"collection()","Firestore.collection()")}}doc(t){try{return new S(this,Object(o.E)(this._delegate,t))}catch(t){throw x(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new k(this,Object(o.z)(this._delegate,t))}catch(t){throw x(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Object(o.db)(this._delegate,(e=>t(new T(this,e))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(t=>Object(o.L)(this._delegate,t))))}loadBundle(t){return Object(o.V)(this._delegate,t)}namedQuery(t){return Object(o.W)(this._delegate,t).then((t=>t?new k(this,t):null))}}class I extends o.a{constructor(t){super(),this.firestore=t}convertBytes(t){return new m(new o.b(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return S.forKey(e,this.firestore,null)}}class T{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new I(t)}get(t){const e=F(t);return this._delegate.get(e).then((t=>new C(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,data,e){const n=F(t);return e?(l("Transaction.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=F(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=F(t);return this._delegate.delete(e),this}}class E{constructor(t){this._delegate=t}set(t,data,e){const n=F(t);return e?(l("WriteBatch.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=F(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=F(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class _{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new o.i(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new N(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=_.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let o=r.get(e);return o||(o=new _(t,new I(t),e),r.set(e,o)),o}}_.INSTANCES=new WeakMap;class S{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}static forPath(path,t,e){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new S(t,new o.d(t._delegate,e,new o.n(path)))}static forKey(t,e,n){return new S(e,new o.d(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new M(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new M(this.firestore,Object(o.y)(this._delegate,t))}catch(t){throw x(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=Object(c.p)(t))instanceof o.d&&Object(o.cb)(this._delegate,t)}set(t,e){e=l("DocumentReference.set",e);try{return e?Object(o.fb)(this._delegate,t,e):Object(o.fb)(this._delegate,t)}catch(t){throw x(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,t):Object(o.kb)(this._delegate,t,e,...n)}catch(t){throw x(t,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...t){const e=D(t),n=A(t,(t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.N)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),e.then((t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new S(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function x(t,e,n){return t.message=t.message.replace(e,n),t}function D(t){for(const e of t)if("object"==typeof e&&!y(e))return e;return{}}function A(t,e){var n,r;let o;return o=y(t[0])?t[0]:y(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{o.next&&o.next(e(t))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class C{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class N extends C{data(t){const data=this._delegate.data(t);return Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class k{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}where(t,e,n){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(t,e,n)))}catch(t){throw x(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(t,e)))}catch(t){throw x(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(t)))}catch(t){throw x(t,"limit()","Query.limit()")}}limitToLast(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(t)))}catch(t){throw x(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...t)))}catch(t){throw x(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...t)))}catch(t){throw x(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...t)))}catch(t){throw x(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...t)))}catch(t){throw x(t,"endAt()","Query.endAt()")}}isEqual(t){return Object(o.bb)(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.Q)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),e.then((t=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=D(t),n=A(t,(t=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Object(o.X)(this._delegate,e,n)}withConverter(t){return new k(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class O{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new N(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class R{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new k(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new N(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new O(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new N(this._firestore,n))}))}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class M extends k{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new S(this.firestore,t):null}doc(t){try{return new S(this.firestore,void 0===t?Object(o.E)(this._delegate):Object(o.E)(this._delegate,t))}catch(t){throw x(t,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((t=>new S(this.firestore,t)))}isEqual(t){return Object(o.cb)(this._delegate,t._delegate)}withConverter(t){return new M(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function F(t){return Object(o.p)(t,o.d)}class L{constructor(...t){this._delegate=new o.f(...t)}static documentId(){return new L(o.o.keyField().canonicalString())}isEqual(t){return(t=Object(c.p)(t))instanceof o.f&&this._delegate._internalPath.isEqual(t._internalPath)}}class V{constructor(t){this._delegate=t}static serverTimestamp(){const t=Object(o.eb)();return t._methodName="FieldValue.serverTimestamp",new V(t)}static delete(){const t=Object(o.C)();return t._methodName="FieldValue.delete",new V(t)}static arrayUnion(...t){const e=Object(o.w)(...t);return e._methodName="FieldValue.arrayUnion",new V(e)}static arrayRemove(...t){const e=Object(o.v)(...t);return e._methodName="FieldValue.arrayRemove",new V(e)}static increment(t){const e=Object(o.S)(t);return e._methodName="FieldValue.increment",new V(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const P={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:T,WriteBatch:E,DocumentReference:S,DocumentSnapshot:C,Query:k,QueryDocumentSnapshot:N,QuerySnapshot:R,CollectionReference:M,FieldPath:L,FieldValue:V,setLogLevel:function(t){Object(o.gb)(t)},CACHE_SIZE_UNLIMITED:o.c};var U,B;U=r.a,B=(t,e)=>new v(t,e,new w),U.INTERNAL.registerComponent(new h.a("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return B(e,n)}),"PUBLIC").setServiceProps(Object.assign({},P))),U.registerVersion("@firebase/firestore-compat","0.3.5")}}]);